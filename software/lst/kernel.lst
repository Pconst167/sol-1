0001   0000             ; ------------------------------------------------------------------------------------------------------------------;
0002   0000             ; Solarium - Sol-1 Homebrew Minicomputer Operating System Kernel.
0003   0000             ; ------------------------------------------------------------------------------------------------------------------;
0004   0000             
0005   0000             ; memory map
0006   0000             ; ------------------------------------------------------------------------------------------------------------------;
0007   0000             ; 0000 ... 7fff - rom space
0008   0000             ; 8000 ... f7ff - ram space
0009   0000             ; f7ff          - stack root
0010   0000             
0011   0000             ; i/o map
0012   0000             ; ------------------------------------------------------------------------------------------------------------------;
0013   0000             ; ff80 - uart 0 (16550)
0014   0000             ; ff88 - uart 1 (16550)
0015   0000             ; ffa0 - rtc    (m48t02)
0016   0000             ; ffb0 - pio 0  (8255)
0017   0000             ; ffc0 - fdd    (5.25" floppy drive block)
0018   0000             ;   - ffc0      output port (377 flip-flop)                  
0019   0000             ;   - ffc1      input port  (244 buffer)                     
0020   0000             ;   - ffc8      wd1770 status/command    
0021   0000             ;   - ffc9      wd1770 track register
0022   0000             ;   - ffca      wd1770 sector register
0023   0000             ;   - ffcb      wd1770 data register
0024   0000             ;      
0025   0000             ; ffd0 - ide    (compact flash / pata)
0026   0000             ; ffe0 - timer  (8253)
0027   0000             ; fff0 - bios configuration nv-ram store area
0028   0000             ; ------------------------------------------------------------------------------------------------------------------;
0029   0000             
0030   0000             ; ------------------------------------------------------------------------------------------------------------------;
0031   0000             ; system constants
0032   0000             ; ------------------------------------------------------------------------------------------------------------------;
0033   0000             _uart0_data       .equ $ff80         ; data
0034   0000             _uart0_dlab_0     .equ $ff80         ; divisor latch low byte
0035   0000             _uart0_dlab_1     .equ $ff81         ; divisor latch high byte
0036   0000             _uart0_ier        .equ $ff81         ; interrupt enable register
0037   0000             _uart0_fcr        .equ $ff82         ; fifo control register
0038   0000             _uart0_lcr        .equ $ff83         ; line control register
0039   0000             _uart0_lsr        .equ $ff85         ; line status register
0040   0000             
0041   0000             _uart1_data       .equ $ff88         ; data
0042   0000             _uart1_dlab_0     .equ $ff88         ; divisor latch low byte
0043   0000             _uart1_dlab_1     .equ $ff89         ; divisor latch high byte
0044   0000             _uart1_ier        .equ $ff89         ; interrupt enable register
0045   0000             _uart1_fcr        .equ $ff8A         ; fifo control register
0046   0000             _uart1_lcr        .equ $ff8B         ; line control register
0047   0000             _uart1_lsr        .equ $ff8D         ; line status register
0048   0000             
0049   0000             _ide_base         .equ $ffd0         ; ide base
0050   0000             _ide_r0           .equ _ide_base + 0 ; data port
0051   0000             _ide_r1           .equ _ide_base + 1 ; read: error code, write: feature
0052   0000             _ide_r2           .equ _ide_base + 2 ; number of sectors to transfer
0053   0000             _ide_r3           .equ _ide_base + 3 ; sector address lba 0 [0:7]
0054   0000             _ide_r4           .equ _ide_base + 4 ; sector address lba 1 [8:15]
0055   0000             _ide_r5           .equ _ide_base + 5 ; sector address lba 2 [16:23]
0056   0000             _ide_r6           .equ _ide_base + 6 ; sector address lba 3 [24:27 (lsb)]
0057   0000             _ide_r7           .equ _ide_base + 7 ; read: status, write: command       
0058   0000             
0059   0000             _til311_display   .equ $ffb0         ; bios post code hex display (2 digits) (connected to pio a)
0060   0000             _bios_post_ctrl   .equ $ffb3         ; bios post display control register, 80h = as output
0061   0000             _pio_a            .equ $ffb0    
0062   0000             _pio_b            .equ $ffb1
0063   0000             _pio_c            .equ $ffb2
0064   0000             _pio_control      .equ $ffb3         ; pio control port
0065   0000             
0066   0000             _fdc_config       .equ $ffc0         ; 0 = select_0, 1 = select_1, 2 = side_select, 3 = dden, 4 = in_use_or_head_load, 5 = wd1770_rst
0067   0000             _fdc_status_0     .equ $ffc1         ; 0 = drq, 1 = ready
0068   0000             _fdc_stat_cmd     .equ $ffc8         ; status / command register
0069   0000             _fdc_track        .equ $ffc9         ; track register
0070   0000             _fdc_sector       .equ $ffca         ; sector register
0071   0000             _fdc_data         .equ $ffcb         ; data register
0072   0000             
0073   0000             _timer_c_0        .equ $ffe0         ; timer counter 0
0074   0000             _timer_c_1        .equ $ffe1         ; timer counter 1
0075   0000             _timer_c_2        .equ $ffe2         ; timer counter 2
0076   0000             _timer_ctrl       .equ $ffe3         ; timer control register
0077   0000             
0078   0000             _stack_begin      .equ $f7ff         ; beginning of stack
0079   0000             _fifo_size        .equ 4096
0080   0000             
0081   0000             _mbr                     .equ 960
0082   0000             _superblock              .equ 1024
0083   0000             _block_group_descriptor  .equ 2048
0084   0000             
0085   0000             text_org          .equ $400          ; code origin address for all user processes
0086   0000             
0087   0000             
0088   0000             ;  ------------------------------------------------------------------------------------------------------------------;
0089   0000             ;  DISK LAYOUT:
0090   0000             ;  Metadata               | Size (bytes)      | Blocks (2048 bytes)              |Start Block |  Comment
0091   0000             ;  ---------------------- | ----------------- | -------------------------------- |------------|-----------------------------------
0092   0000             ;  Bootloader/MBR         | 1024 bytes        | 0.5 (1 sector)                   |  0         |
0093   0000             ;  Superblock             | 1024 bytes        | 1 block (2048 bytes, must align) |  0         |
0094   0000             ;                         |                   | 1 block (2048 bytes)             |  1         | reserved
0095   0000             ;  Block Bitmap           | 8,192 bytes       | 4 blocks                         |  2         | 4*2048*8 = 4*16384 = 65536 raw data blocks.  65536*2048 bytes = 134217728 bytes of disk space = 128MB
0096   0000             ;  Inode Bitmap           | 2,048 bytes       | 1 block                          |  6         | 2048*8=16384. total of 16384 bits, meaning 16384 inodes, which is 1 inode per 8KB of disk space
0097   0000             ;  Inode Table            | 2,097,152 bytes   | 1024 blocks                      |  7         | 128bytes per inode entry. 2097152 / 128 = 16384 inodes
0098   0000             ;  Data Blocks            | 134,217,728 bytes | 65528 blocks                     | 1031       | 65528 blocks = 134,201,344 bytes
0099   0000             ;  
0100   0000             ;  first 1024 bytes: bootloader from 0 to 959, MBR partition table from 960 (64 bytes)
0101   0000             ;  up to 4 partitions, each 16 bytes long
0102   0000             ;  MBR:
0103   0000             ;  Byte | Description
0104   0000             ;  -----|----------------------------
0105   0000             ;  0    | Boot flag (0x80 active, 0x00 inactive)
0106   0000             ;  1-3  | Start CHS (head, sector, cylinder)
0107   0000             ;  4    | Partition type (filesystem ID)
0108   0000             ;    0x83 = Linux native (ext2/3/4)
0109   0000             ;    0x07 = NTFS/exFAT
0110   0000             ;    0x0B = FAT32 CHS
0111   0000             ;    0x0C = FAT32 LBA
0112   0000             ;    0x05 = Extended partition
0113   0000             ;    0x86 = Sol-1 partition
0114   0000             ;  5-7  | End CHS
0115   0000             ;  8-11 | Start LBA (little endian)
0116   0000             ;  12-15| Size in sectors (little endian)
0117   0000             ;  
0118   0000             ;  
0119   0000             ;  the superblock describers the filesystem as a whole such as inode count, free inode count, location of the raw data bitmap, inode table, etc.  
0120   0000             ;  SUPERBLOCK:
0121   0000             ;  | Field               | Description                               | Typical Size (bytes) | Notes                           |
0122   0000             ;  | ------------------- | ----------------------------------------- | -------------------- | ------------------------------- |
0123   0000             ;  | inodes_count        | Total number of inodes in the filesystem  | 2                    | 16-bit unsigned int             |
0124   0000             ;  | blocks_count        | Total number of data blocks               | 2                    | 16-bit unsigned int             |
0125   0000             ;  | free_inodes_count   | Number of free inodes                     | 2                    | 16-bit unsigned int             |
0126   0000             ;  | free_blocks_count   | Number of free blocks                     | 2                    | 16-bit unsigned int             |
0127   0000             ;  | block_bitmap        | Block ID of the **block bitmap**          | 2                    | 16-bit unsigned int
0128   0000             ;  | inode_bitmap        | Block ID of the **inode bitmap**          | 2                    | 16-bit unsigned int
0129   0000             ;  | inode_table         | Starting block of **inode table**         | 2                    | 16-bit unsigned int
0130   0000             ;  | first_data_block    | Block number of the first data block      | 2                    | 16-bit unsigned int             |
0131   0000             ;  | used_dirs_count     | Number of inodes allocated to directories | 2
0132   0000             ;  | log_block_size      | Block size = 1024 << `s_log_block_size    | 2                    | 16-bit unsigned int             |
0133   0000             ;  | mtime               | Last mount time                           | 4                    | 32-bit unsigned int (Unix time) |
0134   0000             ;  | wtime               | Last write time                           | 4                    | 32-bit unsigned int (Unix time) |
0135   0000             ;  | uuid                | Unique ID of the filesystem               | 16                   | 128-bit UUID                    |
0136   0000             ;  | volume_name         | Label of the filesystem                   | 16                   | Usually ASCII, padded           |
0137   0000             ;  | feature_flags       | Compatibility flags                       | 4                    | 32-bit unsigned int             |
0138   0000             ;  
0139   0000             ;  inode for root dir is #2, #0 and #1 not used
0140   0000             ;  raw data block #0 is not used. because 0 as a block ID means not used
0141   0000             ;  block size: 2048
0142   0000             ;  inode-table format:
0143   0000             ;  | Field         | Size (bytes) | Description                                                                                  |
0144   0000             ;  | ------------- | ------------ | -------------------------------------------------------------------------------------------- |
0145   0000             ;  | `mode`        | 2            | File type and permissions                                                                    |
0146   0000             ;  | `uid`         | 2            | Owner user ID                                                                                |
0147   0000             ;  | `size`        | 4            | Size of the file in bytes                                                                    |
0148   0000             ;  | `atime`       | 4            | Last access time (timestamp)                                                                 |
0149   0000             ;  | `ctime`       | 4            | Creation time (timestamp)                                                                    |
0150   0000             ;  | `mtime`       | 4            | Last modification time (timestamp)                                                           |
0151   0000             ;  | `dtime`       | 4            | Deletion time (timestamp)                                                                    |
0152   0000             ;  | `gid`         | 2            | Group ID                                                                                     |
0153   0000             ;  | `links_count` | 2            | Number of hard links                                                                         |
0154   0000             ;  | `blocks`      | 2            | Number of 2048-byte blocks allocated                                                         |
0155   0000             ;  | `flags`       | 4            | File flags                                                                                   |
0156   0000             ;  | `block`       | 47 * 2 = 94  | Pointers to data blocks (47 direct only) 
0157   0000             ;
0158   0000             ;
0159   0000             ;  DIRECTORY ENTRY
0160   0000             ;  this is the structure for file entries inside a directory.
0161   0000             ;  2048 / 64 = 32 entries
0162   0000             ;
0163   0000             ;  each entry is 64 bytes wide
0164   0000             ;  uint16_t inode;      // Inode number (0 if entry is unused)
0165   0000             ;  char     name[62];   // File name (null terminated)
0166   0000             
0167   0000             
0168   0000             
0169   0000             ; ------------------------------------------------------------------------------------------------------------------;
0170   0000             ; global system variables
0171   0000             ; ------------------------------------------------------------------------------------------------------------------;
0172   0000             
0173   0000             ; ------------------------------------------------------------------------------------------------------------------;
0174   0000             ; irq table
0175   0000             ; highest priority at lowest address
0176   0000             ; ------------------------------------------------------------------------------------------------------------------;
0177   0000 32 00       .dw int_0_fdc
0178   0002 39 00       .dw int_1
0179   0004 3A 00       .dw int_2
0180   0006 3B 00       .dw int_3
0181   0008 3C 00       .dw int_4
0182   000A 3D 00       .dw int_5_uart1
0183   000C 5F 00       .dw int_6_timer
0184   000E 60 00       .dw int_7_uart0
0185   0010             
0186   0010             ; ------------------------------------------------------------------------------------------------------------------;
0187   0010             ; kernel reset vector
0188   0010             ; ------------------------------------------------------------------------------------------------------------------;
0189   0010 9A 07       .dw kernel_reset_vector
0190   0012             
0191   0012             ; ------------------------------------------------------------------------------------------------------------------;
0192   0012             ; exception vector table
0193   0012             ; total of 7 entries, starting at address $0012
0194   0012             ; ------------------------------------------------------------------------------------------------------------------;
0195   0012 A4 03       .dw trap_privilege
0196   0014 C1 04       .dw trap_div_zero
0197   0016 CE 04       .dw trap_undef_opcode
0198   0018 00 00       .dw 0
0199   001A 00 00       .dw 0
0200   001C 00 00       .dw 0
0201   001E 00 00       .dw 0
0202   0020             
0203   0020             ; ------------------------------------------------------------------------------------------------------------------;
0204   0020             ; system call vector table
0205   0020             ; starts at address $0020
0206   0020             ; ------------------------------------------------------------------------------------------------------------------;
0207   0020 B0 03       .dw syscall_break
0208   0022 CF 04       .dw syscall_rtc
0209   0024 F2 05       .dw syscall_ide
0210   0026 B2 06       .dw syscall_io
0211   0028 69 07       .dw syscall_file_system
0212   002A 01 05       .dw syscall_datetime
0213   002C 98 03       .dw syscall_reboot
0214   002E 64 03       .dw syscall_system
0215   0030 A3 00       .dw syscall_fdc
0216   0032             
0217   0032             ; ------------------------------------------------------------------------------------------------------------------;
0218   0032             ; system call aliases
0219   0032             ; ------------------------------------------------------------------------------------------------------------------;
0220   0032             sys_break            .equ 0
0221   0032             sys_rtc              .equ 1
0222   0032             sys_ide              .equ 2
0223   0032             sys_io               .equ 3
0224   0032             sys_filesystem       .equ 4
0225   0032             sys_datetime         .equ 5
0226   0032             sys_reboot           .equ 6
0227   0032             sys_system           .equ 7
0228   0032             sys_fdc              .equ 8
0229   0032             
0230   0032             ; aliases for individual 'al' options for FDC system calls
0231   0032             fdc_al_restore      .equ 0
0232   0032             fdc_al_step         .equ 1
0233   0032             fdc_al_step_in      .equ 2
0234   0032             fdc_al_step_out     .equ 3
0235   0032             fdc_al_seek         .equ 4
0236   0032             fdc_al_format_128   .equ 5
0237   0032             fdc_al_formatdisk_128   .equ 6
0238   0032             fdc_al_format_512   .equ 7
0239   0032             fdc_al_formatdisk_512   .equ 8
0240   0032             fdc_al_read_addr    .equ 9
0241   0032             fdc_al_read_track   .equ 10
0242   0032             fdc_al_read_sect    .equ 11
0243   0032             fdc_al_write_sect   .equ 12
0244   0032             fdc_al_force_int    .equ 13
0245   0032             fdc_al_status0      .equ 14
0246   0032             fdc_al_status1      .equ 15
0247   0032             
0248   0032             ; ------------------------------------------------------------------------------------------------------------------;
0249   0032             ; alias exports
0250   0032             ; ------------------------------------------------------------------------------------------------------------------;
0251   0032             .export text_org
0252   0032             .export sys_break
0253   0032             .export sys_rtc
0254   0032             .export sys_ide
0255   0032             .export sys_io
0256   0032             .export sys_filesystem
0257   0032             .export sys_datetime
0258   0032             .export sys_reboot
0259   0032             .export sys_system
0260   0032             .export sys_fdc
0261   0032             
0262   0032             .export _til311_display
0263   0032             
0264   0032             .export _fdc_config        
0265   0032             .export _fdc_status_0      
0266   0032             .export _fdc_stat_cmd     
0267   0032             
0268   0032             ; exports of aliases for individual 'al' options for FDC system calls
0269   0032             .export fdc_al_restore
0270   0032             .export fdc_al_step
0271   0032             .export fdc_al_step_in
0272   0032             .export fdc_al_step_out
0273   0032             .export fdc_al_seek
0274   0032             .export fdc_al_format_128
0275   0032             .export fdc_al_formatdisk_128
0276   0032             .export fdc_al_format_512
0277   0032             .export fdc_al_formatdisk_512
0278   0032             .export fdc_al_read_addr
0279   0032             .export fdc_al_read_track
0280   0032             .export fdc_al_read_sect
0281   0032             .export fdc_al_write_sect
0282   0032             .export fdc_al_force_int
0283   0032             .export fdc_al_status0
0284   0032             .export fdc_al_status1
0285   0032             
0286   0032             ; ------------------------------------------------------------------------------------------------------------------;
0287   0032             ; irqs' code block
0288   0032             ; ------------------------------------------------------------------------------------------------------------------;
0289   0032             ; 5.25" floppy drive controller irq
0290   0032             int_0_fdc:
0291   0032 3B 0E 11      mov d, s_fdc_irq
0292   0035 07 F4 09      call _puts
0293   0038 06            sysret
0294   0039             int_1:
0295   0039 06            sysret
0296   003A             int_2:
0297   003A 06            sysret
0298   003B             int_3:
0299   003B 06            sysret
0300   003C             int_4:
0301   003C 06            sysret
0302   003D             
0303   003D             ; ------------------------------------------------------------------------------------------------------------------;
0304   003D             ; uart1 interrupt
0305   003D             ; ------------------------------------------------------------------------------------------------------------------;
0306   003D             int_5_uart1:
0307   003D D7            push a
0308   003E DA            push d
0309   003F E1            pushf
0310   0040 1D 88 FF      mov al, [_uart1_data]       ; get character
0311   0043               ;mov [[d]], al              ; TODO: implement this double indirection instruction
0312   0043 3B 29 0F      mov d, fifo_in
0313   0046 FD 2A         mov d, [d]
0314   0048 3E            mov [d], al                 ; add to fifo
0315   0049 13            mov a, d
0316   004A 77            inc a
0317   004B AF 60 21      cmp a, fifo + _fifo_size     ; check if pointer reached the end of the fifo
0318   004E C7 54 00      jne int_5_continue
0319   0051 10 60 11      mov a, fifo  
0320   0054             int_5_continue:  
0321   0054 42 29 0F      mov [fifo_in], a            ; update fifo pointer
0322   0057 1A            mov al, ah
0323   0058 3D B0 FF      mov [_til311_display], al
0324   005B EE            popf
0325   005C E7            pop d
0326   005D E4            pop a  
0327   005E 06            sysret
0328   005F             
0329   005F             ; ------------------------------------------------------------------------------------------------------------------;
0330   005F             ; timer irq
0331   005F             ; ------------------------------------------------------------------------------------------------------------------;
0332   005F             int_6_timer:  
0333   005F 06            sysret
0334   0060             
0335   0060             ; ------------------------------------------------------------------------------------------------------------------;
0336   0060             ; uart0 interrupt
0337   0060             ; ------------------------------------------------------------------------------------------------------------------;
0338   0060             int_7_uart0:
0339   0060 D7            push a
0340   0061 DA            push d
0341   0062 E1            pushf
0342   0063 1D 80 FF      mov al, [_uart0_data]       ; get character
0343   0066               ;mov [[d]], al              ; TODO: implement this double indirection instruction
0344   0066 3B 29 0F      mov d, fifo_in
0345   0069 FD 2A         mov d, [d]
0346   006B 3E            mov [d], al                 ; add to fifo
0347   006C 13            mov a, d
0348   006D 77            inc a
0349   006E AF 60 21      cmp a, fifo + _fifo_size     ; check if pointer reached the end of the fifo
0350   0071 C7 77 00      jne int_7_continue
0351   0074 10 60 11      mov a, fifo  
0352   0077             int_7_continue:  
0353   0077 42 29 0F      mov [fifo_in], a            ; update fifo pointer
0354   007A 1A            mov al, ah
0355   007B 3D B0 FF      mov [_til311_display], al
0356   007E EE            popf
0357   007F E7            pop d
0358   0080 E4            pop a  
0359   0081 06            sysret
0360   0082             
0361   0082             sys_mkfs:
0362   0082 06            sysret
0363   0083             
0364   0083             ; ------------------------------------------------------------------------------------------------------------------;
0365   0083             ; floppy drive syscalls
0366   0083             ; ------------------------------------------------------------------------------------------------------------------;
0367   0083             ; data for formatting a floppy drive in single density mode (128 bytes per sector):
0368   0083             ; fdc_40_ff:
0369   0083             ;   .fill 40,  $ff    ; or 00                                                                                
0370   0083             ; fdc_128_format_inner:
0371   0083             ;   .fill 6,   $00    ;                                                                            <--|        
0372   0083             ;   .fill 1,   $fe    ; id address mark                                                               |        
0373   0083             ;   .fill 1,   $00    ; track number  0 thru 39                                                       |                    
0374   0083             ;   .fill 1,   $00    ; side number 00 or 01                                                          |                
0375   0083             ;   .fill 1,   $01    ; sector number  0x01 through 0x10                                              |                              
0376   0083             ;   .fill 1,   $00    ; sector length                                                                 |                        
0377   0083             ;   .fill 1,   $f7    ; 2 crc's written                                                               | write 16 times                 
0378   0083             ;   .fill 11,  $ff    ; or 00                                                                         |                      
0379   0083             ;   .fill 6,   $00    ;                                                                               |                        
0380   0083             ;   .fill 1,   $fb    ; data address mark                                                             |                                  
0381   0083             ;   .fill 128, $e5    ; data (ibm uses e5)                                                            |                                      
0382   0083             ;   .fill 1,   $f7    ; 2 crc's written                                                               |                                                        
0383   0083             ;   .fill 10,  $ff    ; or 00                                                                      <--|                                                  
0384   0083             ; fdc_128_format_end:
0385   0083             ;   .fill 369, $ff    ; or 00. continue writing until wd1770 interrupts out. approx 369 bytes.                                                                
0386   0083             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0387   0083             fdc_jmptbl:
0388   0083 AF 00         .dw syscall_fdc_restore
0389   0085 BB 00         .dw syscall_fdc_step
0390   0087 C3 00         .dw syscall_fdc_step_in
0391   0089 CB 00         .dw syscall_fdc_step_out
0392   008B D3 00         .dw syscall_fdc_seek
0393   008D E1 00         .dw syscall_fdc_format_128
0394   008F 35 01         .dw syscall_fdc_formatdisk_128
0395   0091 0B 01         .dw syscall_fdc_format_512
0396   0093 77 01         .dw syscall_fdc_formatdisk_512
0397   0095 DF 00         .dw syscall_fdc_read_addr
0398   0097 B9 01         .dw syscall_fdc_read_track
0399   0099 E8 01         .dw syscall_fdc_read_sect
0400   009B 20 02         .dw syscall_fdc_write_sect
0401   009D E0 00         .dw syscall_fdc_force_int
0402   009F A7 00         .dw syscall_fdc_status0
0403   00A1 AB 00         .dw syscall_fdc_status1
0404   00A3             syscall_fdc:
0405   00A3 FD 0A 83 00   jmp [fdc_jmptbl + al]
0406   00A7             
0407   00A7             syscall_fdc_status0:
0408   00A7 1D C1 FF      mov al, [_fdc_status_0]
0409   00AA 06            sysret
0410   00AB             
0411   00AB             syscall_fdc_status1:
0412   00AB 1D C8 FF      mov al, [_fdc_stat_cmd]
0413   00AE 06            sysret
0414   00AF             
0415   00AF             syscall_fdc_restore:
0416   00AF 07 51 02      call fdc_wait_not_busy
0417   00B2 F2 C8 FF 0B   mov byte [_fdc_stat_cmd], %00001011
0418   00B6 F2 C9 FF 00   mov byte [_fdc_track], $00 ; reset track
0419   00BA 06            sysret
0420   00BB             
0421   00BB             syscall_fdc_step:
0422   00BB 07 51 02      call fdc_wait_not_busy
0423   00BE F2 C8 FF 3B   mov byte [_fdc_stat_cmd], %00111011
0424   00C2 06            sysret
0425   00C3             
0426   00C3             syscall_fdc_step_in:
0427   00C3 07 51 02      call fdc_wait_not_busy
0428   00C6 F2 C8 FF 53   mov byte [_fdc_stat_cmd], %01010011
0429   00CA 06            sysret
0430   00CB             
0431   00CB             syscall_fdc_step_out:
0432   00CB 07 51 02      call fdc_wait_not_busy
0433   00CE F2 C8 FF 7B   mov byte [_fdc_stat_cmd], %01111011
0434   00D2 06            sysret
0435   00D3             
0436   00D3             ; bl: desired track
0437   00D3             syscall_fdc_seek:
0438   00D3 07 51 02      call fdc_wait_not_busy
0439   00D6 FD 3D CB FF   mov [_fdc_data], bl ; set desired track to bl
0440   00DA F2 C8 FF 1B   mov byte [_fdc_stat_cmd], %00011011 ; seek command
0441   00DE 06            sysret
0442   00DF             
0443   00DF             syscall_fdc_read_addr:
0444   00DF 06            sysret
0445   00E0             
0446   00E0             syscall_fdc_force_int:
0447   00E0 06            sysret
0448   00E1             
0449   00E1             ; when writing the actual code for formatting multiple tracks, remember to change the track number byte
0450   00E1             ; in the ram formatting block because they are all set as 00 right now
0451   00E1             ; bl: track number
0452   00E1             syscall_fdc_format_128:
0453   00E1 07 5C 02      call fdc_format_mem_128
0454   00E4 07 51 02      call fdc_wait_not_busy
0455   00E7 FD 3D C9 FF   mov [_fdc_track], bl
0456   00EB FD 4D 60 23   mov si, transient_area
0457   00EF F2 C8 FF FA   mov byte [_fdc_stat_cmd], %11111010 ; write track command: {1111, 0: enable spin-up seq, 1: settling delay, 1: no write precompensation, 0}
0458   00F3 07 32 03      call fdc_wait_64us
0459   00F6             fdc_format_drq_128:
0460   00F6 1D C8 FF      mov al, [_fdc_stat_cmd]     ; 10
0461   00F9 93 01         test al, $01                ; 4
0462   00FB C6 0A 01      jz fdc_format_end_128           ; 8
0463   00FE 93 02         test al, $02                ; 4
0464   0100 C6 F6 00      jz fdc_format_drq_128           ; 8
0465   0103 F6            lodsb                       ; 7
0466   0104 3D CB FF      mov [_fdc_data], al         ; 10   
0467   0107 0A F6 00      jmp fdc_format_drq_128
0468   010A             fdc_format_end_128:
0469   010A 06            sysret
0470   010B             
0471   010B             ; when writing the actual code for formatting multiple tracks, remember to change the track number byte
0472   010B             ; in the ram formatting block because they are all set as 00 right now
0473   010B             ; bl: track number
0474   010B             syscall_fdc_format_512:
0475   010B 07 C7 02      call fdc_format_mem_512
0476   010E 07 51 02      call fdc_wait_not_busy
0477   0111 FD 3D C9 FF   mov [_fdc_track], bl
0478   0115 FD 4D 60 23   mov si, transient_area
0479   0119 F2 C8 FF FA   mov byte [_fdc_stat_cmd], %11111010 ; write track command: {1111, 0: enable spin-up seq, 1: settling delay, 1: no write precompensation, 0}
0480   011D 07 32 03      call fdc_wait_64us
0481   0120             fdc_format_drq_512:
0482   0120 1D C8 FF      mov al, [_fdc_stat_cmd]     ; 10
0483   0123 93 01         test al, $01                ; 4
0484   0125 C6 34 01      jz fdc_format_end_512           ; 8
0485   0128 93 02         test al, $02                ; 4
0486   012A C6 20 01      jz fdc_format_drq_512           ; 8
0487   012D F6            lodsb                       ; 7
0488   012E 3D CB FF      mov [_fdc_data], al         ; 10   
0489   0131 0A 20 01      jmp fdc_format_drq_512
0490   0134             fdc_format_end_512:
0491   0134 06            sysret
0492   0135             
0493   0135             syscall_fdc_formatdisk_128:
0494   0135 2E 00         mov bl, 0
0495   0137             fdc_formatdisk128_l0:
0496   0137 07 5C 02      call fdc_format_mem_128
0497   013A 07 51 02      call fdc_wait_not_busy
0498   013D FD 3D C9 FF   mov [_fdc_track], bl
0499   0141 FD 4D 60 23   mov si, transient_area
0500   0145 F2 C8 FF FA   mov byte [_fdc_stat_cmd], %11111010 ; write track command
0501   0149 07 32 03      call fdc_wait_64us
0502   014C             fdc_formatdisk_drq_128:
0503   014C 1D C8 FF      mov al, [_fdc_stat_cmd]     ; 10
0504   014F 93 01         test al, $01                ; 4
0505   0151 C6 60 01      jz fdc_formatdisk_end_128           ; 8
0506   0154 93 02         test al, $02                ; 4
0507   0156 C6 4C 01      jz fdc_formatdisk_drq_128           ; 8
0508   0159 F6            lodsb                       ; 7
0509   015A 3D CB FF      mov [_fdc_data], al         ; 10   
0510   015D 0A 4C 01      jmp fdc_formatdisk_drq_128
0511   0160             fdc_formatdisk_end_128:
0512   0160 07 51 02      call fdc_wait_not_busy
0513   0163 D8            push b
0514   0164 26 08 00      mov b, 8
0515   0167 07 39 03      call wait_xs
0516   016A F2 C8 FF 53   mov byte [_fdc_stat_cmd], %01010011  ; step in
0517   016E E5            pop b
0518   016F 6C 01         add bl, 1
0519   0171 C1 28         cmp bl, 40
0520   0173 C7 37 01      jne fdc_formatdisk128_l0
0521   0176 06            sysret
0522   0177             
0523   0177             syscall_fdc_formatdisk_512:
0524   0177 2E 00         mov bl, 0
0525   0179             fdc_formatdisk512_l0:
0526   0179 07 C7 02      call fdc_format_mem_512
0527   017C 07 51 02      call fdc_wait_not_busy
0528   017F FD 3D C9 FF   mov [_fdc_track], bl
0529   0183 FD 4D 60 23   mov si, transient_area
0530   0187 F2 C8 FF F2   mov byte [_fdc_stat_cmd], %11110010 ; write track command
0531   018B 07 32 03      call fdc_wait_64us
0532   018E             fdc_formatdisk_drq_512:
0533   018E 1D C8 FF      mov al, [_fdc_stat_cmd]     ; 10
0534   0191 93 01         test al, $01                ; 4
0535   0193 C6 A2 01      jz fdc_formatdisk_end_512           ; 8
0536   0196 93 02         test al, $02                ; 4
0537   0198 C6 8E 01      jz fdc_formatdisk_drq_512           ; 8
0538   019B F6            lodsb                       ; 7
0539   019C 3D CB FF      mov [_fdc_data], al         ; 10   
0540   019F 0A 8E 01      jmp fdc_formatdisk_drq_512
0541   01A2             fdc_formatdisk_end_512:
0542   01A2 07 51 02      call fdc_wait_not_busy
0543   01A5 D8            push b
0544   01A6 26 08 00      mov b, 8
0545   01A9 07 39 03      call wait_xs
0546   01AC F2 C8 FF 53   mov byte [_fdc_stat_cmd], %01010011   ; step in
0547   01B0 E5            pop b
0548   01B1 6C 01         add bl, 1
0549   01B3 C1 28         cmp bl, 40
0550   01B5 C7 79 01      jne fdc_formatdisk512_l0
0551   01B8 06            sysret
0552   01B9             
0553   01B9             ; di : destination in user space
0554   01B9             ; a  : returns number of read bytes
0555   01B9             syscall_fdc_read_track:
0556   01B9 07 51 02      call fdc_wait_not_busy
0557   01BC E3            push di
0558   01BD FD 4F 60 23   mov di, transient_area
0559   01C1 F2 C8 FF E8   mov byte [_fdc_stat_cmd], %11101000
0560   01C5 07 32 03      call fdc_wait_64us
0561   01C8             fdc_read_track_l0: ; for each byte, we need to wait for drq to be high
0562   01C8 1D C8 FF      mov al, [_fdc_stat_cmd]      ; 
0563   01CB 93 01         test al, $01                ; check busy bit
0564   01CD C6 DC 01      jz fdc_read_track_end
0565   01D0 93 02         test al, $02                ; check drq bit
0566   01D2 C6 C8 01      jz fdc_read_track_l0
0567   01D5 1D CB FF      mov al, [_fdc_data]     ; 
0568   01D8 F7            stosb
0569   01D9 0A C8 01      jmp fdc_read_track_l0
0570   01DC             ;we need to check if writing to data reg causes a spurious read. so lets check inside the writing loop, how many times we actually write the bytes
0571   01DC             ;say the 40 byte loop. if we find that we only write ~20 times, then this indcates this problem.
0572   01DC             ;because for every write, if it also reads, then that clears drq, so we need to wait for next drq.
0573   01DC             fdc_read_track_end:
0574   01DC 50            mov a, di
0575   01DD 5F 60 23      sub a, transient_area
0576   01E0 F0            pop di
0577   01E1 FD 4D 60 23   mov si, transient_area
0578   01E5 39            mov c, a  ; copy track over to user space
0579   01E6 03            store
0580   01E7 06            sysret
0581   01E8             
0582   01E8             ; sector in bl
0583   01E8             ; track in bh
0584   01E8             ; di = user space destination
0585   01E8             syscall_fdc_read_sect:
0586   01E8 07 51 02      call fdc_wait_not_busy
0587   01EB E3            push di
0588   01EC FD 3D CA FF   mov [_fdc_sector], bl
0589   01F0 30            mov bl, bh
0590   01F1 FD 3D C9 FF   mov [_fdc_track], bl
0591   01F5 F2 C8 FF 88   mov byte [_fdc_stat_cmd], %10001000
0592   01F9 07 32 03      call fdc_wait_64us
0593   01FC FD 4F 60 23   mov di, transient_area
0594   0200             fdc_read_sect_l0: ; for each byte, we need to wait for drq to be high
0595   0200 1D C8 FF      mov al, [_fdc_stat_cmd]      ; read lost data flag 10+3+5+8+5+8
0596   0203 93 01         test al, $01                ; check drq bit
0597   0205 C6 14 02      jz fdc_read_sect_end
0598   0208 93 02         test al, $02                ; check drq bit
0599   020A C6 00 02      jz fdc_read_sect_l0
0600   020D 1D CB FF      mov al, [_fdc_data]     ; 
0601   0210 F7            stosb
0602   0211 0A 00 02      jmp fdc_read_sect_l0
0603   0214             fdc_read_sect_end:
0604   0214 50            mov a, di
0605   0215 5F 60 23      sub a, transient_area
0606   0218 F0            pop di
0607   0219 FD 4D 60 23   mov si, transient_area
0608   021D 39            mov c, a  ; copy sector over to user space
0609   021E 03            store
0610   021F 06            sysret
0611   0220             
0612   0220             ; sector size in c
0613   0220             ; sector in bl
0614   0220             ; track in bh
0615   0220             ; data pointer in si
0616   0220             syscall_fdc_write_sect:
0617   0220 07 51 02      call fdc_wait_not_busy
0618   0223 FD 3D CA FF   mov [_fdc_sector], bl
0619   0227 30            mov bl, bh
0620   0228 FD 3D C9 FF   mov [_fdc_track], bl
0621   022C FD 4F 60 23   mov di, transient_area    ; si = data source, di = destination 
0622   0230 04            load                    ; transfer data to kernel space!
0623   0231 FD 4D 60 23   mov si, transient_area
0624   0235 F2 C8 FF AA   mov byte [_fdc_stat_cmd], %10101010            ; 101, 0:single sector, 1: disable spinup, 0: no delay, 1: no precomp, 0: normal data mark
0625   0239 07 32 03      call fdc_wait_64us
0626   023C             fdc_write_sect_l0: ; for each byte, we need to wait for drq to be high
0627   023C 1D C8 FF      mov al, [_fdc_stat_cmd]         ; 10
0628   023F 93 01         test al, $01                    ; 4
0629   0241 C6 50 02      jz fdc_write_sect_end           ; 8
0630   0244 93 02         test al, $02                    ; 4
0631   0246 C6 3C 02      jz fdc_write_sect_l0            ; 8
0632   0249 F6            lodsb                           ; 7
0633   024A 3D CB FF      mov [_fdc_data], al             ; 10   
0634   024D 0A 3C 02      jmp fdc_write_sect_l0
0635   0250             fdc_write_sect_end:
0636   0250 06            sysret
0637   0251             
0638   0251             fdc_wait_not_busy:
0639   0251 DB            push al
0640   0252             fdc_wait_not_busy_l0:
0641   0252 1D C8 FF      mov al, [_fdc_stat_cmd]   
0642   0255 93 01         test al, $01               
0643   0257 C7 52 02      jnz fdc_wait_not_busy_l0          
0644   025A E8            pop al
0645   025B 09            ret
0646   025C             
0647   025C             ; track number in bl
0648   025C             fdc_format_mem_128:
0649   025C 3B 01 00      mov d, 1
0650   025F FD 4F 60 23   mov di, transient_area
0651   0263             ; 40 * FF
0652   0263 38 28 00      mov c, 40
0653   0266 19 FF         mov al, $ff
0654   0268             fdc_l0: 
0655   0268 F7            stosb
0656   0269 7E            dec c
0657   026A C7 68 02      jnz fdc_l0
0658   026D             ; 6 * 00
0659   026D             fdc_inner_loop:
0660   026D 38 06 00      mov c, 6
0661   0270 19 00         mov al, $00
0662   0272             fdc_l1:
0663   0272 F7            stosb
0664   0273 7E            dec c
0665   0274 C7 72 02      jnz fdc_l1
0666   0277             ; FE address mark
0667   0277             fdc_l2:
0668   0277 19 FE         mov al, $fe
0669   0279 F7            stosb
0670   027A             ; track number
0671   027A             fdc_l3:
0672   027A 1B            mov al, bl  ; track number in bl
0673   027B F7            stosb
0674   027C             ; side number
0675   027C             fdc_l4:
0676   027C 19 00         mov al, $00
0677   027E F7            stosb
0678   027F             ; sector number
0679   027F             fdc_l5:
0680   027F 13            mov a, d
0681   0280 F7            stosb
0682   0281             ; sector length 128 bytes
0683   0281             fdc_l6:
0684   0281 19 00         mov al, $00
0685   0283 F7            stosb
0686   0284             ; 2 crc's
0687   0284             fdc_l7:
0688   0284 19 F7         mov al, $f7
0689   0286 F7            stosb
0690   0287             ; 11 times $ff
0691   0287 38 0B 00      mov c, 11
0692   028A 19 FF         mov al, $ff
0693   028C             fdc_l8:
0694   028C F7            stosb
0695   028D 7E            dec c
0696   028E C7 8C 02      jnz fdc_l8
0697   0291             ; 6 times 00
0698   0291 38 06 00      mov c, 6
0699   0294 19 00         mov al, $00
0700   0296             fdc_l9:
0701   0296 F7            stosb
0702   0297 7E            dec c
0703   0298 C7 96 02      jnz fdc_l9
0704   029B             ; FB data address mark
0705   029B 19 FB         mov al, $fb
0706   029D             fdc_l10:
0707   029D F7            stosb
0708   029E             ; 128 bytes sector data
0709   029E 38 80 00      mov c, 128
0710   02A1 19 E5         mov al, $E5
0711   02A3             fdc_l11:
0712   02A3 F7            stosb
0713   02A4 7E            dec c
0714   02A5 C7 A3 02      jnz fdc_l11
0715   02A8             ; 2 crc's
0716   02A8             fdc_l12:
0717   02A8 19 F7         mov al, $f7
0718   02AA F7            stosb
0719   02AB             ; 10 * $FF
0720   02AB 38 0A 00      mov c, 10
0721   02AE 19 FF         mov al, $ff
0722   02B0             fdc_l13:
0723   02B0 F7            stosb
0724   02B1 7E            dec c
0725   02B2 C7 B0 02      jnz fdc_l13
0726   02B5             ; check whether we did this 16 times
0727   02B5 79            inc d
0728   02B6 C5 11 00      cmp d, 17
0729   02B9 C7 6D 02      jne fdc_inner_loop
0730   02BC             ; 500 bytes of FF for end filler. wd1770 writes these until it finishes, so the number varies. usually it writes ~450 bytes
0731   02BC 38 F4 01      mov c, 500
0732   02BF 19 FF         mov al, $ff
0733   02C1             fdc_format_footer:
0734   02C1             fdc_footer_drq_loop:
0735   02C1 F7            stosb
0736   02C2 7E            dec c
0737   02C3 C7 C1 02      jnz fdc_footer_drq_loop
0738   02C6 09            ret
0739   02C7             
0740   02C7             ; track number in bl
0741   02C7             fdc_format_mem_512:
0742   02C7 3B 01 00      mov d, 1
0743   02CA FD 4F 60 23   mov di, transient_area
0744   02CE             ; 40 * FF
0745   02CE 38 28 00      mov c, 40
0746   02D1 19 FF         mov al, $ff
0747   02D3             fdc_512_l0: 
0748   02D3 F7            stosb
0749   02D4 7E            dec c
0750   02D5 C7 D3 02      jnz fdc_512_l0
0751   02D8             ; 6 * 00
0752   02D8             fdc_512_inner_loop:
0753   02D8 38 06 00      mov c, 6
0754   02DB 19 00         mov al, $00
0755   02DD             fdc_512_l1:
0756   02DD F7            stosb
0757   02DE 7E            dec c
0758   02DF C7 DD 02      jnz fdc_512_l1
0759   02E2             ; FE address mark
0760   02E2             fdc_512_l2:
0761   02E2 19 FE         mov al, $fe
0762   02E4 F7            stosb
0763   02E5             ; track number
0764   02E5             fdc_512_l3:
0765   02E5 1B            mov al, bl ; track number was in bl
0766   02E6 F7            stosb
0767   02E7             ; side number
0768   02E7             fdc_512_l4:
0769   02E7 19 00         mov al, $00
0770   02E9 F7            stosb
0771   02EA             ; sector number
0772   02EA             fdc_512_l5:
0773   02EA 13            mov a, d
0774   02EB F7            stosb
0775   02EC             ; sector length 512 bytes
0776   02EC             fdc_512_l6:
0777   02EC 19 02         mov al, $02
0778   02EE F7            stosb
0779   02EF             ; 2 crc's
0780   02EF             fdc_512_l7:
0781   02EF 19 F7         mov al, $f7
0782   02F1 F7            stosb
0783   02F2             ; 11 times $ff
0784   02F2 38 0B 00      mov c, 11
0785   02F5 19 FF         mov al, $ff
0786   02F7             fdc_512_l8:
0787   02F7 F7            stosb
0788   02F8 7E            dec c
0789   02F9 C7 F7 02      jnz fdc_512_l8
0790   02FC             ; 6 times 00
0791   02FC 38 06 00      mov c, 6
0792   02FF 19 00         mov al, $00
0793   0301             fdc_512_l9:
0794   0301 F7            stosb
0795   0302 7E            dec c
0796   0303 C7 01 03      jnz fdc_512_l9
0797   0306             ; FB data address mark
0798   0306 19 FB         mov al, $fb
0799   0308             fdc_512_l10:
0800   0308 F7            stosb
0801   0309             ; 128 bytes sector data
0802   0309 38 00 02      mov c, 512
0803   030C 19 E5         mov al, $E5
0804   030E             fdc_512_l11:
0805   030E F7            stosb
0806   030F 7E            dec c
0807   0310 C7 0E 03      jnz fdc_512_l11
0808   0313             ; 2 crc's
0809   0313             fdc_512_l12:
0810   0313 19 F7         mov al, $f7
0811   0315 F7            stosb
0812   0316             ; 10 * $FF
0813   0316 38 0A 00      mov c, 10
0814   0319 19 FF         mov al, $ff
0815   031B             fdc_512_l13:
0816   031B F7            stosb
0817   031C 7E            dec c
0818   031D C7 1B 03      jnz fdc_512_l13
0819   0320             ; check whether we did this 16 times
0820   0320 79            inc d
0821   0321 C5 06 00      cmp d, 6
0822   0324 C7 D8 02      jne fdc_512_inner_loop
0823   0327             ; 500 bytes of FF for end filler. wd1770 writes these until it finishes, so the number varies. usually it writes ~450 bytes
0824   0327 38 F4 01      mov c, 500
0825   032A 19 FF         mov al, $ff
0826   032C             fdc_512_format_footer:
0827   032C             fdc_512_footer_drq_loop:
0828   032C F7            stosb
0829   032D 7E            dec c
0830   032E C7 2C 03      jnz fdc_512_footer_drq_loop
0831   0331 09            ret
0832   0332             
0833   0332             ; fetch is 2 cycles long when 'display_reg_load' is false.
0834   0332             ; 64us amounts to 160 cycles of the 2.5mhz clock
0835   0332             ; call u16 is 14 cycles long
0836   0332             ; 160 - 5 - 14 = 
0837   0332             fdc_wait_64us:
0838   0332 3A 0D         mov cl, 13                       ; 5 cycles
0839   0334             fdc_wait_64_loop:
0840   0334 81            dec cl                           ; 3 cycles
0841   0335 C7 34 03      jnz fdc_wait_64_loop             ; 8 cycles
0842   0338 09            ret
0843   0339             
0844   0339             ; number of seconds in b
0845   0339             wait_xs:
0846   0339 C0 00 00      cmp b, 0
0847   033C C6 47 03      je wait_xs_end
0848   033F 07 48 03      call wait_1s
0849   0342 FD 7D         dec b
0850   0344 0A 39 03      jmp wait_xs
0851   0347             wait_xs_end:
0852   0347 09            ret
0853   0348             
0854   0348             wait_1s:
0855   0348 DB            push al
0856   0349 D9            push c
0857   034A 19 03         mov al, 3
0858   034C             wait_1s_l0:
0859   034C 38 FF FF      mov c, 65535                       
0860   034F             wait_1s_l1:
0861   034F 7E            dec c        ; 4
0862   0350 C7 4F 03      jnz wait_1s_l1   ; 8
0863   0353 80            dec al
0864   0354 C7 4C 03      jnz wait_1s_l0
0865   0357 E6            pop c
0866   0358 E8            pop al
0867   0359 09            ret
0868   035A             
0869   035A             ; ------------------------------------------------------------------------------------------------------------------;
0870   035A             ; system syscalls
0871   035A             ; ------------------------------------------------------------------------------------------------------------------;
0872   035A             system_jmptbl:
0873   035A 90 03         .dw system_uname
0874   035C 97 03         .dw system_whoami
0875   035E 6A 03         .dw system_poke
0876   0360 6D 03         .dw system_bootloader_install
0877   0362 68 03         .dw system_peek
0878   0364             syscall_system:
0879   0364 FD 0A 5A 03   jmp [system_jmptbl + al]
0880   0368             
0881   0368             ; param register address in register d
0882   0368             ; param value in register bl
0883   0368             system_peek:
0884   0368 32            mov bl, [d]
0885   0369 06            sysret
0886   036A             
0887   036A             ; param register address in register d
0888   036A             ; param value in register bl
0889   036A             system_poke:
0890   036A FD 3E         mov [d], bl
0891   036C 06            sysret
0892   036D             
0893   036D             ; kernel LBA address in 'b'
0894   036D             system_bootloader_install:
0895   036D D8            push b
0896   036E 26 00 00      mov b, 0
0897   0371 38 00 00      mov c, 0
0898   0374 22 01         mov ah, $01                 ; 1 sector
0899   0376 3B 60 23      mov d, transient_area
0900   0379 07 21 06      call ide_read_sect          ; read sector
0901   037C E5            pop b
0902   037D FD 44 FE 01   mov [d + 510], b            ; update LBA address
0903   0381 26 00 00      mov b, 0
0904   0384 38 00 00      mov c, 0
0905   0387 22 01         mov ah, $01                 ; 1 sector
0906   0389 3B 60 23      mov d, transient_area
0907   038C 07 47 06      call ide_write_sect         ; write sector
0908   038F 06            sysret
0909   0390             
0910   0390             system_uname:
0911   0390 3B 3A 0F      mov d, s_uname
0912   0393 07 F4 09      call _puts
0913   0396 06            sysret
0914   0397             
0915   0397             system_whoami:
0916   0397 06            sysret
0917   0398             
0918   0398             ; reboot system
0919   0398             syscall_reboot:
0920   0398 FD D7 FF FF   push word $ffff 
0921   039C FD DB 00      push byte %00000000             ; dma_ack = 0, interrupts disabled, mode = supervisor, paging = off, halt=0, display_reg_load=0, dir=0
0922   039F FD D7 90 01   push word bios_reset_vector     ; and then push reset vector of the shell to the stack
0923   03A3 06            sysret
0924   03A4             
0925   03A4             
0926   03A4             ; ------------------------------------------------------------------------------------------------------------------;
0927   03A4             ; exceptions code block
0928   03A4             ; ------------------------------------------------------------------------------------------------------------------;
0929   03A4             ; privilege exception
0930   03A4             ; ------------------------------------------------------------------------------------------------------------------;
0931   03A4             trap_privilege:
0932   03A4 0A 98 03      jmp syscall_reboot
0933   03A7 DA            push d
0934   03A8 3B 51 10      mov d, s_priviledge
0935   03AB 07 F4 09      call _puts
0936   03AE E7            pop d
0937   03AF 06            sysret
0938   03B0             
0939   03B0             ; ------------------------------------------------------------------------------------------------------------------;
0940   03B0             ; breakpoint
0941   03B0             ; important: values in the stack are being pushed in big endian. i.e.: msb at low address
0942   03B0             ; and lsb at high address. *** need to correct this in the microcode and make it little endian again ***
0943   03B0             ; ------------------------------------------------------------------------------------------------------------------;
0944   03B0             syscall_break:
0945   03B0 4B            pusha
0946   03B1             syscall_break_prompt:
0947   03B1 3B 6B 04      mov d, s_break1
0948   03B4 07 F4 09      call _puts
0949   03B7 07 A1 09      call printnl
0950   03BA 07 F6 0A      call scan_u16d
0951   03BD AF 00 00      cmp a, 0
0952   03C0 C6 CB 03      je syscall_break_regs
0953   03C3 AF 01 00      cmp a, 1
0954   03C6 C6 EE 03      je syscall_break_mem
0955   03C9             syscall_break_end:  
0956   03C9 4C            popa
0957   03CA 06            sysret
0958   03CB             syscall_break_regs:
0959   03CB 48            mov a, sp
0960   03CC 53 0E 00      add a, 14               ; back-track 7 registers
0961   03CF 3C            mov d, a
0962   03D0 3A 07         mov cl, 7
0963   03D2             syscall_regs_l0:
0964   03D2 2A            mov b, [d]
0965   03D3 FD AB         swp b
0966   03D5 07 50 0A      call print_u16x         ; print register value
0967   03D8 07 A1 09      call printnl
0968   03DB 63 02 00      sub d, 2
0969   03DE 71 01         sub cl, 1
0970   03E0 C3 00         cmp cl, 0
0971   03E2 C7 D2 03      jne syscall_regs_l0
0972   03E5 0A B1 03      jmp syscall_break_prompt
0973   03E8 07 A1 09      call printnl
0974   03EB 0A B1 03      jmp syscall_break_prompt
0975   03EE             syscall_break_mem:
0976   03EE 07 A1 09      call printnl
0977   03F1 07 72 0A      call scan_u16x
0978   03F4 4D            mov si, a               ; data source from user space
0979   03F5 FD 4F 60 21   mov di, scrap_sector    ; destination in kernel space
0980   03F9 38 00 02      mov c, 512
0981   03FC 04            load                    ; transfer data to kernel space!
0982   03FD 3B 60 21      mov d, scrap_sector     ; dump pointer in d
0983   0400 38 00 00      mov c, 0
0984   0403             dump_loop:
0985   0403 84            mov al, cl
0986   0404 87 0F         and al, $0f
0987   0406 C6 54 04      jz print_base
0988   0409             back:
0989   0409 1E            mov al, [d]             ; read byte
0990   040A 2F            mov bl, al
0991   040B 07 94 0A      call print_u8x
0992   040E 10 00 20      mov a, $2000
0993   0411 05 03         syscall sys_io          ; space
0994   0413 84            mov al, cl
0995   0414 87 0F         and al, $0f
0996   0416 B9 0F         cmp al, $0f
0997   0418 C6 29 04      je print_ascii
0998   041B             back1:
0999   041B 79            inc d
1000   041C 78            inc c
1001   041D C2 00 02      cmp c, 512
1002   0420 C7 03 04      jne dump_loop
1003   0423 07 A1 09      call printnl
1004   0426 0A B1 03      jmp syscall_break_prompt  ; go to syscall_break return point
1005   0429             print_ascii:
1006   0429 10 00 20      mov a, $2000
1007   042C 05 03         syscall sys_io
1008   042E 63 10 00      sub d, 16
1009   0431 26 10 00      mov b, 16
1010   0434             print_ascii_l:
1011   0434 79            inc d
1012   0435 1E            mov al, [d]               ; read byte
1013   0436 B9 20         cmp al, $20
1014   0438 C8 40 04      jlu dot
1015   043B B9 7E         cmp al, $7e
1016   043D D0 48 04      jleu ascii
1017   0440             dot:
1018   0440 10 00 2E      mov a, $2e00
1019   0443 05 03         syscall sys_io
1020   0445 0A 4D 04      jmp ascii_continue
1021   0448             ascii:
1022   0448 23            mov ah, al
1023   0449 19 00         mov al, 0
1024   044B 05 03         syscall sys_io
1025   044D             ascii_continue:
1026   044D FD A9 34 04   loopb print_ascii_l
1027   0451 0A 1B 04      jmp back1
1028   0454             print_base:
1029   0454 07 A1 09      call printnl
1030   0457 2D            mov b, d
1031   0458 61 60 21      sub b, scrap_sector      ; remove this later and fix address bases which display incorrectly
1032   045B 07 50 0A      call print_u16x          ; display row
1033   045E 10 00 3A      mov a, $3a00
1034   0461 05 03         syscall sys_io
1035   0463 10 00 20      mov a, $2000
1036   0466 05 03         syscall sys_io
1037   0468 0A 09 04      jmp back
1038   046B             
1039   046B             s_break1:  
1040   046B 0A 64 65 62   .db "\ndebugger entry point.\n"
1040   046F 75 67 67 65 
1040   0473 72 20 65 6E 
1040   0477 74 72 79 20 
1040   047B 70 6F 69 6E 
1040   047F 74 2E 0A 
1041   0482 30 2E 20 73   .db "0. show registers\n"
1041   0486 68 6F 77 20 
1041   048A 72 65 67 69 
1041   048E 73 74 65 72 
1041   0492 73 0A 
1042   0494 31 2E 20 73   .db "1. show 512b ram block\n"
1042   0498 68 6F 77 20 
1042   049C 35 31 32 62 
1042   04A0 20 72 61 6D 
1042   04A4 20 62 6C 6F 
1042   04A8 63 6B 0A 
1043   04AB 32 2E 20 63   .db "2. continue execution", 0
1043   04AF 6F 6E 74 69 
1043   04B3 6E 75 65 20 
1043   04B7 65 78 65 63 
1043   04BB 75 74 69 6F 
1043   04BF 6E 00 
1044   04C1             
1045   04C1             ; ------------------------------------------------------------------------------------------------------------------;
1046   04C1             ; divide by zero exception
1047   04C1             ; ------------------------------------------------------------------------------------------------------------------;
1048   04C1             trap_div_zero:
1049   04C1 D7            push a
1050   04C2 DA            push d
1051   04C3 E1            pushf
1052   04C4 3B 68 10      mov d, s_divzero
1053   04C7 07 F4 09      call _puts
1054   04CA EE            popf
1055   04CB E7            pop d
1056   04CC E4            pop a
1057   04CD 06            sysret ; enable interrupts
1058   04CE             
1059   04CE             ; ------------------------------------------------------------------------------------------------------------------;
1060   04CE             ; undefined opcode exception
1061   04CE             ; ------------------------------------------------------------------------------------------------------------------;
1062   04CE             trap_undef_opcode:
1063   04CE 06            sysret
1064   04CF             
1065   04CF             ; ------------------------------------------------------------------------------------------------------------------;
1066   04CF             ; real-time clock services syscall
1067   04CF             ; rtc i/o bank = ffa0 to ffaf
1068   04CF             ; ffa0 to ffa7 is scratch ram
1069   04CF             ; control register at $ffa8 [ w | r | s | cal4..cal0 ]
1070   04CF             ; al = 0..6 -> get
1071   04CF             ; al = 7..d -> set
1072   04CF             ; ------------------------------------------------------------------------------------------------------------------;
1073   04CF             syscall_rtc:
1074   04CF DB            push al
1075   04D0 DA            push d
1076   04D1 B9 06         cmp al, 6
1077   04D3 D1 E8 04      jgu syscall_rtc_set
1078   04D6             syscall_rtc_get:
1079   04D6 6A A9         add al, $a9             ; generate rtc address to get to address a9 of clock
1080   04D8 22 FF         mov ah, $ff    
1081   04DA 3C            mov d, a                ; get to ffa9 + offset
1082   04DB F2 A8 FF 40   mov byte[$ffa8], $40    ; set r bit to 1
1083   04DF 1E            mov al, [d]             ; get data
1084   04E0 F2 A8 FF 00   mov byte[$ffa8], 0      ; reset r bit
1085   04E4 23            mov ah, al
1086   04E5 E7            pop d
1087   04E6 E8            pop al
1088   04E7 06            sysret
1089   04E8             syscall_rtc_set:
1090   04E8 DD            push bl
1091   04E9 99            mov bl, ah              ; set data aside
1092   04EA 6A A2         add al, $a2             ; generate rtc address to get to address a9 of clock
1093   04EC 22 FF         mov ah, $ff    
1094   04EE 3C            mov d, a                ; get to ffa9 + offset
1095   04EF 1B            mov al, bl              ; get data back
1096   04F0 F2 A8 FF 80   mov byte[$ffa8], $80    ; set w bit to 1
1097   04F4 3E            mov [d], al             ; set data
1098   04F5 F2 A8 FF 00   mov byte[$ffa8], 0      ; reset write bit
1099   04F9 EA            pop bl
1100   04FA E7            pop d
1101   04FB E8            pop al
1102   04FC 06            sysret
1103   04FD             
1104   04FD             datetime_serv_tbl:
1105   04FD 05 05         .dw print_date
1106   04FF 79 05         .dw set_date
1107   0501             syscall_datetime:
1108   0501 FD 0A FD 04   jmp [datetime_serv_tbl + al]      
1109   0505             print_date:
1110   0505 10 00 0D      mov a, $0d00           ; print carriage return char
1111   0508 19 03         mov al, 3
1112   050A 05 01         syscall sys_rtc        ; get week
1113   050C 1A            mov al, ah
1114   050D 22 00         mov ah, 0
1115   050F FD 9D 02      shl a, 2          
1116   0512 3B F2 10      mov d, s_week
1117   0515 59            add d, a
1118   0516 07 F4 09      call _puts
1119   0519 10 00 20      mov a, $2000
1120   051C 05 03         syscall sys_io         ; display ' '
1121   051E 19 04         mov al, 4
1122   0520 05 01         syscall sys_rtc        ; get day
1123   0522 99            mov bl, ah
1124   0523 07 94 0A      call print_u8x
1125   0526 10 00 20      mov a, $2000
1126   0529 05 03         syscall sys_io         ; display ' '
1127   052B             ; there is a problem with the month displaying
1128   052B             ; the month is stored as bcd. so when retrieving the month, the value will be in binary
1129   052B             ; even though it is to be understood as bcd.
1130   052B             ; when retrieving the value and adding the string table address offset the value will go overboard!  
1131   052B 19 05         mov al, 05
1132   052D 05 01         syscall sys_rtc        ; get month
1133   052F 1A            mov al, ah
1134   0530 22 00         mov ah, 0
1135   0532 FD 9D 02      shl a, 2          
1136   0535 3B BE 10      mov d, s_months
1137   0538 59            add d, a
1138   0539 07 F4 09      call _puts
1139   053C 10 00 20      mov a, $2000
1140   053F 05 03         syscall sys_io         ; display ' '
1141   0541 2E 20         mov bl, $20
1142   0543 07 94 0A      call print_u8x         ; print 20 for year prefix
1143   0546 19 06         mov al, 06
1144   0548 05 01         syscall sys_rtc        ; get year
1145   054A 99            mov bl, ah
1146   054B 07 94 0A      call print_u8x
1147   054E 10 00 20      mov a, $2000  
1148   0551 05 03         syscall sys_io         ; display ' '
1149   0553 19 02         mov al, 2
1150   0555 05 01         syscall sys_rtc        ; get hours
1151   0557 99            mov bl, ah
1152   0558 07 94 0A      call print_u8x
1153   055B 10 00 3A      mov a, $3a00    
1154   055E 05 03         syscall sys_io         ; display ':'
1155   0560 19 01         mov al, 01
1156   0562 05 01         syscall sys_rtc        ; get minutes
1157   0564 99            mov bl, ah
1158   0565 07 94 0A      call print_u8x
1159   0568 10 00 3A      mov a, $3a00  
1160   056B 05 03         syscall sys_io         ; display ':'
1161   056D 19 00         mov al, 0
1162   056F 05 01         syscall sys_rtc        ; get seconds
1163   0571 99            mov bl, ah
1164   0572 07 94 0A      call print_u8x
1165   0575 07 A1 09      call printnl
1166   0578 06            sysret
1167   0579             set_date:
1168   0579 3B 83 10      mov d, s_set_year
1169   057C 07 F4 09      call _puts
1170   057F 07 DF 0A      call scan_u8x          ; read integer into a
1171   0582 FD 9D 08      shl a, 8               ; only al used, move to ah
1172   0585 19 0D         mov al, 0dh            ; set rtc year
1173   0587 05 01         syscall sys_rtc        ; set rtc
1174   0589 3B 8A 10      mov d, s_set_month
1175   058C 07 F4 09      call _puts
1176   058F 07 DF 0A      call scan_u8x          ; read integer into a
1177   0592 FD 9D 08      shl a, 8               ; only al used, move to ah
1178   0595 19 0C         mov al, 0ch            ; set rtc month
1179   0597 05 01         syscall sys_rtc        ; set rtc
1180   0599 3B 92 10      mov d, s_set_day
1181   059C 07 F4 09      call _puts
1182   059F 07 DF 0A      call scan_u8x          ; read integer into a
1183   05A2 FD 9D 08      shl a, 8               ; only al used, move to ah
1184   05A5 19 0B         mov al, 0bh            ; set rtc month
1185   05A7 05 01         syscall sys_rtc        ; set rtc
1186   05A9 3B 98 10      mov d, s_set_week
1187   05AC 07 F4 09      call _puts
1188   05AF 07 DF 0A      call scan_u8x          ; read integer into a
1189   05B2 FD 9D 08      shl a, 8               ; only al used, move to ah
1190   05B5 19 0A         mov al, 0ah            ; set rtc month
1191   05B7 05 01         syscall sys_rtc        ; set rtc
1192   05B9 3B A2 10      mov d, s_set_hours
1193   05BC 07 F4 09      call _puts
1194   05BF 07 DF 0A      call scan_u8x          ; read integer into a
1195   05C2 FD 9D 08      shl a, 8               ; only al used, move to ah
1196   05C5 19 09         mov al, 09h            ; set rtc month
1197   05C7 05 01         syscall sys_rtc        ; set rtc
1198   05C9 3B AA 10      mov d, s_set_minutes
1199   05CC 07 F4 09      call _puts
1200   05CF 07 DF 0A      call scan_u8x          ; read integer into a
1201   05D2 FD 9D 08      shl a, 8               ; only al used, move to ah
1202   05D5 19 08         mov al, 08h            ; set rtc month
1203   05D7 05 01         syscall sys_rtc        ; set rtc
1204   05D9 3B B4 10      mov d, s_set_seconds
1205   05DC 07 F4 09      call _puts
1206   05DF 07 DF 0A      call scan_u8x          ; read integer into a
1207   05E2 FD 9D 08      shl a, 8               ; only al used, move to ah
1208   05E5 19 07         mov al, 07h            ; set rtc month
1209   05E7 05 01         syscall sys_rtc        ; set rtc
1210   05E9 06            sysret
1211   05EA             
1212   05EA             ; ------------------------------------------------------------------------------------------------------------------;
1213   05EA             ; ide services syscall
1214   05EA             ; al = option
1215   05EA             ; 0 = ide reset, 1 = ide sleep, 2 = read sector, 3 = write sector
1216   05EA             ; ide read/write sector
1217   05EA             ; 512 bytes
1218   05EA             ; user buffer pointer in d
1219   05EA             ; ah = number of sectors
1220   05EA             ; cb = lba bytes 3..0
1221   05EA             ; ------------------------------------------------------------------------------------------------------------------;
1222   05EA             ide_serv_tbl:
1223   05EA F6 05         .dw ide_reset
1224   05EC 0A 06         .dw ide_sleep
1225   05EE 19 06         .dw ide_read_sect_wrapper
1226   05F0 1D 06         .dw ide_write_sect_wrapper
1227   05F2             syscall_ide:
1228   05F2 FD 0A EA 05   jmp [ide_serv_tbl + al]    
1229   05F6             
1230   05F6             ide_reset:      
1231   05F6 F2 D7 FF 04   mov byte[_ide_r7], 4            ; reset ide
1232   05FA 07 A3 06      call ide_wait                   ; wait for ide ready             
1233   05FD F2 D6 FF E0   mov byte[_ide_r6], $e0          ; lba3= 0, master, mode= lba        
1234   0601 F2 D1 FF 01   mov byte[_ide_r1], 1            ; 8-bit transfers      
1235   0605 F2 D7 FF EF   mov byte[_ide_r7], $ef          ; set feature command
1236   0609 06            sysret
1237   060A             ide_sleep:
1238   060A 07 A3 06      call ide_wait                   ; wait for ide ready             
1239   060D F2 D6 FF 40   mov byte [_ide_r6], %01000000   ; lba[3:0](reserved), bit 6=1
1240   0611 F2 D7 FF E6   mov byte [_ide_r7], $e6         ; sleep command
1241   0615 07 A3 06      call ide_wait                   ; wait for ide ready
1242   0618 06            sysret
1243   0619             ide_read_sect_wrapper:
1244   0619 07 21 06      call ide_read_sect
1245   061C 06            sysret
1246   061D             ide_write_sect_wrapper:
1247   061D 07 47 06      call ide_write_sect
1248   0620 06            sysret
1249   0621             ide_read_sect:
1250   0621 1A            mov al, ah
1251   0622 24            mov ah, bl
1252   0623 42 D2 FF      mov [_ide_r2], a                ; number of sectors (0..255)
1253   0626 1C            mov al, bh
1254   0627 3D D4 FF      mov [_ide_r4], al
1255   062A 12            mov a, c
1256   062B 3D D5 FF      mov [_ide_r5], al
1257   062E 1A            mov al, ah
1258   062F 87 0F         and al, %00001111
1259   0631 8B E0         or al, %11100000                ; mode lba, master
1260   0633 3D D6 FF      mov [_ide_r6], al
1261   0636             ide_read_sect_wait:
1262   0636 1D D7 FF      mov al, [_ide_r7]  
1263   0639 87 80         and al, $80                     ; busy flag
1264   063B C7 36 06      jnz ide_read_sect_wait
1265   063E 19 20         mov al, $20
1266   0640 3D D7 FF      mov [_ide_r7], al               ; read sector cmd
1267   0643 07 6D 06      call ide_read  
1268   0646 09            ret
1269   0647             ide_write_sect:
1270   0647 1A            mov al, ah
1271   0648 24            mov ah, bl
1272   0649 42 D2 FF      mov [_ide_r2], a                ; number of sectors (0..255)
1273   064C 1C            mov al, bh
1274   064D 3D D4 FF      mov [_ide_r4], al
1275   0650 12            mov a, c
1276   0651 3D D5 FF      mov [_ide_r5], al
1277   0654 1A            mov al, ah
1278   0655 87 0F         and al, %00001111
1279   0657 8B E0         or al, %11100000                ; mode lba, master
1280   0659 3D D6 FF      mov [_ide_r6], al
1281   065C             ide_write_sect_wait:
1282   065C 1D D7 FF      mov al, [_ide_r7]  
1283   065F 87 80         and al, $80                     ; busy flag
1284   0661 C7 5C 06      jnz ide_write_sect_wait
1285   0664 19 30         mov al, $30
1286   0666 3D D7 FF      mov [_ide_r7], al               ; write sector cmd
1287   0669 07 88 06      call ide_write      
1288   066C 09            ret
1289   066D             
1290   066D             ;----------------------------------------------------------------------------------------------------;
1291   066D             ; read ide data
1292   066D             ; pointer in d
1293   066D             ;----------------------------------------------------------------------------------------------------;
1294   066D             ide_read:
1295   066D DA            push d
1296   066E             ide_read_loop:
1297   066E 1D D7 FF      mov al, [_ide_r7]  
1298   0671 87 80         and al, 80h                     ; busy flag
1299   0673 C7 6E 06      jnz ide_read_loop               ; wait loop
1300   0676 1D D7 FF      mov al, [_ide_r7]
1301   0679 87 08         and al, %00001000               ; drq flag
1302   067B C6 86 06      jz ide_read_end
1303   067E 1D D0 FF      mov al, [_ide_r0]
1304   0681 3E            mov [d], al
1305   0682 79            inc d
1306   0683 0A 6E 06      jmp ide_read_loop
1307   0686             ide_read_end:
1308   0686 E7            pop d
1309   0687 09            ret
1310   0688             
1311   0688             ;----------------------------------------------------------------------------------------------------;
1312   0688             ; write ide data
1313   0688             ; data pointer in d
1314   0688             ;----------------------------------------------------------------------------------------------------;
1315   0688             ide_write:
1316   0688 DA            push d
1317   0689             ide_write_loop:
1318   0689 1D D7 FF      mov al, [_ide_r7]  
1319   068C 87 80         and al, 80h             ; busy flag
1320   068E C7 89 06      jnz ide_write_loop      ; wait loop
1321   0691 1D D7 FF      mov al, [_ide_r7]
1322   0694 87 08         and al, %00001000       ; drq flag
1323   0696 C6 A1 06      jz ide_write_end
1324   0699 1E            mov al, [d]
1325   069A 3D D0 FF      mov [_ide_r0], al
1326   069D 79            inc d 
1327   069E 0A 89 06      jmp ide_write_loop
1328   06A1             ide_write_end:
1329   06A1 E7            pop d
1330   06A2 09            ret
1331   06A3             
1332   06A3             ;----------------------------------------------------------------------------------------------------;
1333   06A3             ; wait for ide to be ready
1334   06A3             ;----------------------------------------------------------------------------------------------------;
1335   06A3             ide_wait:
1336   06A3 1D D7 FF      mov al, [_ide_r7]  
1337   06A6 87 80         and al, 80h        ; busy flag
1338   06A8 C7 A3 06      jnz ide_wait
1339   06AB 09            ret
1340   06AC             
1341   06AC             ;----------------------------------------------------------------------------------------------------;
1342   06AC             ; io syscall
1343   06AC             ;----------------------------------------------------------------------------------------------------;
1344   06AC             ; baud  divisor
1345   06AC             ; 50    2304
1346   06AC             ; 110   1047
1347   06AC             ; 300    384
1348   06AC             ; 600    192
1349   06AC             ; 1200    96
1350   06AC             ; 9600    12
1351   06AC             ; 19200    6
1352   06AC             ; 38400    3
1353   06AC             syscall_io_jmp:
1354   06AC 07 07         .dw syscall_io_putchar
1355   06AE 20 07         .dw syscall_io_getch
1356   06B0 B6 06         .dw syscall_io_uart_setup
1357   06B2             syscall_io:
1358   06B2 FD 0A AC 06   jmp [syscall_io_jmp + al]
1359   06B6             ; bit7 is the divisor latch access bit (dlab). it must be set high (logic 1) to access the divisor latches
1360   06B6             ; of the baud generator during a read or write operation. it must be set low (logic 0) to access the receiver
1361   06B6             ; buffer, the transmitter holding register, or the interrupt enable register.
1362   06B6             syscall_io_uart_setup:
1363   06B6 1D 1F 0F      mov al, [sys_uart0_lcr]
1364   06B9 8B 80         or al, $80                ; set dlab access bit
1365   06BB 3D 83 FF      mov [_uart0_lcr], al      ; 8 data, 2 stop, no parity by default
1366   06BE 1D 22 0F      mov al, [sys_uart0_div0]
1367   06C1 3D 80 FF      mov [_uart0_dlab_0], al   ; divisor latch byte 0
1368   06C4 1D 23 0F      mov al, [sys_uart0_div1]
1369   06C7 3D 81 FF      mov [_uart0_dlab_1], al   ; divisor latch byte 1      
1370   06CA 1D 1F 0F      mov al, [sys_uart0_lcr]
1371   06CD 87 7F         and al, $7f               ; clear dlab access bit 
1372   06CF 3D 83 FF      mov [_uart0_lcr], al
1373   06D2 1D 20 0F      mov al, [sys_uart0_inten]
1374   06D5 3D 81 FF      mov [_uart0_ier], al      ; interrupts
1375   06D8 1D 21 0F      mov al, [sys_uart0_fifoen]
1376   06DB 3D 82 FF      mov [_uart0_fcr], al      ; fifo control
1377   06DE             ; uart1:
1378   06DE 1D 24 0F      mov al, [sys_uart1_lcr]
1379   06E1 8B 80         or al, $80                ; set dlab access bit
1380   06E3 3D 8B FF      mov [_uart1_lcr], al      ; 8 data, 2 stop, no parity by default
1381   06E6 1D 27 0F      mov al, [sys_uart1_div0]
1382   06E9 3D 88 FF      mov [_uart1_dlab_0], al   ; divisor latch byte 0
1383   06EC 1D 28 0F      mov al, [sys_uart1_div1]
1384   06EF 3D 89 FF      mov [_uart1_dlab_1], al   ; divisor latch byte 1      
1385   06F2 1D 24 0F      mov al, [sys_uart1_lcr]
1386   06F5 87 7F         and al, $7f               ; clear dlab access bit 
1387   06F7 3D 8B FF      mov [_uart1_lcr], al
1388   06FA 1D 25 0F      mov al, [sys_uart1_inten]
1389   06FD 3D 89 FF      mov [_uart1_ier], al      ; interrupts
1390   0700 1D 26 0F      mov al, [sys_uart1_fifoen]
1391   0703 3D 8A FF      mov [_uart1_fcr], al      ; fifo control
1392   0706 06            sysret
1393   0707             
1394   0707             ; char in ah
1395   0707             syscall_io_putchar:
1396   0707             syscall_io_putchar_l0:
1397   0707 1D 85 FF      mov al, [_uart0_lsr]         ; read line status register
1398   070A 87 20         and al, $20
1399   070C C6 07 07      jz syscall_io_putchar_l0    
1400   070F 1A            mov al, ah
1401   0710 3D 80 FF      mov [_uart0_data], al        ; write char to transmitter holding register
1402   0713             ; write to uart1
1403   0713             syscall_io_putchar_l1:
1404   0713 1D 8D FF      mov al, [_uart1_lsr]         ; read line status register
1405   0716 87 20         and al, $20
1406   0718 C6 13 07      jz syscall_io_putchar_l1
1407   071B 1A            mov al, ah
1408   071C 3D 88 FF      mov [_uart1_data], al        ; write char to transmitter holding register
1409   071F 06            sysret
1410   0720             
1411   0720             ; char in ah
1412   0720             ; al = sucess code
1413   0720             syscall_io_getch:
1414   0720 D8            push b
1415   0721 DA            push d
1416   0722 FD 0C         sti
1417   0724             syscall_io_getch_l0:  
1418   0724 14 2B 0F      mov a, [fifo_out]
1419   0727 29 29 0F      mov b, [fifo_in]
1420   072A B0            cmp a, b
1421   072B C6 24 07      je syscall_io_getch_l0
1422   072E 3C            mov d, a
1423   072F 77            inc a
1424   0730 AF 60 21      cmp a, fifo + _fifo_size      ; check if pointer reached the end of the fifo
1425   0733 C7 39 07      jne syscall_io_getch_cont
1426   0736 10 60 11      mov a, fifo  
1427   0739             syscall_io_getch_cont:  
1428   0739 42 2B 0F      mov [fifo_out], a             ; update fifo pointer
1429   073C 1E            mov al, [d]                   ; get char
1430   073D 23            mov ah, al
1431   073E             ; here we just echo the char back to the console
1432   073E             syscall_io_getch_echo_l0:
1433   073E 1D 85 FF      mov al, [_uart0_lsr]         ; read line status register
1434   0741 87 20         and al, $20                 ; isolate transmitter empty
1435   0743 C6 3E 07      jz syscall_io_getch_echo_l0
1436   0746 1A            mov al, ah
1437   0747 3D 80 FF      mov [_uart0_data], al        ; write char to transmitter holding register
1438   074A             syscall_io_getch_echo_l1:
1439   074A 1D 8D FF      mov al, [_uart1_lsr]         ; read line status register
1440   074D 87 20         and al, $20                 ; isolate transmitter empty
1441   074F C6 4A 07      jz syscall_io_getch_echo_l1
1442   0752 1A            mov al, ah
1443   0753 3D 88 FF      mov [_uart1_data], al        ; write char to transmitter holding register
1444   0756             syscall_io_getch_noecho:
1445   0756 19 01         mov al, 1                    ; al = 1 means a char successfully received
1446   0758 E7            pop d
1447   0759 E5            pop b
1448   075A 06            sysret
1449   075B             
1450   075B             ;------------------------------------------------------------------------------------------------------;
1451   075B             ; file system data
1452   075B             ;------------------------------------------------------------------------------------------------------;
1453   075B             ; infor for : ide services interrupt
1454   075B             ; ide read/write 512-byte sector
1455   075B             ; al = option
1456   075B             ; user buffer pointer in d
1457   075B             ; ah = number of sectors
1458   075B             ; cb = lba bytes 3..0  
1459   075B             ;------------------------------------------------------------------------------------------------------;
1460   075B             ; file system data structure
1461   075B             ;------------------------------------------------------------------------------------------------------;
1462   075B             ; first directory on disk is the root directory '/'
1463   075B             file_system_jmptbl:
1464   075B 6E 07         .dw fs_cd                     
1465   075D 6F 07         .dw fs_ls                     
1466   075F 70 07         .dw fs_pwd                    
1467   0761 71 07         .dw fs_rmdir                  
1468   0763 6D 07         .dw fs_mkdir
1469   0765 72 07         .dw fs_rm                     
1470   0767 73 07         .dw fs_mv                     
1471   0769             
1472   0769             syscall_file_system:
1473   0769 FD 0A 5B 07   jmp [file_system_jmptbl + al]
1474   076D             
1475   076D             ;------------------------------------------------------------------------------------------------------;
1476   076D             ; create new directory
1477   076D             ;------------------------------------------------------------------------------------------------------;
1478   076D             ; search list for null name entry. add new directory to list
1479   076D             fs_mkdir:
1480   076D 06            sysret
1481   076E             
1482   076E             ;------------------------------------------------------------------------------------------------------;
1483   076E             ; cd
1484   076E             ;------------------------------------------------------------------------------------------------------;
1485   076E             ; new dirid in b
1486   076E             fs_cd:
1487   076E 06            sysret  
1488   076F             
1489   076F             ;------------------------------------------------------------------------------------------------------;
1490   076F             ; ls
1491   076F             ;------------------------------------------------------------------------------------------------------;
1492   076F             fs_ls:
1493   076F 06            sysret
1494   0770             
1495   0770             ;------------------------------------------------------------------------------------------------------;
1496   0770             ; pwd - print working directory
1497   0770             ;------------------------------------------------------------------------------------------------------;    
1498   0770             fs_pwd:
1499   0770 06            sysret
1500   0771             
1501   0771             ;------------------------------------------------------------------------------------------------------;
1502   0771             ; rmdir - remove dir by dirid
1503   0771             ;------------------------------------------------------------------------------------------------------;
1504   0771             fs_rmdir:
1505   0771 06            sysret
1506   0772             
1507   0772             ;------------------------------------------------------------------------------------------------------;
1508   0772             ; rm - remove file
1509   0772             ;------------------------------------------------------------------------------------------------------;
1510   0772             fs_rm:
1511   0772 06            sysret  
1512   0773             
1513   0773             ;------------------------------------------------------------------------------------------------------;
1514   0773             ; mv - move / change file name
1515   0773             ;------------------------------------------------------------------------------------------------------;
1516   0773             fs_mv:
1517   0773 06            sysret
1518   0774             
1519   0774             
1520   0774             ;----------------------------------------------------------------------------------------------;
1521   0774             ; get hex file
1522   0774             ; di = destination address
1523   0774             ; return length in bytes in c
1524   0774             ;----------------------------------------------------------------------------------------------;
1525   0774             _load_hex:
1526   0774 D7            push a
1527   0775 D8            push b
1528   0776 DA            push d
1529   0777 E2            push si
1530   0778 E3            push di
1531   0779 38 00 00      mov c, 0
1532   077C 50            mov a, di
1533   077D 3C            mov d, a          ; start of string data block
1534   077E 07 CF 08      call _gets        ; get program string
1535   0781 4D            mov si, a
1536   0782             __load_hex_loop:
1537   0782 F6            lodsb             ; load from [si] to al
1538   0783 B9 00         cmp al, 0         ; check if ascii 0
1539   0785 C6 93 07      jz __load_hex_ret
1540   0788 36            mov bh, al
1541   0789 F6            lodsb
1542   078A 2F            mov bl, al
1543   078B 07 85 08      call _atoi        ; convert ascii byte in b to int (to al)
1544   078E F7            stosb             ; store al to [di]
1545   078F 78            inc c
1546   0790 0A 82 07      jmp __load_hex_loop
1547   0793             __load_hex_ret:
1548   0793 F0            pop di
1549   0794 EF            pop si
1550   0795 E7            pop d
1551   0796 E5            pop b
1552   0797 E4            pop a
1553   0798 09            ret
1554   0799             
1555   0799             ; synopsis: look inside a certain directory for files/directories
1556   0799             ; before calling this function, cd into required directory
1557   0799             ; for each entry inside directory:
1558   0799             ;  if entry is a file:
1559   0799             ;    compare filename to searched filename
1560   0799             ;    if filenames are the same, print filename
1561   0799             ;  else if entry is a directory:
1562   0799             ;    cd to the given directory
1563   0799             ;    recursively call cmd_find
1564   0799             ;    cd outside previous directory
1565   0799             ;  if current entry == last entry, return
1566   0799             ; endfor
1567   0799             f_find:
1568   0799 09            ret
1569   079A             
1570   079A             
1571   079A             ; ---------------------------------------------------------------------
1572   079A             ; kernel reset vector
1573   079A             ; ---------------------------------------------------------------------
1574   079A             kernel_reset_vector:  
1575   079A FD 49 FF F7   mov bp, _stack_begin
1576   079E FD 47 FF F7   mov sp, _stack_begin
1577   07A2               
1578   07A2 19 A1         mov al, %10100001             ; mask out timer interrupt for now - enable uarts and fdc irqs 
1579   07A4 FD 0F         stomsk                        
1580   07A6 FD 0C         sti  
1581   07A8             
1582   07A8 0C            lodstat
1583   07A9 87 DF         and al, %11011111             ; disable display register loading
1584   07AB 0D            stostat
1585   07AC               
1586   07AC             ; reset fifo pointers
1587   07AC 10 60 11      mov a, fifo
1588   07AF 3B 29 0F      mov d, fifo_in
1589   07B2 43            mov [d], a
1590   07B3 3B 2B 0F      mov d, fifo_out
1591   07B6 43            mov [d], a  
1592   07B7 19 02         mov al, 2
1593   07B9 05 03         syscall sys_io                ; enable uart in interrupt mode
1594   07BB             
1595   07BB 3B 7E 0F      mov d, s_kernel_welcome
1596   07BE 07 F4 09      call _puts
1597   07C1             
1598   07C1 3B 1F 11      mov d, s_fdc_config
1599   07C4 07 F4 09      call _puts
1600   07C7 F2 C0 FF 0D   mov byte [_fdc_config], %00001101  ; %00001001 : turn led on / head load, disable double density, select side 0, select drive 0, do not select drive 1
1601   07CB F2 C8 FF 0B   mov byte [_fdc_stat_cmd], %00001011     ; leave this restore command in order to clear BUSY flag
1602   07CF F2 C9 FF 00   mov byte [_fdc_track], $00 ; reset track
1603   07D3             
1604   07D3 19 10         mov al, 16
1605   07D5 05 04         syscall sys_filesystem        ; set root dirid
1606   07D7             
1607   07D7 3B 42 10      mov d, s_prompt_init
1608   07DA 07 F4 09      call _puts
1609   07DD 3B 2F 0F      mov d, s_init_path
1610   07E0               ;syscall sys_create_proc       ; launch init as a new process
1611   07E0             
1612   07E0             ; file includes
1613   07E0             .include "bios.exp"         ; to obtain the bios_reset_vector location (for reboots)
0001+  07E0             boot_origin      .EQU  $8004
0002+  07E0             bios_uart        .EQU  $0002
0003+  07E0             bios_ide         .EQU  $0003
0004+  07E0             bios_reset_vector .EQU  $0190
0005+  07E0             ide_buffer       .EQU  $8404
0006+  07E0             noname.__puts    .EQU  $0252
0007+  07E0             noname.__print_u16d .EQU  $0379
0008+  07E0             xput_u8          .EQU  $023e
1614   07E0             .include "lib/stdio.asm"
0001+  07E0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0002+  07E0             ; stdio.s
0003+  07E0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0004+  07E0             .include "lib/string.asm"
0001++ 07E0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0002++ 07E0             ; string.s
0003++ 07E0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0004++ 07E0             
0005++ 07E0             
0006++ 07E0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0007++ 07E0             ; _strrev
0008++ 07E0             ; reverse a string
0009++ 07E0             ; d = string address
0010++ 07E0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0011++ 07E0             ; 01234
0012++ 07E0             _strrev:
0013++ 07E0 4B          	pusha
0014++ 07E1 07 27 08    	call _strlen	; length in c
0015++ 07E4 12          	mov a, c
0016++ 07E5 AF 01 00    	cmp a, 1
0017++ 07E8 D0 02 08    	jleu _strrev_end	; check string length. string len must be > 1
0018++ 07EB 7D          	dec a
0019++ 07EC FD 4E       	mov si, d	; beginning of string
0020++ 07EE FD 50       	mov di, d	; beginning of string (for destinations)
0021++ 07F0 59          	add d, a	; end of string
0022++ 07F1 12          	mov a, c
0023++ 07F2 FD 9B       	shr a		; divide by 2
0024++ 07F4 39          	mov c, a	; c now counts the steps
0025++ 07F5             _strrev_l0:
0026++ 07F5 32          	mov bl, [d]	; save load right-side char into bl
0027++ 07F6 F6          	lodsb		; load left-side char into al; increase si
0028++ 07F7 3E          	mov [d], al	; store left char into right side
0029++ 07F8 1B          	mov al, bl
0030++ 07F9 F7          	stosb		; store right-side char into left-side; increase di
0031++ 07FA 7E          	dec c
0032++ 07FB 7F          	dec d
0033++ 07FC C2 00 00    	cmp c, 0
0034++ 07FF C7 F5 07    	jne _strrev_l0
0035++ 0802             _strrev_end:
0036++ 0802 4C          	popa
0037++ 0803 09          	ret
0038++ 0804             	
0039++ 0804             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0040++ 0804             ; _strchr
0041++ 0804             ; search string in d for char in al
0042++ 0804             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0043++ 0804             _strchr:
0044++ 0804             _strchr_l0:
0045++ 0804 32          	mov bl, [d]
0046++ 0805 C1 00       	cmp bl, 0
0047++ 0807 C6 12 08    	je _strchr_end
0048++ 080A BA          	cmp al, bl
0049++ 080B C6 12 08    	je _strchr_end
0050++ 080E 79          	inc d
0051++ 080F 0A 04 08    	jmp _strchr_l0
0052++ 0812             _strchr_end:
0053++ 0812 1B          	mov al, bl
0054++ 0813 09          	ret
0055++ 0814             
0056++ 0814             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0057++ 0814             ; _strstr
0058++ 0814             ; find sub-string
0059++ 0814             ; str1 in si
0060++ 0814             ; str2 in di
0061++ 0814             ; si points to end of source string
0062++ 0814             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0063++ 0814             _strstr:
0064++ 0814 DB          	push al
0065++ 0815 DA          	push d
0066++ 0816 E3          	push di
0067++ 0817             _strstr_loop:
0068++ 0817 F3          	cmpsb					; compare a byte of the strings
0069++ 0818 C7 23 08    	jne _strstr_ret
0070++ 081B FC 00 00    	lea d, [di + 0]
0071++ 081E BD 00       	cmp byte[d], 0				; check if at end of string (null)
0072++ 0820 C7 17 08    	jne _strstr_loop				; equal chars but not at end
0073++ 0823             _strstr_ret:
0074++ 0823 F0          	pop di
0075++ 0824 E7          	pop d
0076++ 0825 E8          	pop al
0077++ 0826 09          	ret
0078++ 0827             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0079++ 0827             ; length of null terminated string
0080++ 0827             ; result in c
0081++ 0827             ; pointer in d
0082++ 0827             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0083++ 0827             _strlen:
0084++ 0827 DA          	push d
0085++ 0828 38 00 00    	mov c, 0
0086++ 082B             _strlen_l1:
0087++ 082B BD 00       	cmp byte [d], 0
0088++ 082D C6 35 08    	je _strlen_ret
0089++ 0830 79          	inc d
0090++ 0831 78          	inc c
0091++ 0832 0A 2B 08    	jmp _strlen_l1
0092++ 0835             _strlen_ret:
0093++ 0835 E7          	pop d
0094++ 0836 09          	ret
0095++ 0837             
0096++ 0837             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0097++ 0837             ; strcmp
0098++ 0837             ; compare two strings
0099++ 0837             ; str1 in si
0100++ 0837             ; str2 in di
0101++ 0837             ; create a string compairon instrucion ?????
0102++ 0837             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0103++ 0837             _strcmp:
0104++ 0837 DB          	push al
0105++ 0838 DA          	push d
0106++ 0839 E3          	push di
0107++ 083A E2          	push si
0108++ 083B             _strcmp_loop:
0109++ 083B F3          	cmpsb					; compare a byte of the strings
0110++ 083C C7 47 08    	jne _strcmp_ret
0111++ 083F FB FF FF    	lea d, [si +- 1]
0112++ 0842 BD 00       	cmp byte[d], 0				; check if at end of string (null)
0113++ 0844 C7 3B 08    	jne _strcmp_loop				; equal chars but not at end
0114++ 0847             _strcmp_ret:
0115++ 0847 EF          	pop si
0116++ 0848 F0          	pop di
0117++ 0849 E7          	pop d
0118++ 084A E8          	pop al
0119++ 084B 09          	ret
0120++ 084C             
0121++ 084C             
0122++ 084C             ; strcpy
0123++ 084C             ; copy null terminated string from si to di
0124++ 084C             ; source in si
0125++ 084C             ; destination in di
0126++ 084C             _strcpy:
0127++ 084C E2          	push si
0128++ 084D E3          	push di
0129++ 084E DB          	push al
0130++ 084F             _strcpy_l1:
0131++ 084F F6          	lodsb
0132++ 0850 F7          	stosb
0133++ 0851 B9 00       	cmp al, 0
0134++ 0853 C7 4F 08    	jne _strcpy_l1
0135++ 0856             _strcpy_end:
0136++ 0856 E8          	pop al
0137++ 0857 F0          	pop di
0138++ 0858 EF          	pop si
0139++ 0859 09          	ret
0140++ 085A             
0141++ 085A             ; strcat
0142++ 085A             ; concatenate a null terminated string into string at di, from string at si
0143++ 085A             ; source in si
0144++ 085A             ; destination in di
0145++ 085A             _strcat:
0146++ 085A E2          	push si
0147++ 085B E3          	push di
0148++ 085C D7          	push a
0149++ 085D DA          	push d
0150++ 085E 50          	mov a, di
0151++ 085F 3C          	mov d, a
0152++ 0860             _strcat_goto_end_l1:
0153++ 0860 BD 00       	cmp byte[d], 0
0154++ 0862 C6 69 08    	je _strcat_start
0155++ 0865 79          	inc d
0156++ 0866 0A 60 08    	jmp _strcat_goto_end_l1
0157++ 0869             _strcat_start:
0158++ 0869 FD 50       	mov di, d
0159++ 086B             _strcat_l1:
0160++ 086B F6          	lodsb
0161++ 086C F7          	stosb
0162++ 086D B9 00       	cmp al, 0
0163++ 086F C7 6B 08    	jne _strcat_l1
0164++ 0872             _strcat_end:
0165++ 0872 E7          	pop d
0166++ 0873 E4          	pop a
0167++ 0874 F0          	pop di
0168++ 0875 EF          	pop si
0169++ 0876 09          	ret
0170++ 0877             
0171++ 0877             
0005+  0877             
0006+  0877             
0007+  0877             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0008+  0877             ; convert ascii 'o'..'f' to integer 0..15
0009+  0877             ; ascii in bl
0010+  0877             ; result in al
0011+  0877             ; ascii for f = 0100 0110
0012+  0877             ; ascii for 9 = 0011 1001
0013+  0877             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0014+  0877             hex_ascii_encode:
0015+  0877 1B            mov al, bl
0016+  0878 93 40         test al, $40        ; test if letter or number
0017+  087A C7 80 08      jnz hex_letter
0018+  087D 87 0F         and al, $0f        ; get number
0019+  087F 09            ret
0020+  0880             hex_letter:
0021+  0880 87 0F         and al, $0f        ; get letter
0022+  0882 6A 09         add al, 9
0023+  0884 09            ret
0024+  0885             
0025+  0885             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0026+  0885             ; atoi
0027+  0885             ; 2 letter hex string in b
0028+  0885             ; 8bit integer returned in al
0029+  0885             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0030+  0885             _atoi:
0031+  0885 D8            push b
0032+  0886 07 77 08      call hex_ascii_encode      ; convert bl to 4bit code in al
0033+  0889 30            mov bl, bh
0034+  088A DB            push al          ; save a
0035+  088B 07 77 08      call hex_ascii_encode
0036+  088E EA            pop bl  
0037+  088F FD 9E 04      shl al, 4
0038+  0892 8C            or al, bl
0039+  0893 E5            pop b
0040+  0894 09            ret  
0041+  0895             
0042+  0895             
0043+  0895             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0044+  0895             ; scanf
0045+  0895             ; no need for explanations!
0046+  0895             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0047+  0895             scanf:
0048+  0895 09            ret
0049+  0896             
0050+  0896             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0051+  0896             ; itoa
0052+  0896             ; 8bit value in bl
0053+  0896             ; 2 byte ascii result in a
0054+  0896             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0055+  0896             _itoa:
0056+  0896 DA            push d
0057+  0897 D8            push b
0058+  0898 A7 00         mov bh, 0
0059+  089A FD A4 04      shr bl, 4  
0060+  089D 74            mov d, b
0061+  089E 1F 30 0B      mov al, [d + s_hex_digits]
0062+  08A1 23            mov ah, al
0063+  08A2               
0064+  08A2 E5            pop b
0065+  08A3 D8            push b
0066+  08A4 A7 00         mov bh, 0
0067+  08A6 FD 87 0F      and bl, $0f
0068+  08A9 74            mov d, b
0069+  08AA 1F 30 0B      mov al, [d + s_hex_digits]
0070+  08AD E5            pop b
0071+  08AE E7            pop d
0072+  08AF 09            ret
0073+  08B0             
0074+  08B0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0075+  08B0             ; hex string to binary
0076+  08B0             ; di = destination address
0077+  08B0             ; si = source
0078+  08B0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0079+  08B0             _hex_to_int:
0080+  08B0             _hex_to_int_l1:
0081+  08B0 F6            lodsb          ; load from [si] to al
0082+  08B1 B9 00         cmp al, 0        ; check if ascii 0
0083+  08B3 C6 C0 08      jz _hex_to_int_ret
0084+  08B6 36            mov bh, al
0085+  08B7 F6            lodsb
0086+  08B8 2F            mov bl, al
0087+  08B9 07 85 08      call _atoi        ; convert ascii byte in b to int (to al)
0088+  08BC F7            stosb          ; store al to [di]
0089+  08BD 0A B0 08      jmp _hex_to_int_l1
0090+  08C0             _hex_to_int_ret:
0091+  08C0 09            ret    
0092+  08C1             
0093+  08C1             
0094+  08C1             
0095+  08C1             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0096+  08C1             ; getchar
0097+  08C1             ; char in ah
0098+  08C1             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0099+  08C1             getch:
0100+  08C1 DB            push al
0101+  08C2             getch_retry:
0102+  08C2 19 01         mov al, 1
0103+  08C4 05 03         syscall sys_io      ; receive in ah
0104+  08C6 E8            pop al
0105+  08C7 09            ret
0106+  08C8             
0107+  08C8             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0108+  08C8             ; putchar
0109+  08C8             ; char in ah
0110+  08C8             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0111+  08C8             _putchar:
0112+  08C8 DB            push al
0113+  08C9 19 00         mov al, 0
0114+  08CB 05 03         syscall sys_io      ; char in ah
0115+  08CD E8            pop al
0116+  08CE 09            ret
0117+  08CF             
0118+  08CF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0119+  08CF             ;; input a string
0120+  08CF             ;; terminates with null
0121+  08CF             ;; pointer in d
0122+  08CF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0123+  08CF             _gets:
0124+  08CF D7            push a
0125+  08D0 DA            push d
0126+  08D1             _gets_loop:
0127+  08D1 19 01         mov al, 1
0128+  08D3 05 03         syscall sys_io      ; receive in ah
0129+  08D5 76 1B         cmp ah, 27
0130+  08D7 C6 F8 08      je _gets_ansi_esc
0131+  08DA 76 0A         cmp ah, $0a        ; lf
0132+  08DC C6 54 09      je _gets_end
0133+  08DF 76 0D         cmp ah, $0d        ; cr
0134+  08E1 C6 54 09      je _gets_end
0135+  08E4 76 5C         cmp ah, $5c        ; '\\'
0136+  08E6 C6 1A 09      je _gets_escape
0137+  08E9 76 08         cmp ah, $08      ; check for backspace
0138+  08EB C6 F4 08      je _gets_backspace
0139+  08EE 1A            mov al, ah
0140+  08EF 3E            mov [d], al
0141+  08F0 79            inc d
0142+  08F1 0A D1 08      jmp _gets_loop
0143+  08F4             _gets_backspace:
0144+  08F4 7F            dec d
0145+  08F5 0A D1 08      jmp _gets_loop
0146+  08F8             _gets_ansi_esc:
0147+  08F8 19 01         mov al, 1
0148+  08FA 05 03         syscall sys_io        ; receive in ah without echo
0149+  08FC 76 5B         cmp ah, '['
0150+  08FE C7 D1 08      jne _gets_loop
0151+  0901 19 01         mov al, 1
0152+  0903 05 03         syscall sys_io          ; receive in ah without echo
0153+  0905 76 64         cmp ah, 'd'
0154+  0907 C6 12 09      je _gets_left_arrow
0155+  090A 76 63         cmp ah, 'c'
0156+  090C C6 16 09      je _gets_right_arrow
0157+  090F 0A D1 08      jmp _gets_loop
0158+  0912             _gets_left_arrow:
0159+  0912 7F            dec d
0160+  0913 0A D1 08      jmp _gets_loop
0161+  0916             _gets_right_arrow:
0162+  0916 79            inc d
0163+  0917 0A D1 08      jmp _gets_loop
0164+  091A             _gets_escape:
0165+  091A 19 01         mov al, 1
0166+  091C 05 03         syscall sys_io      ; receive in ah
0167+  091E 76 6E         cmp ah, 'n'
0168+  0920 C6 3F 09      je _gets_lf
0169+  0923 76 72         cmp ah, 'r'
0170+  0925 C6 46 09      je _gets_cr
0171+  0928 76 30         cmp ah, '0'
0172+  092A C6 4D 09      je _gets_null
0173+  092D 76 5C         cmp ah, $5c  ; '\'
0174+  092F C6 38 09      je _gets_slash
0175+  0932 1A            mov al, ah        ; if not a known escape, it is just a normal letter
0176+  0933 3E            mov [d], al
0177+  0934 79            inc d
0178+  0935 0A D1 08      jmp _gets_loop
0179+  0938             _gets_slash:
0180+  0938 19 5C         mov al, $5c
0181+  093A 3E            mov [d], al
0182+  093B 79            inc d
0183+  093C 0A D1 08      jmp _gets_loop
0184+  093F             _gets_lf:
0185+  093F 19 0A         mov al, $0a
0186+  0941 3E            mov [d], al
0187+  0942 79            inc d
0188+  0943 0A D1 08      jmp _gets_loop
0189+  0946             _gets_cr:
0190+  0946 19 0D         mov al, $0d
0191+  0948 3E            mov [d], al
0192+  0949 79            inc d
0193+  094A 0A D1 08      jmp _gets_loop
0194+  094D             _gets_null:
0195+  094D 19 00         mov al, $00
0196+  094F 3E            mov [d], al
0197+  0950 79            inc d
0198+  0951 0A D1 08      jmp _gets_loop
0199+  0954             _gets_end:
0200+  0954 19 00         mov al, 0
0201+  0956 3E            mov [d], al        ; terminate string
0202+  0957 E7            pop d
0203+  0958 E4            pop a
0204+  0959 09            ret
0205+  095A             
0206+  095A             
0207+  095A             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0208+  095A             ;; input text
0209+  095A             ;; terminated with ctrl+d
0210+  095A             ;; pointer in d
0211+  095A             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0212+  095A             _gettxt:
0213+  095A D7            push a
0214+  095B DA            push d
0215+  095C             _gettxt_loop:
0216+  095C 19 01         mov al, 1
0217+  095E 05 03         syscall sys_io      ; receive in ah
0218+  0960 76 04         cmp ah, 4      ; eot
0219+  0962 C6 9B 09      je _gettxt_end
0220+  0965 76 08         cmp ah, $08      ; check for backspace
0221+  0967 C6 97 09      je _gettxt_backspace
0222+  096A 76 5C         cmp ah, $5c        ; '\'
0223+  096C C6 75 09      je _gettxt_escape
0224+  096F 1A            mov al, ah
0225+  0970 3E            mov [d], al
0226+  0971 79            inc d
0227+  0972 0A 5C 09      jmp _gettxt_loop
0228+  0975             _gettxt_escape:
0229+  0975 19 01         mov al, 1
0230+  0977 05 03         syscall sys_io      ; receive in ah
0231+  0979 76 6E         cmp ah, 'n'
0232+  097B C6 89 09      je _gettxt_lf
0233+  097E 76 72         cmp ah, 'r'
0234+  0980 C6 90 09      je _gettxt_cr
0235+  0983 1A            mov al, ah        ; if not a known escape, it is just a normal letter
0236+  0984 3E            mov [d], al
0237+  0985 79            inc d
0238+  0986 0A 5C 09      jmp _gettxt_loop
0239+  0989             _gettxt_lf:
0240+  0989 19 0A         mov al, $0a
0241+  098B 3E            mov [d], al
0242+  098C 79            inc d
0243+  098D 0A 5C 09      jmp _gettxt_loop
0244+  0990             _gettxt_cr:
0245+  0990 19 0D         mov al, $0d
0246+  0992 3E            mov [d], al
0247+  0993 79            inc d
0248+  0994 0A 5C 09      jmp _gettxt_loop
0249+  0997             _gettxt_backspace:
0250+  0997 7F            dec d
0251+  0998 0A 5C 09      jmp _gettxt_loop
0252+  099B             _gettxt_end:
0253+  099B 19 00         mov al, 0
0254+  099D 3E            mov [d], al        ; terminate string
0255+  099E E7            pop d
0256+  099F E4            pop a
0257+  09A0 09            ret
0258+  09A1             
0259+  09A1             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0260+  09A1             ; print new line
0261+  09A1             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0262+  09A1             printnl:
0263+  09A1 D7            push a
0264+  09A2 10 00 0A      mov a, $0a00
0265+  09A5 05 03         syscall sys_io
0266+  09A7 10 00 0D      mov a, $0d00
0267+  09AA 05 03         syscall sys_io
0268+  09AC E4            pop a
0269+  09AD 09            ret
0270+  09AE             
0271+  09AE             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0272+  09AE             ; _strtoint
0273+  09AE             ; 4 digit hex string number in d
0274+  09AE             ; integer returned in a
0275+  09AE             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0276+  09AE             _strtointx:
0277+  09AE D8            push b
0278+  09AF 32            mov bl, [d]
0279+  09B0 37            mov bh, bl
0280+  09B1 33 01 00      mov bl, [d + 1]
0281+  09B4 07 85 08      call _atoi        ; convert to int in al
0282+  09B7 23            mov ah, al        ; move to ah
0283+  09B8 33 02 00      mov bl, [d + 2]
0284+  09BB 37            mov bh, bl
0285+  09BC 33 03 00      mov bl, [d + 3]
0286+  09BF 07 85 08      call _atoi        ; convert to int in al
0287+  09C2 E5            pop b
0288+  09C3 09            ret
0289+  09C4             
0290+  09C4             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0291+  09C4             ; _strtoint
0292+  09C4             ; 5 digit base10 string number in d
0293+  09C4             ; integer returned in a
0294+  09C4             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0295+  09C4             _strtoint:
0296+  09C4 E2            push si
0297+  09C5 D8            push b
0298+  09C6 D9            push c
0299+  09C7 DA            push d
0300+  09C8 07 27 08      call _strlen      ; get string length in c
0301+  09CB 7E            dec c
0302+  09CC FD 4E         mov si, d
0303+  09CE 12            mov a, c
0304+  09CF FD 99         shl a
0305+  09D1 3B 48 0B      mov d, table_power
0306+  09D4 59            add d, a
0307+  09D5 38 00 00      mov c, 0
0308+  09D8             _strtoint_l0:
0309+  09D8 F6            lodsb      ; load ascii to al
0310+  09D9 B9 00         cmp al, 0
0311+  09DB C6 EE 09      je _strtoint_end
0312+  09DE 6F 30         sub al, $30    ; make into integer
0313+  09E0 22 00         mov ah, 0
0314+  09E2 2A            mov b, [d]
0315+  09E3 AC            mul a, b      ; result in b since it fits in 16bits
0316+  09E4 11            mov a, b
0317+  09E5 28            mov b, c
0318+  09E6 54            add a, b
0319+  09E7 39            mov c, a
0320+  09E8 63 02 00      sub d, 2
0321+  09EB 0A D8 09      jmp _strtoint_l0
0322+  09EE             _strtoint_end:
0323+  09EE 12            mov a, c
0324+  09EF E7            pop d
0325+  09F0 E6            pop c
0326+  09F1 E5            pop b
0327+  09F2 EF            pop si
0328+  09F3 09            ret
0329+  09F4             
0330+  09F4             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0331+  09F4             ; print null terminated string
0332+  09F4             ; pointer in d
0333+  09F4             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0334+  09F4             _puts:
0335+  09F4 D7            push a
0336+  09F5 DA            push d
0337+  09F6             _puts_l1:
0338+  09F6 1E            mov al, [d]
0339+  09F7 B9 00         cmp al, 0
0340+  09F9 C6 05 0A      jz _puts_end
0341+  09FC 23            mov ah, al
0342+  09FD 19 00         mov al, 0
0343+  09FF 05 03         syscall sys_io
0344+  0A01 79            inc d
0345+  0A02 0A F6 09      jmp _puts_l1
0346+  0A05             _puts_end:
0347+  0A05 E7            pop d
0348+  0A06 E4            pop a
0349+  0A07 09            ret
0350+  0A08             
0351+  0A08             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0352+  0A08             ; print n size string
0353+  0A08             ; pointer in d
0354+  0A08             ; size in c
0355+  0A08             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0356+  0A08             _putsn:
0357+  0A08 DB            push al
0358+  0A09 DA            push d
0359+  0A0A D9            push c
0360+  0A0B             _putsn_l0:
0361+  0A0B 1E            mov al, [d]
0362+  0A0C 23            mov ah, al
0363+  0A0D 19 00         mov al, 0
0364+  0A0F 05 03         syscall sys_io
0365+  0A11 79            inc d
0366+  0A12 7E            dec c  
0367+  0A13 C2 00 00      cmp c, 0
0368+  0A16 C7 0B 0A      jne _putsn_l0
0369+  0A19             _putsn_end:
0370+  0A19 E6            pop c
0371+  0A1A E7            pop d
0372+  0A1B E8            pop al
0373+  0A1C 09            ret
0374+  0A1D             
0375+  0A1D             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0376+  0A1D             ; print 16bit decimal number
0377+  0A1D             ; input number in a
0378+  0A1D             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0379+  0A1D             print_u16d:
0380+  0A1D D7            push a
0381+  0A1E D8            push b
0382+  0A1F FD D8         push g
0383+  0A21 26 10 27      mov b, 10000
0384+  0A24 AE            div a, b      ; get 10000's coeff.
0385+  0A25 07 49 0A      call print_number
0386+  0A28 11            mov a, b
0387+  0A29 26 E8 03      mov b, 1000
0388+  0A2C AE            div a, b      ; get 1000's coeff.
0389+  0A2D 07 49 0A      call print_number
0390+  0A30 11            mov a, b
0391+  0A31 26 64 00      mov b, 100
0392+  0A34 AE            div a, b
0393+  0A35 07 49 0A      call print_number
0394+  0A38 11            mov a, b
0395+  0A39 26 0A 00      mov b, 10
0396+  0A3C AE            div a, b
0397+  0A3D 07 49 0A      call print_number
0398+  0A40 1B            mov al, bl      ; 1's coeff in bl
0399+  0A41 07 49 0A      call print_number
0400+  0A44 FD F1         pop g
0401+  0A46 E5            pop b
0402+  0A47 E4            pop a
0403+  0A48 09            ret
0404+  0A49             
0405+  0A49             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0406+  0A49             ; print al
0407+  0A49             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0408+  0A49             print_number:
0409+  0A49 6A 30         add al, $30
0410+  0A4B 23            mov ah, al
0411+  0A4C 07 C8 08      call _putchar
0412+  0A4F 09            ret
0413+  0A50             
0414+  0A50             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0415+  0A50             ; print 16bit hex integer
0416+  0A50             ; integer value in reg b
0417+  0A50             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0418+  0A50             print_u16x:
0419+  0A50 D7            push a
0420+  0A51 D8            push b
0421+  0A52 DD            push bl
0422+  0A53 30            mov bl, bh
0423+  0A54 07 96 08      call _itoa        ; convert bh to char in a
0424+  0A57 2F            mov bl, al        ; save al
0425+  0A58 19 00         mov al, 0
0426+  0A5A 05 03         syscall sys_io        ; display ah
0427+  0A5C 24            mov ah, bl        ; retrieve al
0428+  0A5D 19 00         mov al, 0
0429+  0A5F 05 03         syscall sys_io        ; display al
0430+  0A61             
0431+  0A61 EA            pop bl
0432+  0A62 07 96 08      call _itoa        ; convert bh to char in a
0433+  0A65 2F            mov bl, al        ; save al
0434+  0A66 19 00         mov al, 0
0435+  0A68 05 03         syscall sys_io        ; display ah
0436+  0A6A 24            mov ah, bl        ; retrieve al
0437+  0A6B 19 00         mov al, 0
0438+  0A6D 05 03         syscall sys_io        ; display al
0439+  0A6F             
0440+  0A6F E5            pop b
0441+  0A70 E4            pop a
0442+  0A71 09            ret
0443+  0A72             
0444+  0A72             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0445+  0A72             ; input 16bit hex integer
0446+  0A72             ; read 16bit integer into a
0447+  0A72             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0448+  0A72             scan_u16x:
0449+  0A72 F8 10 00      enter 16
0450+  0A75 D8            push b
0451+  0A76 DA            push d
0452+  0A77             
0453+  0A77 FA F1 FF      lea d, [bp + -15]
0454+  0A7A 07 CF 08      call _gets        ; get number
0455+  0A7D             
0456+  0A7D 32            mov bl, [d]
0457+  0A7E 37            mov bh, bl
0458+  0A7F 33 01 00      mov bl, [d + 1]
0459+  0A82 07 85 08      call _atoi        ; convert to int in al
0460+  0A85 23            mov ah, al        ; move to ah
0461+  0A86             
0462+  0A86 33 02 00      mov bl, [d + 2]
0463+  0A89 37            mov bh, bl
0464+  0A8A 33 03 00      mov bl, [d + 3]
0465+  0A8D 07 85 08      call _atoi        ; convert to int in al
0466+  0A90             
0467+  0A90 E7            pop d
0468+  0A91 E5            pop b
0469+  0A92 F9            leave
0470+  0A93 09            ret
0471+  0A94             
0472+  0A94             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0473+  0A94             ; print 8bit hex integer
0474+  0A94             ; integer value in reg bl
0475+  0A94             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0476+  0A94             print_u8x:
0477+  0A94 D7            push a
0478+  0A95 DD            push bl
0479+  0A96             
0480+  0A96 07 96 08      call _itoa        ; convert bl to char in a
0481+  0A99 2F            mov bl, al        ; save al
0482+  0A9A 19 00         mov al, 0
0483+  0A9C 05 03         syscall sys_io        ; display ah
0484+  0A9E 24            mov ah, bl        ; retrieve al
0485+  0A9F 19 00         mov al, 0
0486+  0AA1 05 03         syscall sys_io        ; display al
0487+  0AA3             
0488+  0AA3 EA            pop bl
0489+  0AA4 E4            pop a
0490+  0AA5 09            ret
0491+  0AA6             
0492+  0AA6             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0493+  0AA6             ; print 8bit decimal unsigned number
0494+  0AA6             ; input number in al
0495+  0AA6             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0496+  0AA6             print_u8d:
0497+  0AA6 D7            push a
0498+  0AA7 D8            push b
0499+  0AA8 FD D8         push g
0500+  0AAA 22 00         mov ah, 0
0501+  0AAC 26 64 00      mov b, 100
0502+  0AAF AE            div a, b
0503+  0AB0 D8            push b      ; save remainder
0504+  0AB1 B9 00         cmp al, 0
0505+  0AB3 C6 BD 0A      je skip100
0506+  0AB6 6A 30         add al, $30
0507+  0AB8 23            mov ah, al
0508+  0AB9 19 00         mov al, 0
0509+  0ABB 05 03         syscall sys_io  ; print coeff
0510+  0ABD             skip100:
0511+  0ABD E4            pop a
0512+  0ABE 22 00         mov ah, 0
0513+  0AC0 26 0A 00      mov b, 10
0514+  0AC3 AE            div a, b
0515+  0AC4 D8            push b      ; save remainder
0516+  0AC5 B9 00         cmp al, 0
0517+  0AC7 C6 D1 0A      je skip10
0518+  0ACA 6A 30         add al, $30
0519+  0ACC 23            mov ah, al
0520+  0ACD 19 00         mov al, 0
0521+  0ACF 05 03         syscall sys_io  ; print coeff
0522+  0AD1             skip10:
0523+  0AD1 E4            pop a
0524+  0AD2 1B            mov al, bl
0525+  0AD3 6A 30         add al, $30
0526+  0AD5 23            mov ah, al
0527+  0AD6 19 00         mov al, 0
0528+  0AD8 05 03         syscall sys_io  ; print coeff
0529+  0ADA FD F1         pop g
0530+  0ADC E5            pop b
0531+  0ADD E4            pop a
0532+  0ADE 09            ret
0533+  0ADF             
0534+  0ADF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0535+  0ADF             ; input 8bit hex integer
0536+  0ADF             ; read 8bit integer into al
0537+  0ADF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0538+  0ADF             scan_u8x:
0539+  0ADF F8 04 00      enter 4
0540+  0AE2 D8            push b
0541+  0AE3 DA            push d
0542+  0AE4             
0543+  0AE4 FA FD FF      lea d, [bp + -3]
0544+  0AE7 07 CF 08      call _gets        ; get number
0545+  0AEA             
0546+  0AEA 32            mov bl, [d]
0547+  0AEB 37            mov bh, bl
0548+  0AEC 33 01 00      mov bl, [d + 1]
0549+  0AEF 07 85 08      call _atoi        ; convert to int in al
0550+  0AF2             
0551+  0AF2 E7            pop d
0552+  0AF3 E5            pop b
0553+  0AF4 F9            leave
0554+  0AF5 09            ret
0555+  0AF6             
0556+  0AF6             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0557+  0AF6             ; input decimal number
0558+  0AF6             ; result in a
0559+  0AF6             ; 655'\0'
0560+  0AF6             ; low--------high
0561+  0AF6             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0562+  0AF6             scan_u16d:
0563+  0AF6 F8 08 00      enter 8
0564+  0AF9 E2            push si
0565+  0AFA D8            push b
0566+  0AFB D9            push c
0567+  0AFC DA            push d
0568+  0AFD FA F9 FF      lea d, [bp +- 7]
0569+  0B00 07 CF 08      call _gets
0570+  0B03 07 27 08      call _strlen      ; get string length in c
0571+  0B06 7E            dec c
0572+  0B07 FD 4E         mov si, d
0573+  0B09 12            mov a, c
0574+  0B0A FD 99         shl a
0575+  0B0C 3B 48 0B      mov d, table_power
0576+  0B0F 59            add d, a
0577+  0B10 38 00 00      mov c, 0
0578+  0B13             mul_loop:
0579+  0B13 F6            lodsb      ; load ascii to al
0580+  0B14 B9 00         cmp al, 0
0581+  0B16 C6 29 0B      je mul_exit
0582+  0B19 6F 30         sub al, $30    ; make into integer
0583+  0B1B 22 00         mov ah, 0
0584+  0B1D 2A            mov b, [d]
0585+  0B1E AC            mul a, b      ; result in b since it fits in 16bits
0586+  0B1F 11            mov a, b
0587+  0B20 28            mov b, c
0588+  0B21 54            add a, b
0589+  0B22 39            mov c, a
0590+  0B23 63 02 00      sub d, 2
0591+  0B26 0A 13 0B      jmp mul_loop
0592+  0B29             mul_exit:
0593+  0B29 12            mov a, c
0594+  0B2A E7            pop d
0595+  0B2B E6            pop c
0596+  0B2C E5            pop b
0597+  0B2D EF            pop si
0598+  0B2E F9            leave
0599+  0B2F 09            ret
0600+  0B30             
0601+  0B30             
0602+  0B30 30 31 32 33 s_hex_digits:    .db "0123456789abcdef"  
0602+  0B34 34 35 36 37 
0602+  0B38 38 39 61 62 
0602+  0B3C 63 64 65 66 
0603+  0B40 1B 5B 32 6A s_telnet_clear:  .db "\033[2j\033[h", 0
0603+  0B44 1B 5B 68 00 
0604+  0B48             
0605+  0B48             table_power:
0606+  0B48 01 00         .dw 1
0607+  0B4A 0A 00         .dw 10
0608+  0B4C 64 00         .dw 100
0609+  0B4E E8 03         .dw 1000
0610+  0B50 10 27         .dw 100001615   0B52             .include "lib/ctype.asm"
0001+  0B52             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0002+  0B52             ; ctype.s
0003+  0B52             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0004+  0B52             
0005+  0B52             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0006+  0B52             ;; c character classification is an operation provided by a group of functions in the ansi c standard library
0007+  0B52             ;; for the c programming language. these functions are used to test characters for membership in a particular
0008+  0B52             ;; class of characters, such as alphabetic characters, control characters, etc. both single-byte, and wide
0009+  0B52             ;; characters are supported.
0010+  0B52             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0011+  0B52             ;; _isalnum 
0012+  0B52             ;; _isalpha 
0013+  0B52             ;; islower 
0014+  0B52             ;; isupper 
0015+  0B52             ;; _isdigit 
0016+  0B52             ;; isxdigit
0017+  0B52             ;; iscntrl 
0018+  0B52             ;; isgraph 
0019+  0B52             ;; _isspace 
0020+  0B52             ;; isblank 
0021+  0B52             ;; isprint 
0022+  0B52             ;; ispunct 
0023+  0B52             ;; tolower 
0024+  0B52             ;; toupper
0025+  0B52             
0026+  0B52             
0027+  0B52             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0028+  0B52             ;; is alphanumeric
0029+  0B52             ;; sets zf according with result
0030+  0B52             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0031+  0B52             _isalnum:
0032+  0B52 07 6F 0B    	call _isalpha
0033+  0B55 C6 5B 0B    	je _isalnum_exit
0034+  0B58 07 5C 0B    	call _isdigit
0035+  0B5B             _isalnum_exit:
0036+  0B5B 09          	ret	
0037+  0B5C             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0038+  0B5C             ;; is digit
0039+  0B5C             ;; sets zf according with result
0040+  0B5C             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0041+  0B5C             _isdigit:
0042+  0B5C DB          	push al
0043+  0B5D B9 30       	cmp al, '0'
0044+  0B5F C8 6B 0B    	jlu _isdigit_false
0045+  0B62 B9 39       	cmp al, '9'
0046+  0B64 D1 6B 0B    	jgu _isdigit_false
0047+  0B67 87 00       	and al, 0	; set zf
0048+  0B69 E8          	pop al
0049+  0B6A 09          	ret
0050+  0B6B             _isdigit_false:
0051+  0B6B 8B 01       	or al, 1	; clear zf
0052+  0B6D E8          	pop al
0053+  0B6E 09          	ret	
0054+  0B6F             	
0055+  0B6F             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0056+  0B6F             ;; is alpha
0057+  0B6F             ;; sets zf according with result
0058+  0B6F             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0059+  0B6F             _isalpha:
0060+  0B6F DB          	push al
0061+  0B70 B9 5F       	cmp al, '_'
0062+  0B72 C6 92 0B    	je _isalpha_true
0063+  0B75 B9 2E       	cmp al, '.'
0064+  0B77 C6 92 0B    	je _isalpha_true
0065+  0B7A B9 61       	cmp al, 'a'
0066+  0B7C C8 8E 0B    	jlu _isalpha_false
0067+  0B7F B9 7A       	cmp al, 'z'
0068+  0B81 D1 8E 0B    	jgu _isalpha_false
0069+  0B84 B9 7A       	cmp al, 'z'
0070+  0B86 D0 92 0B    	jleu _isalpha_true
0071+  0B89 B9 61       	cmp al, 'a'
0072+  0B8B C9 92 0B    	jgeu _isalpha_true
0073+  0B8E             _isalpha_false:
0074+  0B8E 8B 01       	or al, 1	; clear zf
0075+  0B90 E8          	pop al
0076+  0B91 09          	ret
0077+  0B92             _isalpha_true:
0078+  0B92 87 00       	and al, 0	; set zf
0079+  0B94 E8          	pop al
0080+  0B95 09          	ret
0081+  0B96             
0082+  0B96             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0083+  0B96             ;; is path-alpha
0084+  0B96             ;; sets zf according with result
0085+  0B96             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0086+  0B96             ispath:
0087+  0B96 DB          	push al
0088+  0B97 07 5C 0B    	call _isdigit
0089+  0B9A C6 C4 0B    	je ispath_true
0090+  0B9D B9 5F       	cmp al, '_'
0091+  0B9F C6 C4 0B    	je ispath_true
0092+  0BA2 B9 2F       	cmp al, '/'
0093+  0BA4 C6 C4 0B    	je ispath_true
0094+  0BA7 B9 2E       	cmp al, '.'
0095+  0BA9 C6 C4 0B    	je ispath_true
0096+  0BAC B9 61       	cmp al, 'a'
0097+  0BAE C8 C0 0B    	jlu ispath_false
0098+  0BB1 B9 7A       	cmp al, 'z'
0099+  0BB3 D1 C0 0B    	jgu ispath_false
0100+  0BB6 B9 7A       	cmp al, 'z'
0101+  0BB8 D0 C4 0B    	jleu ispath_true
0102+  0BBB B9 61       	cmp al, 'a'
0103+  0BBD C9 C4 0B    	jgeu ispath_true
0104+  0BC0             ispath_false:
0105+  0BC0 8B 01       	or al, 1	; clear zf
0106+  0BC2 E8          	pop al
0107+  0BC3 09          	ret
0108+  0BC4             ispath_true:
0109+  0BC4 87 00       	and al, 0	; set zf
0110+  0BC6 E8          	pop al
0111+  0BC7 09          	ret
0112+  0BC8             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0113+  0BC8             ;; is space
0114+  0BC8             ;; sets zf according with result
0115+  0BC8             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0116+  0BC8             _isspace:
0117+  0BC8 B9 20       	cmp al, $20		; ' '
0118+  0BCA C6 DE 0B    	je _isspace_exit
0119+  0BCD B9 09       	cmp al, $09		; '\t'
0120+  0BCF C6 DE 0B    	je _isspace_exit
0121+  0BD2 B9 0A       	cmp al, $0a		; '\n'
0122+  0BD4 C6 DE 0B    	je _isspace_exit
0123+  0BD7 B9 0D       	cmp al, $0d		; '\r'
0124+  0BD9 C6 DE 0B    	je _isspace_exit
0125+  0BDC B9 0B       	cmp al, $0b		; '\v'
0126+  0BDE             _isspace_exit:
0127+  0BDE 09          	ret	
0128+  0BDF             
0129+  0BDF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0130+  0BDF             ; to lower
0131+  0BDF             ; input in al
0132+  0BDF             ; output in al
0133+  0BDF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0134+  0BDF             _to_lower:
0135+  0BDF B9 7A       	cmp al, 'z'
0136+  0BE1 D1 E6 0B    	jgu _to_lower_ret
0137+  0BE4 6A 20       	add al, $20				; convert to lower case
0138+  0BE6             _to_lower_ret:
0139+  0BE6 09          	ret
0140+  0BE7             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0141+  0BE7             ; to upper
0142+  0BE7             ; input in al
0143+  0BE7             ; output in al
0144+  0BE7             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0145+  0BE7             _to_upper:
0146+  0BE7 B9 61       	cmp al, 'a'
0147+  0BE9 C8 EE 0B    	jlu _to_upper_ret
0148+  0BEC 6F 20       	sub al, $20			; convert to upper case
0149+  0BEE             _to_upper_ret:
0150+  0BEE 09          	ret
0151+  0BEF             
1616   0BEF             .include "lib/token.asm"
0001+  0BEF             toktyp_identifier  .equ 0
0002+  0BEF             toktyp_keyword     .equ 1
0003+  0BEF             toktyp_delimiter   .equ 2
0004+  0BEF             toktyp_string      .equ 3
0005+  0BEF             toktyp_char        .equ 4
0006+  0BEF             toktyp_numeric     .equ 5
0007+  0BEF             toktyp_end         .equ 6
0008+  0BEF             
0009+  0BEF             tok_null           .equ 0
0010+  0BEF             tok_fslash         .equ 1
0011+  0BEF             tok_times          .equ 2
0012+  0BEF             tok_plus           .equ 3
0013+  0BEF             tok_minus          .equ 4
0014+  0BEF             tok_dot            .equ 5
0015+  0BEF             tok_semi           .equ 6
0016+  0BEF             tok_angle          .equ 7
0017+  0BEF             tok_tilde          .equ 8
0018+  0BEF             tok_equal          .equ 9
0019+  0BEF             tok_colon          .equ 10
0020+  0BEF             tok_comma          .equ 11
0021+  0BEF             
0022+  0BEF             tok_end            .equ 20
0023+  0BEF             
0024+  0BEF             
0025+  0BEF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0026+  0BEF             ;; read a full command argment from shell input buffer
0027+  0BEF             ;; argument is written into tokstr
0028+  0BEF             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0029+  0BEF             get_arg:
0030+  0BEF D7            push a
0031+  0BF0 E2            push si
0032+  0BF1 E3            push di
0033+  0BF2 19 00         mov al, 0
0034+  0BF4 3D 1D 0E      mov [tokstr], al      ; nullify tokstr string
0035+  0BF7 14 19 0E      mov a, [prog]
0036+  0BFA 4D            mov si, a
0037+  0BFB FD 4F 1D 0E   mov di, tokstr
0038+  0BFF             get_arg_skip_spaces:
0039+  0BFF F6            lodsb
0040+  0C00 07 C8 0B      call _isspace
0041+  0C03 C6 FF 0B      je get_arg_skip_spaces
0042+  0C06             get_arg_l0:
0043+  0C06 B9 3B         cmp al, $3b        ; check if is ';'
0044+  0C08 C6 15 0C      je get_arg_end
0045+  0C0B B9 00         cmp al, 0
0046+  0C0D C6 15 0C      je get_arg_end      ; check if end of input
0047+  0C10 F7            stosb
0048+  0C11 F6            lodsb
0049+  0C12 0A 06 0C      jmp get_arg_l0
0050+  0C15             get_arg_end:
0051+  0C15 19 00         mov al, 0
0052+  0C17 F7            stosb
0053+  0C18 D5 01 00      sub si, 1
0054+  0C1B 4E            mov a, si
0055+  0C1C 42 19 0E      mov [prog], a    ; update pointer
0056+  0C1F F0            pop di
0057+  0C20 EF            pop si
0058+  0C21 E4            pop a
0059+  0C22 09            ret
0060+  0C23             
0061+  0C23             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0062+  0C23             ;; read a path formation from shell input buffer
0063+  0C23             ;; path is written into tokstr
0064+  0C23             ;; /usr/bin
0065+  0C23             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0066+  0C23             get_path:
0067+  0C23 D7            push a
0068+  0C24 E2            push si
0069+  0C25 E3            push di
0070+  0C26 19 00         mov al, 0
0071+  0C28 3D 1D 0E      mov [tokstr], al      ; nullify tokstr string
0072+  0C2B 14 19 0E      mov a, [prog]
0073+  0C2E 4D            mov si, a
0074+  0C2F FD 4F 1D 0E   mov di, tokstr
0075+  0C33             get_path_skip_spaces:
0076+  0C33 F6            lodsb
0077+  0C34 07 C8 0B      call _isspace
0078+  0C37 C6 33 0C      je get_path_skip_spaces
0079+  0C3A             get_path_is_pathchar:
0080+  0C3A F7            stosb
0081+  0C3B F6            lodsb
0082+  0C3C 07 52 0B      call _isalnum      ;check if is alphanumeric
0083+  0C3F C6 3A 0C      je get_path_is_pathchar
0084+  0C42 B9 2F         cmp al, '/'        ; check if is '/'
0085+  0C44 C6 3A 0C      je get_path_is_pathchar
0086+  0C47 19 00         mov al, 0
0087+  0C49 F7            stosb
0088+  0C4A D5 01 00      sub si, 1
0089+  0C4D 4E            mov a, si
0090+  0C4E 42 19 0E      mov [prog], a    ; update pointer
0091+  0C51             get_path_end:
0092+  0C51 F0            pop di
0093+  0C52 EF            pop si
0094+  0C53 E4            pop a
0095+  0C54 09            ret
0096+  0C55             
0097+  0C55             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0098+  0C55             ;; read a line
0099+  0C55             ;; line is written into tokstr
0100+  0C55             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0101+  0C55             get_line:
0102+  0C55 D7            push a
0103+  0C56 E2            push si
0104+  0C57 E3            push di
0105+  0C58 19 00         mov al, 0
0106+  0C5A 3D 1D 0E      mov [tokstr], al      ; nullify tokstr string
0107+  0C5D 14 19 0E      mov a, [prog]
0108+  0C60 4D            mov si, a
0109+  0C61 FD 4F 1D 0E   mov di, tokstr
0110+  0C65             get_line_l0:
0111+  0C65 F6            lodsb
0112+  0C66 B9 0A         cmp al, $0a    ; check for new line
0113+  0C68 C6 6F 0C      je get_line_exit
0114+  0C6B F7            stosb
0115+  0C6C 0A 65 0C      jmp get_line_l0
0116+  0C6F             get_line_exit:
0117+  0C6F 19 00         mov al, 0
0118+  0C71 F7            stosb
0119+  0C72 4E            mov a, si
0120+  0C73 42 19 0E      mov [prog], a    ; update pointer
0121+  0C76 F0            pop di
0122+  0C77 EF            pop si
0123+  0C78 E4            pop a
0124+  0C79 09            ret
0125+  0C7A             
0126+  0C7A             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0127+  0C7A             ;; token parser
0128+  0C7A             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0129+  0C7A             get_token:
0130+  0C7A D7            push a
0131+  0C7B DA            push d
0132+  0C7C E2            push si
0133+  0C7D E3            push di
0134+  0C7E 19 00         mov al, 0
0135+  0C80 3D 1D 0E      mov [tokstr], al      ; nullify tokstr string
0136+  0C83 19 00         mov al, tok_null
0137+  0C85 3D 1C 0E      mov [tok], al        ; nullify token
0138+  0C88 14 19 0E      mov a, [prog]
0139+  0C8B 4D            mov si, a
0140+  0C8C FD 4F 1D 0E   mov di, tokstr
0141+  0C90             get_tok_skip_spaces:
0142+  0C90 F6            lodsb
0143+  0C91 07 C8 0B      call _isspace
0144+  0C94 C6 90 0C      je get_tok_skip_spaces
0145+  0C97 B9 00         cmp al, 0      ; check for end of input (null)
0146+  0C99 C6 7E 0D      je get_token_end
0147+  0C9C B9 23         cmp al, '#'      ; comments!
0148+  0C9E C6 AC 0D      je get_tok_comment
0149+  0CA1 07 52 0B      call _isalnum
0150+  0CA4 C6 8B 0D      jz is_alphanumeric
0151+  0CA7             ; other token types
0152+  0CA7             get_token_slash:
0153+  0CA7 B9 2F         cmp al, '/'        ; check if '/'
0154+  0CA9 C7 C1 0C      jne get_token_minus
0155+  0CAC F7            stosb          ; store '/' into token string
0156+  0CAD 19 00         mov al, 0
0157+  0CAF F7            stosb          ; terminate token string
0158+  0CB0 19 01         mov al, tok_fslash
0159+  0CB2 3D 1C 0E      mov [tok], al      
0160+  0CB5 19 02         mov al, toktyp_delimiter
0161+  0CB7 3D 1B 0E      mov [toktyp], al
0162+  0CBA 4E            mov a, si
0163+  0CBB 42 19 0E      mov [prog], a    ; update pointer
0164+  0CBE 0A A7 0D      jmp get_token_return
0165+  0CC1             get_token_minus:
0166+  0CC1 B9 2D         cmp al, '-'        ; check if '-'
0167+  0CC3 C7 DB 0C      jne get_token_comma
0168+  0CC6 F7            stosb          ; store '-' into token string
0169+  0CC7 19 00         mov al, 0
0170+  0CC9 F7            stosb          ; terminate token string
0171+  0CCA 19 04         mov al, tok_minus
0172+  0CCC 3D 1C 0E      mov [tok], al      
0173+  0CCF 19 02         mov al, toktyp_delimiter
0174+  0CD1 3D 1B 0E      mov [toktyp], al
0175+  0CD4 4E            mov a, si
0176+  0CD5 42 19 0E      mov [prog], a    ; update pointer
0177+  0CD8 0A A7 0D      jmp get_token_return
0178+  0CDB             get_token_comma:
0179+  0CDB B9 2C         cmp al, ','        ; check if ','
0180+  0CDD C7 F5 0C      jne get_token_semi
0181+  0CE0 F7            stosb          ; store ',' into token string
0182+  0CE1 19 00         mov al, 0
0183+  0CE3 F7            stosb          ; terminate token string
0184+  0CE4 19 0B         mov al, tok_comma
0185+  0CE6 3D 1C 0E      mov [tok], al      
0186+  0CE9 19 02         mov al, toktyp_delimiter
0187+  0CEB 3D 1B 0E      mov [toktyp], al
0188+  0CEE 4E            mov a, si
0189+  0CEF 42 19 0E      mov [prog], a    ; update pointer
0190+  0CF2 0A A7 0D      jmp get_token_return
0191+  0CF5             get_token_semi:
0192+  0CF5 B9 3B         cmp al, $3b        ; check if ';'
0193+  0CF7 C7 0F 0D      jne get_token_colon
0194+  0CFA F7            stosb          ; store ';' into token string
0195+  0CFB 19 00         mov al, 0
0196+  0CFD F7            stosb          ; terminate token string
0197+  0CFE 19 06         mov al, tok_semi
0198+  0D00 3D 1C 0E      mov [tok], al      
0199+  0D03 19 02         mov al, toktyp_delimiter
0200+  0D05 3D 1B 0E      mov [toktyp], al
0201+  0D08 4E            mov a, si
0202+  0D09 42 19 0E      mov [prog], a    ; update pointer
0203+  0D0C 0A A7 0D      jmp get_token_return
0204+  0D0F             get_token_colon:
0205+  0D0F B9 3A         cmp al, $3a        ; check if ':'
0206+  0D11 C7 29 0D      jne get_token_angle
0207+  0D14 F7            stosb          ; store ':' into token string
0208+  0D15 19 00         mov al, 0
0209+  0D17 F7            stosb          ; terminate token string
0210+  0D18 19 0A         mov al, tok_colon
0211+  0D1A 3D 1C 0E      mov [tok], al      
0212+  0D1D 19 02         mov al, toktyp_delimiter
0213+  0D1F 3D 1B 0E      mov [toktyp], al
0214+  0D22 4E            mov a, si
0215+  0D23 42 19 0E      mov [prog], a    ; update pointer
0216+  0D26 0A A7 0D      jmp get_token_return
0217+  0D29             get_token_angle:
0218+  0D29 B9 3E         cmp al, $3e        ; check if '>'
0219+  0D2B C7 43 0D      jne get_token_tilde
0220+  0D2E F7            stosb          ; store '>' into token string
0221+  0D2F 19 00         mov al, 0
0222+  0D31 F7            stosb          ; terminate token string
0223+  0D32 19 07         mov al, tok_angle
0224+  0D34 3D 1C 0E      mov [tok], al      
0225+  0D37 19 02         mov al, toktyp_delimiter
0226+  0D39 3D 1B 0E      mov [toktyp], al
0227+  0D3C 4E            mov a, si
0228+  0D3D 42 19 0E      mov [prog], a    ; update pointer
0229+  0D40 0A A7 0D      jmp get_token_return
0230+  0D43             get_token_tilde:
0231+  0D43 B9 7E         cmp al, '~'        ; check if '~'
0232+  0D45 C7 5D 0D      jne get_token_equal
0233+  0D48 F7            stosb          ; store '~' into token string
0234+  0D49 19 00         mov al, 0
0235+  0D4B F7            stosb          ; terminate token string
0236+  0D4C 19 08         mov al, tok_tilde
0237+  0D4E 3D 1C 0E      mov [tok], al      
0238+  0D51 19 02         mov al, toktyp_delimiter
0239+  0D53 3D 1B 0E      mov [toktyp], al
0240+  0D56 4E            mov a, si
0241+  0D57 42 19 0E      mov [prog], a    ; update pointer
0242+  0D5A 0A A7 0D      jmp get_token_return
0243+  0D5D             get_token_equal:
0244+  0D5D B9 3D         cmp al, '='        ; check if '='
0245+  0D5F C7 77 0D      jne get_token_skip
0246+  0D62 F7            stosb          ; store '=' into token string
0247+  0D63 19 00         mov al, 0
0248+  0D65 F7            stosb          ; terminate token string
0249+  0D66 19 09         mov al, tok_equal
0250+  0D68 3D 1C 0E      mov [tok], al      
0251+  0D6B 19 02         mov al, toktyp_delimiter
0252+  0D6D 3D 1B 0E      mov [toktyp], al
0253+  0D70 4E            mov a, si
0254+  0D71 42 19 0E      mov [prog], a    ; update pointer
0255+  0D74 0A A7 0D      jmp get_token_return
0256+  0D77             get_token_skip:
0257+  0D77 4E            mov a, si
0258+  0D78 42 19 0E      mov [prog], a    ; update pointer
0259+  0D7B 0A A7 0D      jmp get_token_return
0260+  0D7E             get_token_end:        ; end of file token
0261+  0D7E 19 14         mov al, tok_end
0262+  0D80 3D 1C 0E      mov [tok], al
0263+  0D83 19 06         mov al, toktyp_end
0264+  0D85 3D 1B 0E      mov [toktyp], al
0265+  0D88 0A A7 0D      jmp get_token_return
0266+  0D8B             is_alphanumeric:
0267+  0D8B F7            stosb
0268+  0D8C F6            lodsb
0269+  0D8D 07 52 0B      call _isalnum      ;check if is alphanumeric
0270+  0D90 C6 8B 0D      jz is_alphanumeric
0271+  0D93 B9 2E         cmp al, $2e        ; check if is '.'
0272+  0D95 C6 8B 0D      je is_alphanumeric
0273+  0D98 19 00         mov al, 0
0274+  0D9A F7            stosb
0275+  0D9B 19 00         mov al, toktyp_identifier
0276+  0D9D 3D 1B 0E      mov [toktyp], al
0277+  0DA0 D5 01 00      sub si, 1
0278+  0DA3 4E            mov a, si
0279+  0DA4 42 19 0E      mov [prog], a    ; update pointer
0280+  0DA7             get_token_return:
0281+  0DA7 F0            pop di
0282+  0DA8 EF            pop si
0283+  0DA9 E7            pop d
0284+  0DAA E4            pop a
0285+  0DAB 09            ret
0286+  0DAC             get_tok_comment:
0287+  0DAC F6            lodsb
0288+  0DAD B9 0A         cmp al, $0a      ; new line
0289+  0DAF C7 AC 0D      jne get_tok_comment
0290+  0DB2 0A 90 0C      jmp get_tok_skip_spaces
0291+  0DB5             
0292+  0DB5             
0293+  0DB5             get_number:
0294+  0DB5 D7            push a
0295+  0DB6 DA            push d
0296+  0DB7 E2            push si
0297+  0DB8 E3            push di
0298+  0DB9 19 00         mov al, 0
0299+  0DBB 3D 1D 0E      mov [tokstr], al      ; nullify tokstr string
0300+  0DBE 19 00         mov al, tok_null
0301+  0DC0 3D 1C 0E      mov [tok], al        ; nullify token
0302+  0DC3 14 19 0E      mov a, [prog]
0303+  0DC6 4D            mov si, a
0304+  0DC7 FD 4F 1D 0E   mov di, tokstr
0305+  0DCB             get_number_skip_spaces:
0306+  0DCB F6            lodsb
0307+  0DCC 07 C8 0B      call _isspace
0308+  0DCF C6 CB 0D      je get_number_skip_spaces
0309+  0DD2 B9 00         cmp al, 0      ; check for end of input (null)
0310+  0DD4 C7 E4 0D      jne get_number_l0
0311+  0DD7 19 14         mov al, tok_end
0312+  0DD9 3D 1C 0E      mov [tok], al
0313+  0DDC 19 06         mov al, toktyp_end
0314+  0DDE 3D 1B 0E      mov [toktyp], al
0315+  0DE1 0A FB 0D      jmp get_number_return
0316+  0DE4             get_number_l0:
0317+  0DE4 F7            stosb
0318+  0DE5 F6            lodsb
0319+  0DE6 07 5C 0B      call _isdigit      ;check if is numeric
0320+  0DE9 C6 E4 0D      jz get_number_l0
0321+  0DEC 19 00         mov al, 0
0322+  0DEE F7            stosb
0323+  0DEF 19 05         mov al, toktyp_numeric
0324+  0DF1 3D 1B 0E      mov [toktyp], al
0325+  0DF4 D5 01 00      sub si, 1
0326+  0DF7 4E            mov a, si
0327+  0DF8 42 19 0E      mov [prog], a    ; update pointer
0328+  0DFB             get_number_return:
0329+  0DFB F0            pop di
0330+  0DFC EF            pop si
0331+  0DFD E7            pop d
0332+  0DFE E4            pop a
0333+  0DFF 09            ret
0334+  0E00             
0335+  0E00             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0336+  0E00             ;; put back token
0337+  0E00             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  
0338+  0E00             _putback:
0339+  0E00 D7            push a
0340+  0E01 E2            push si
0341+  0E02 FD 4D 1D 0E   mov si, tokstr  
0342+  0E06             _putback_loop:
0343+  0E06 F6            lodsb
0344+  0E07 B9 00         cmp al, 0
0345+  0E09 C6 16 0E      je _putback_end
0346+  0E0C 14 19 0E      mov a, [prog]
0347+  0E0F 7D            dec a
0348+  0E10 42 19 0E      mov [prog], a      ; update pointer
0349+  0E13 0A 06 0E      jmp _putback_loop
0350+  0E16             _putback_end:
0351+  0E16 EF            pop si
0352+  0E17 E4            pop a
0353+  0E18 09            ret
0354+  0E19             
0355+  0E19             
0356+  0E19             
0357+  0E19             
0358+  0E19 00 00       prog:      .dw 0          ; pointer to current position in buffer
0359+  0E1B             
0360+  0E1B 00          toktyp:    .db 0          ; token type symbol
0361+  0E1C 00          tok:       .db 0          ; current token symbol
0362+  0E1D 00 00 00 00 tokstr:    .fill 256, 0   ; token as a string
0362+  0E21 00 00 00 00 
0362+  0E25 00 00 00 00 
0362+  0E29 00 00 00 00 
0362+  0E2D 00 00 00 00 
0362+  0E31 00 00 00 00 
0362+  0E35 00 00 00 00 
0362+  0E39 00 00 00 00 
0362+  0E3D 00 00 00 00 
0362+  0E41 00 00 00 00 
0362+  0E45 00 00 00 00 
0362+  0E49 00 00 00 00 
0362+  0E4D 00 00 00 00 
0362+  0E51 00 00 00 00 
0362+  0E55 00 00 00 00 
0362+  0E59 00 00 00 00 
0362+  0E5D 00 00 00 00 
0362+  0E61 00 00 00 00 
0362+  0E65 00 00 00 00 
0362+  0E69 00 00 00 00 
0362+  0E6D 00 00 00 00 
0362+  0E71 00 00 00 00 
0362+  0E75 00 00 00 00 
0362+  0E79 00 00 00 00 
0362+  0E7D 00 00 00 00 
0362+  0E81 00 00 00 00 
0362+  0E85 00 00 00 00 
0362+  0E89 00 00 00 00 
0362+  0E8D 00 00 00 00 
0362+  0E91 00 00 00 00 
0362+  0E95 00 00 00 00 
0362+  0E99 00 00 00 00 
0362+  0E9D 00 00 00 00 
0362+  0EA1 00 00 00 00 
0362+  0EA5 00 00 00 00 
0362+  0EA9 00 00 00 00 
0362+  0EAD 00 00 00 00 
0362+  0EB1 00 00 00 00 
0362+  0EB5 00 00 00 00 
0362+  0EB9 00 00 00 00 
0362+  0EBD 00 00 00 00 
0362+  0EC1 00 00 00 00 
0362+  0EC5 00 00 00 00 
0362+  0EC9 00 00 00 00 
0362+  0ECD 00 00 00 00 
0362+  0ED1 00 00 00 00 
0362+  0ED5 00 00 00 00 
0362+  0ED9 00 00 00 00 
0362+  0EDD 00 00 00 00 
0362+  0EE1 00 00 00 00 
0362+  0EE5 00 00 00 00 
0362+  0EE9 00 00 00 00 
0362+  0EED 00 00 00 00 
0362+  0EF1 00 00 00 00 
0362+  0EF5 00 00 00 00 
0362+  0EF9 00 00 00 00 
0362+  0EFD 00 00 00 00 
0362+  0F01 00 00 00 00 
0362+  0F05 00 00 00 00 
0362+  0F09 00 00 00 00 
0362+  0F0D 00 00 00 00 
0362+  0F11 00 00 00 00 
0362+  0F15 00 00 00 00 
0362+  0F19 00 00 00 00 
1617   0F1D             
1618   0F1D             ; kernel parameters
1619   0F1D             sys_debug_mode:
1620   0F1D 00            .db 0   ; debug modes: 0=normal mode, 1=debug mode
1621   0F1E             sys_echo_on:
1622   0F1E 01            .db 1
1623   0F1F             sys_uart0_lcr:
1624   0F1F 0F            .db %00001111 ; 8 data bits, 2 stop bits, enable parity, odd parity
1625   0F20             sys_uart0_inten:
1626   0F20 01            .db 1
1627   0F21             sys_uart0_fifoen:
1628   0F21 00            .db 0
1629   0F22             sys_uart0_div0:
1630   0F22 03            .db 3
1631   0F23             sys_uart0_div1:
1632   0F23 00            .db 0   ; default baud = 38400
1633   0F24             ; baud  divisor
1634   0F24             ; 50    2304
1635   0F24             ; 110   1047
1636   0F24             ; 300    384
1637   0F24             ; 600    192
1638   0F24             ; 1200    96
1639   0F24             ; 9600    12
1640   0F24             ; 19200    6
1641   0F24             ; 38400    3
1642   0F24             sys_uart1_lcr:
1643   0F24 0F            .db %00001111 ; 8 data bits, 2 stop bits, enable parity, odd parity
1644   0F25             sys_uart1_inten:
1645   0F25 01            .db 1
1646   0F26             sys_uart1_fifoen:
1647   0F26 00            .db 0
1648   0F27             sys_uart1_div0:
1649   0F27 03            .db 3
1650   0F28             sys_uart1_div1:
1651   0F28 00            .db 0   ; default baud = 38400
1652   0F29             
1653   0F29             fifo_in:
1654   0F29 60 11         .dw fifo
1655   0F2B             fifo_out:
1656   0F2B 60 11         .dw fifo
1657   0F2D             
1658   0F2D             ; file system variables
1659   0F2D             current_dir_id:
1660   0F2D 00 00         .dw 0     ; keep dirid of current directory
1661   0F2F             s_init_path:
1662   0F2F 2F 73 62 69   .db "/sbin/init", 0
1662   0F33 6E 2F 69 6E 
1662   0F37 69 74 00 
1663   0F3A             
1664   0F3A             s_uname:
1665   0F3A 73 6F 6C 61   .db "solarium v.1.0", 0
1665   0F3E 72 69 75 6D 
1665   0F42 20 76 2E 31 
1665   0F46 2E 30 00 
1666   0F49             s_dataentry:
1667   0F49 3E 20 00      .db "> ", 0
1668   0F4C             s_parent_dir:
1669   0F4C 2E 2E 00      .db "..", 0
1670   0F4F             s_current_dir:
1671   0F4F 2E 00         .db ".", 0
1672   0F51             s_fslash:
1673   0F51 2F 00         .db "/", 0
1674   0F53             file_attrib:
1675   0F53 2D 72 77 20   .db "-rw x"      ; chars at powers of 2
1675   0F57 78 
1676   0F58             file_type:
1677   0F58 2D 64 63      .db "-dc"
1678   0F5B             s_ps_header:
1679   0F5B 70 69 64 20   .db "pid command\n", 0
1679   0F5F 63 6F 6D 6D 
1679   0F63 61 6E 64 0A 
1679   0F67 00 
1680   0F68             s_ls_total:
1681   0F68 74 6F 74 61   .db "total: ", 0
1681   0F6C 6C 3A 20 00 
1682   0F70             
1683   0F70             s_int_en:
1684   0F70 69 72 71 73   .db "irqs enabled\n", 0
1684   0F74 20 65 6E 61 
1684   0F78 62 6C 65 64 
1684   0F7C 0A 00 
1685   0F7E             s_kernel_welcome:
1686   0F7E 2A 2A 2A 2A   .db "************************************************\n"
1686   0F82 2A 2A 2A 2A 
1686   0F86 2A 2A 2A 2A 
1686   0F8A 2A 2A 2A 2A 
1686   0F8E 2A 2A 2A 2A 
1686   0F92 2A 2A 2A 2A 
1686   0F96 2A 2A 2A 2A 
1686   0F9A 2A 2A 2A 2A 
1686   0F9E 2A 2A 2A 2A 
1686   0FA2 2A 2A 2A 2A 
1686   0FA6 2A 2A 2A 2A 
1686   0FAA 2A 2A 2A 2A 
1686   0FAE 0A 
1687   0FAF 2A 2A 2A 20   .db "*** Welcome to Solarium OS - Kernel ver. 1.0 ***\n"
1687   0FB3 57 65 6C 63 
1687   0FB7 6F 6D 65 20 
1687   0FBB 74 6F 20 53 
1687   0FBF 6F 6C 61 72 
1687   0FC3 69 75 6D 20 
1687   0FC7 4F 53 20 2D 
1687   0FCB 20 4B 65 72 
1687   0FCF 6E 65 6C 20 
1687   0FD3 76 65 72 2E 
1687   0FD7 20 31 2E 30 
1687   0FDB 20 2A 2A 2A 
1687   0FDF 0A 
1688   0FE0 2A 2A 2A 20   .db "*** type help for more information           ***\n"
1688   0FE4 74 79 70 65 
1688   0FE8 20 68 65 6C 
1688   0FEC 70 20 66 6F 
1688   0FF0 72 20 6D 6F 
1688   0FF4 72 65 20 69 
1688   0FF8 6E 66 6F 72 
1688   0FFC 6D 61 74 69 
1688   1000 6F 6E 20 20 
1688   1004 20 20 20 20 
1688   1008 20 20 20 20 
1688   100C 20 2A 2A 2A 
1688   1010 0A 
1689   1011 2A 2A 2A 2A   .db "************************************************\n"
1689   1015 2A 2A 2A 2A 
1689   1019 2A 2A 2A 2A 
1689   101D 2A 2A 2A 2A 
1689   1021 2A 2A 2A 2A 
1689   1025 2A 2A 2A 2A 
1689   1029 2A 2A 2A 2A 
1689   102D 2A 2A 2A 2A 
1689   1031 2A 2A 2A 2A 
1689   1035 2A 2A 2A 2A 
1689   1039 2A 2A 2A 2A 
1689   103D 2A 2A 2A 2A 
1689   1041 0A 
1690   1042             s_prompt_init:
1691   1042 73 74 61 72   .db "starting init\n", 0
1691   1046 74 69 6E 67 
1691   104A 20 69 6E 69 
1691   104E 74 0A 00 
1692   1051             s_priviledge:
1693   1051 0A 65 78 63   .db "\nexception: privilege\n", 0
1693   1055 65 70 74 69 
1693   1059 6F 6E 3A 20 
1693   105D 70 72 69 76 
1693   1061 69 6C 65 67 
1693   1065 65 0A 00 
1694   1068             s_divzero:
1695   1068 0A 65 78 63   .db "\nexception: zero division\n", 0
1695   106C 65 70 74 69 
1695   1070 6F 6E 3A 20 
1695   1074 7A 65 72 6F 
1695   1078 20 64 69 76 
1695   107C 69 73 69 6F 
1695   1080 6E 0A 00 
1696   1083             
1697   1083             s_set_year:
1698   1083 79 65 61 72   .db "year: ", 0
1698   1087 3A 20 00 
1699   108A             s_set_month:
1700   108A 6D 6F 6E 74   .db "month: ", 0
1700   108E 68 3A 20 00 
1701   1092             s_set_day:
1702   1092 64 61 79 3A   .db "day: ", 0
1702   1096 20 00 
1703   1098             s_set_week:
1704   1098 77 65 65 6B   .db "weekday: ", 0
1704   109C 64 61 79 3A 
1704   10A0 20 00 
1705   10A2             s_set_hours:
1706   10A2 68 6F 75 72   .db "hours: ", 0
1706   10A6 73 3A 20 00 
1707   10AA             s_set_minutes:
1708   10AA 6D 69 6E 75   .db "minutes: ", 0
1708   10AE 74 65 73 3A 
1708   10B2 20 00 
1709   10B4             s_set_seconds:
1710   10B4 73 65 63 6F   .db "seconds: ", 0
1710   10B8 6E 64 73 3A 
1710   10BC 20 00 
1711   10BE             s_months:      
1712   10BE 20 20 20 00   .db "   ", 0
1713   10C2 6A 61 6E 00   .db "jan", 0
1714   10C6 66 65 62 00   .db "feb", 0
1715   10CA 6D 61 72 00   .db "mar", 0
1716   10CE 61 70 72 00   .db "apr", 0
1717   10D2 6D 61 79 00   .db "may", 0
1718   10D6 6A 75 6E 00   .db "jun", 0
1719   10DA 6A 75 6C 00   .db "jul", 0
1720   10DE 61 75 67 00   .db "aug", 0
1721   10E2 73 65 70 00   .db "sep", 0
1722   10E6 6F 63 74 00   .db "oct", 0
1723   10EA 6E 6F 76 00   .db "nov", 0
1724   10EE 64 65 63 00   .db "dec", 0
1725   10F2             
1726   10F2             s_week:        
1727   10F2 73 75 6E 00   .db "sun", 0 
1728   10F6 6D 6F 6E 00   .db "mon", 0 
1729   10FA 74 75 65 00   .db "tue", 0 
1730   10FE 77 65 64 00   .db "wed", 0 
1731   1102 74 68 75 00   .db "thu", 0 
1732   1106 66 72 69 00   .db "fri", 0 
1733   110A 73 61 74 00   .db "sat", 0
1734   110E             
1735   110E 0A 49 52 51 s_fdc_irq: .db "\nIRQ0 Executed.\n", 0
1735   1112 30 20 45 78 
1735   1116 65 63 75 74 
1735   111A 65 64 2E 0A 
1735   111E 00 
1736   111F             s_fdc_config:
1737   111F 73 65 6C 65   .db "selecting diskette drive 0, side 0, single density, head loaded\n", 0
1737   1123 63 74 69 6E 
1737   1127 67 20 64 69 
1737   112B 73 6B 65 74 
1737   112F 74 65 20 64 
1737   1133 72 69 76 65 
1737   1137 20 30 2C 20 
1737   113B 73 69 64 65 
1737   113F 20 30 2C 20 
1737   1143 73 69 6E 67 
1737   1147 6C 65 20 64 
1737   114B 65 6E 73 69 
1737   114F 74 79 2C 20 
1737   1153 68 65 61 64 
1737   1157 20 6C 6F 61 
1737   115B 64 65 64 0A 
1737   115F 00 
1738   1160             
1739   1160             fifo:
1740   1160 FF FF FF FF   .fill _fifo_size
1740   1164 FF FF FF FF 
1740   1168 FF FF FF FF 
1740   116C FF FF FF FF 
1740   1170 FF FF FF FF 
1740   1174 FF FF FF FF 
1740   1178 FF FF FF FF 
1740   117C FF FF FF FF 
1740   1180 FF FF FF FF 
1740   1184 FF FF FF FF 
1740   1188 FF FF FF FF 
1740   118C FF FF FF FF 
1740   1190 FF FF FF FF 
1740   1194 FF FF FF FF 
1740   1198 FF FF FF FF 
1740   119C FF FF FF FF 
1740   11A0 FF FF FF FF 
1740   11A4 FF FF FF FF 
1740   11A8 FF FF FF FF 
1740   11AC FF FF FF FF 
1740   11B0 FF FF FF FF 
1740   11B4 FF FF FF FF 
1740   11B8 FF FF FF FF 
1740   11BC FF FF FF FF 
1740   11C0 FF FF FF FF 
1740   11C4 FF FF FF FF 
1740   11C8 FF FF FF FF 
1740   11CC FF FF FF FF 
1740   11D0 FF FF FF FF 
1740   11D4 FF FF FF FF 
1740   11D8 FF FF FF FF 
1740   11DC FF FF FF FF 
1740   11E0 FF FF FF FF 
1740   11E4 FF FF FF FF 
1740   11E8 FF FF FF FF 
1740   11EC FF FF FF FF 
1740   11F0 FF FF FF FF 
1740   11F4 FF FF FF FF 
1740   11F8 FF FF FF FF 
1740   11FC FF FF FF FF 
1740   1200 FF FF FF FF 
1740   1204 FF FF FF FF 
1740   1208 FF FF FF FF 
1740   120C FF FF FF FF 
1740   1210 FF FF FF FF 
1740   1214 FF FF FF FF 
1740   1218 FF FF FF FF 
1740   121C FF FF FF FF 
1740   1220 FF FF FF FF 
1740   1224 FF FF FF FF 
1740   1228 FF FF FF FF 
1740   122C FF FF FF FF 
1740   1230 FF FF FF FF 
1740   1234 FF FF FF FF 
1740   1238 FF FF FF FF 
1740   123C FF FF FF FF 
1740   1240 FF FF FF FF 
1740   1244 FF FF FF FF 
1740   1248 FF FF FF FF 
1740   124C FF FF FF FF 
1740   1250 FF FF FF FF 
1740   1254 FF FF FF FF 
1740   1258 FF FF FF FF 
1740   125C FF FF FF FF 
1740   1260 FF FF FF FF 
1740   1264 FF FF FF FF 
1740   1268 FF FF FF FF 
1740   126C FF FF FF FF 
1740   1270 FF FF FF FF 
1740   1274 FF FF FF FF 
1740   1278 FF FF FF FF 
1740   127C FF FF FF FF 
1740   1280 FF FF FF FF 
1740   1284 FF FF FF FF 
1740   1288 FF FF FF FF 
1740   128C FF FF FF FF 
1740   1290 FF FF FF FF 
1740   1294 FF FF FF FF 
1740   1298 FF FF FF FF 
1740   129C FF FF FF FF 
1740   12A0 FF FF FF FF 
1740   12A4 FF FF FF FF 
1740   12A8 FF FF FF FF 
1740   12AC FF FF FF FF 
1740   12B0 FF FF FF FF 
1740   12B4 FF FF FF FF 
1740   12B8 FF FF FF FF 
1740   12BC FF FF FF FF 
1740   12C0 FF FF FF FF 
1740   12C4 FF FF FF FF 
1740   12C8 FF FF FF FF 
1740   12CC FF FF FF FF 
1740   12D0 FF FF FF FF 
1740   12D4 FF FF FF FF 
1740   12D8 FF FF FF FF 
1740   12DC FF FF FF FF 
1740   12E0 FF FF FF FF 
1740   12E4 FF FF FF FF 
1740   12E8 FF FF FF FF 
1740   12EC FF FF FF FF 
1740   12F0 FF FF FF FF 
1740   12F4 FF FF FF FF 
1740   12F8 FF FF FF FF 
1740   12FC FF FF FF FF 
1740   1300 FF FF FF FF 
1740   1304 FF FF FF FF 
1740   1308 FF FF FF FF 
1740   130C FF FF FF FF 
1740   1310 FF FF FF FF 
1740   1314 FF FF FF FF 
1740   1318 FF FF FF FF 
1740   131C FF FF FF FF 
1740   1320 FF FF FF FF 
1740   1324 FF FF FF FF 
1740   1328 FF FF FF FF 
1740   132C FF FF FF FF 
1740   1330 FF FF FF FF 
1740   1334 FF FF FF FF 
1740   1338 FF FF FF FF 
1740   133C FF FF FF FF 
1740   1340 FF FF FF FF 
1740   1344 FF FF FF FF 
1740   1348 FF FF FF FF 
1740   134C FF FF FF FF 
1740   1350 FF FF FF FF 
1740   1354 FF FF FF FF 
1740   1358 FF FF FF FF 
1740   135C FF FF FF FF 
1740   1360 FF FF FF FF 
1740   1364 FF FF FF FF 
1740   1368 FF FF FF FF 
1740   136C FF FF FF FF 
1740   1370 FF FF FF FF 
1740   1374 FF FF FF FF 
1740   1378 FF FF FF FF 
1740   137C FF FF FF FF 
1740   1380 FF FF FF FF 
1740   1384 FF FF FF FF 
1740   1388 FF FF FF FF 
1740   138C FF FF FF FF 
1740   1390 FF FF FF FF 
1740   1394 FF FF FF FF 
1740   1398 FF FF FF FF 
1740   139C FF FF FF FF 
1740   13A0 FF FF FF FF 
1740   13A4 FF FF FF FF 
1740   13A8 FF FF FF FF 
1740   13AC FF FF FF FF 
1740   13B0 FF FF FF FF 
1740   13B4 FF FF FF FF 
1740   13B8 FF FF FF FF 
1740   13BC FF FF FF FF 
1740   13C0 FF FF FF FF 
1740   13C4 FF FF FF FF 
1740   13C8 FF FF FF FF 
1740   13CC FF FF FF FF 
1740   13D0 FF FF FF FF 
1740   13D4 FF FF FF FF 
1740   13D8 FF FF FF FF 
1740   13DC FF FF FF FF 
1740   13E0 FF FF FF FF 
1740   13E4 FF FF FF FF 
1740   13E8 FF FF FF FF 
1740   13EC FF FF FF FF 
1740   13F0 FF FF FF FF 
1740   13F4 FF FF FF FF 
1740   13F8 FF FF FF FF 
1740   13FC FF FF FF FF 
1740   1400 FF FF FF FF 
1740   1404 FF FF FF FF 
1740   1408 FF FF FF FF 
1740   140C FF FF FF FF 
1740   1410 FF FF FF FF 
1740   1414 FF FF FF FF 
1740   1418 FF FF FF FF 
1740   141C FF FF FF FF 
1740   1420 FF FF FF FF 
1740   1424 FF FF FF FF 
1740   1428 FF FF FF FF 
1740   142C FF FF FF FF 
1740   1430 FF FF FF FF 
1740   1434 FF FF FF FF 
1740   1438 FF FF FF FF 
1740   143C FF FF FF FF 
1740   1440 FF FF FF FF 
1740   1444 FF FF FF FF 
1740   1448 FF FF FF FF 
1740   144C FF FF FF FF 
1740   1450 FF FF FF FF 
1740   1454 FF FF FF FF 
1740   1458 FF FF FF FF 
1740   145C FF FF FF FF 
1740   1460 FF FF FF FF 
1740   1464 FF FF FF FF 
1740   1468 FF FF FF FF 
1740   146C FF FF FF FF 
1740   1470 FF FF FF FF 
1740   1474 FF FF FF FF 
1740   1478 FF FF FF FF 
1740   147C FF FF FF FF 
1740   1480 FF FF FF FF 
1740   1484 FF FF FF FF 
1740   1488 FF FF FF FF 
1740   148C FF FF FF FF 
1740   1490 FF FF FF FF 
1740   1494 FF FF FF FF 
1740   1498 FF FF FF FF 
1740   149C FF FF FF FF 
1740   14A0 FF FF FF FF 
1740   14A4 FF FF FF FF 
1740   14A8 FF FF FF FF 
1740   14AC FF FF FF FF 
1740   14B0 FF FF FF FF 
1740   14B4 FF FF FF FF 
1740   14B8 FF FF FF FF 
1740   14BC FF FF FF FF 
1740   14C0 FF FF FF FF 
1740   14C4 FF FF FF FF 
1740   14C8 FF FF FF FF 
1740   14CC FF FF FF FF 
1740   14D0 FF FF FF FF 
1740   14D4 FF FF FF FF 
1740   14D8 FF FF FF FF 
1740   14DC FF FF FF FF 
1740   14E0 FF FF FF FF 
1740   14E4 FF FF FF FF 
1740   14E8 FF FF FF FF 
1740   14EC FF FF FF FF 
1740   14F0 FF FF FF FF 
1740   14F4 FF FF FF FF 
1740   14F8 FF FF FF FF 
1740   14FC FF FF FF FF 
1740   1500 FF FF FF FF 
1740   1504 FF FF FF FF 
1740   1508 FF FF FF FF 
1740   150C FF FF FF FF 
1740   1510 FF FF FF FF 
1740   1514 FF FF FF FF 
1740   1518 FF FF FF FF 
1740   151C FF FF FF FF 
1740   1520 FF FF FF FF 
1740   1524 FF FF FF FF 
1740   1528 FF FF FF FF 
1740   152C FF FF FF FF 
1740   1530 FF FF FF FF 
1740   1534 FF FF FF FF 
1740   1538 FF FF FF FF 
1740   153C FF FF FF FF 
1740   1540 FF FF FF FF 
1740   1544 FF FF FF FF 
1740   1548 FF FF FF FF 
1740   154C FF FF FF FF 
1740   1550 FF FF FF FF 
1740   1554 FF FF FF FF 
1740   1558 FF FF FF FF 
1740   155C FF FF FF FF 
1740   1560 FF FF FF FF 
1740   1564 FF FF FF FF 
1740   1568 FF FF FF FF 
1740   156C FF FF FF FF 
1740   1570 FF FF FF FF 
1740   1574 FF FF FF FF 
1740   1578 FF FF FF FF 
1740   157C FF FF FF FF 
1740   1580 FF FF FF FF 
1740   1584 FF FF FF FF 
1740   1588 FF FF FF FF 
1740   158C FF FF FF FF 
1740   1590 FF FF FF FF 
1740   1594 FF FF FF FF 
1740   1598 FF FF FF FF 
1740   159C FF FF FF FF 
1740   15A0 FF FF FF FF 
1740   15A4 FF FF FF FF 
1740   15A8 FF FF FF FF 
1740   15AC FF FF FF FF 
1740   15B0 FF FF FF FF 
1740   15B4 FF FF FF FF 
1740   15B8 FF FF FF FF 
1740   15BC FF FF FF FF 
1740   15C0 FF FF FF FF 
1740   15C4 FF FF FF FF 
1740   15C8 FF FF FF FF 
1740   15CC FF FF FF FF 
1740   15D0 FF FF FF FF 
1740   15D4 FF FF FF FF 
1740   15D8 FF FF FF FF 
1740   15DC FF FF FF FF 
1740   15E0 FF FF FF FF 
1740   15E4 FF FF FF FF 
1740   15E8 FF FF FF FF 
1740   15EC FF FF FF FF 
1740   15F0 FF FF FF FF 
1740   15F4 FF FF FF FF 
1740   15F8 FF FF FF FF 
1740   15FC FF FF FF FF 
1740   1600 FF FF FF FF 
1740   1604 FF FF FF FF 
1740   1608 FF FF FF FF 
1740   160C FF FF FF FF 
1740   1610 FF FF FF FF 
1740   1614 FF FF FF FF 
1740   1618 FF FF FF FF 
1740   161C FF FF FF FF 
1740   1620 FF FF FF FF 
1740   1624 FF FF FF FF 
1740   1628 FF FF FF FF 
1740   162C FF FF FF FF 
1740   1630 FF FF FF FF 
1740   1634 FF FF FF FF 
1740   1638 FF FF FF FF 
1740   163C FF FF FF FF 
1740   1640 FF FF FF FF 
1740   1644 FF FF FF FF 
1740   1648 FF FF FF FF 
1740   164C FF FF FF FF 
1740   1650 FF FF FF FF 
1740   1654 FF FF FF FF 
1740   1658 FF FF FF FF 
1740   165C FF FF FF FF 
1740   1660 FF FF FF FF 
1740   1664 FF FF FF FF 
1740   1668 FF FF FF FF 
1740   166C FF FF FF FF 
1740   1670 FF FF FF FF 
1740   1674 FF FF FF FF 
1740   1678 FF FF FF FF 
1740   167C FF FF FF FF 
1740   1680 FF FF FF FF 
1740   1684 FF FF FF FF 
1740   1688 FF FF FF FF 
1740   168C FF FF FF FF 
1740   1690 FF FF FF FF 
1740   1694 FF FF FF FF 
1740   1698 FF FF FF FF 
1740   169C FF FF FF FF 
1740   16A0 FF FF FF FF 
1740   16A4 FF FF FF FF 
1740   16A8 FF FF FF FF 
1740   16AC FF FF FF FF 
1740   16B0 FF FF FF FF 
1740   16B4 FF FF FF FF 
1740   16B8 FF FF FF FF 
1740   16BC FF FF FF FF 
1740   16C0 FF FF FF FF 
1740   16C4 FF FF FF FF 
1740   16C8 FF FF FF FF 
1740   16CC FF FF FF FF 
1740   16D0 FF FF FF FF 
1740   16D4 FF FF FF FF 
1740   16D8 FF FF FF FF 
1740   16DC FF FF FF FF 
1740   16E0 FF FF FF FF 
1740   16E4 FF FF FF FF 
1740   16E8 FF FF FF FF 
1740   16EC FF FF FF FF 
1740   16F0 FF FF FF FF 
1740   16F4 FF FF FF FF 
1740   16F8 FF FF FF FF 
1740   16FC FF FF FF FF 
1740   1700 FF FF FF FF 
1740   1704 FF FF FF FF 
1740   1708 FF FF FF FF 
1740   170C FF FF FF FF 
1740   1710 FF FF FF FF 
1740   1714 FF FF FF FF 
1740   1718 FF FF FF FF 
1740   171C FF FF FF FF 
1740   1720 FF FF FF FF 
1740   1724 FF FF FF FF 
1740   1728 FF FF FF FF 
1740   172C FF FF FF FF 
1740   1730 FF FF FF FF 
1740   1734 FF FF FF FF 
1740   1738 FF FF FF FF 
1740   173C FF FF FF FF 
1740   1740 FF FF FF FF 
1740   1744 FF FF FF FF 
1740   1748 FF FF FF FF 
1740   174C FF FF FF FF 
1740   1750 FF FF FF FF 
1740   1754 FF FF FF FF 
1740   1758 FF FF FF FF 
1740   175C FF FF FF FF 
1740   1760 FF FF FF FF 
1740   1764 FF FF FF FF 
1740   1768 FF FF FF FF 
1740   176C FF FF FF FF 
1740   1770 FF FF FF FF 
1740   1774 FF FF FF FF 
1740   1778 FF FF FF FF 
1740   177C FF FF FF FF 
1740   1780 FF FF FF FF 
1740   1784 FF FF FF FF 
1740   1788 FF FF FF FF 
1740   178C FF FF FF FF 
1740   1790 FF FF FF FF 
1740   1794 FF FF FF FF 
1740   1798 FF FF FF FF 
1740   179C FF FF FF FF 
1740   17A0 FF FF FF FF 
1740   17A4 FF FF FF FF 
1740   17A8 FF FF FF FF 
1740   17AC FF FF FF FF 
1740   17B0 FF FF FF FF 
1740   17B4 FF FF FF FF 
1740   17B8 FF FF FF FF 
1740   17BC FF FF FF FF 
1740   17C0 FF FF FF FF 
1740   17C4 FF FF FF FF 
1740   17C8 FF FF FF FF 
1740   17CC FF FF FF FF 
1740   17D0 FF FF FF FF 
1740   17D4 FF FF FF FF 
1740   17D8 FF FF FF FF 
1740   17DC FF FF FF FF 
1740   17E0 FF FF FF FF 
1740   17E4 FF FF FF FF 
1740   17E8 FF FF FF FF 
1740   17EC FF FF FF FF 
1740   17F0 FF FF FF FF 
1740   17F4 FF FF FF FF 
1740   17F8 FF FF FF FF 
1740   17FC FF FF FF FF 
1740   1800 FF FF FF FF 
1740   1804 FF FF FF FF 
1740   1808 FF FF FF FF 
1740   180C FF FF FF FF 
1740   1810 FF FF FF FF 
1740   1814 FF FF FF FF 
1740   1818 FF FF FF FF 
1740   181C FF FF FF FF 
1740   1820 FF FF FF FF 
1740   1824 FF FF FF FF 
1740   1828 FF FF FF FF 
1740   182C FF FF FF FF 
1740   1830 FF FF FF FF 
1740   1834 FF FF FF FF 
1740   1838 FF FF FF FF 
1740   183C FF FF FF FF 
1740   1840 FF FF FF FF 
1740   1844 FF FF FF FF 
1740   1848 FF FF FF FF 
1740   184C FF FF FF FF 
1740   1850 FF FF FF FF 
1740   1854 FF FF FF FF 
1740   1858 FF FF FF FF 
1740   185C FF FF FF FF 
1740   1860 FF FF FF FF 
1740   1864 FF FF FF FF 
1740   1868 FF FF FF FF 
1740   186C FF FF FF FF 
1740   1870 FF FF FF FF 
1740   1874 FF FF FF FF 
1740   1878 FF FF FF FF 
1740   187C FF FF FF FF 
1740   1880 FF FF FF FF 
1740   1884 FF FF FF FF 
1740   1888 FF FF FF FF 
1740   188C FF FF FF FF 
1740   1890 FF FF FF FF 
1740   1894 FF FF FF FF 
1740   1898 FF FF FF FF 
1740   189C FF FF FF FF 
1740   18A0 FF FF FF FF 
1740   18A4 FF FF FF FF 
1740   18A8 FF FF FF FF 
1740   18AC FF FF FF FF 
1740   18B0 FF FF FF FF 
1740   18B4 FF FF FF FF 
1740   18B8 FF FF FF FF 
1740   18BC FF FF FF FF 
1740   18C0 FF FF FF FF 
1740   18C4 FF FF FF FF 
1740   18C8 FF FF FF FF 
1740   18CC FF FF FF FF 
1740   18D0 FF FF FF FF 
1740   18D4 FF FF FF FF 
1740   18D8 FF FF FF FF 
1740   18DC FF FF FF FF 
1740   18E0 FF FF FF FF 
1740   18E4 FF FF FF FF 
1740   18E8 FF FF FF FF 
1740   18EC FF FF FF FF 
1740   18F0 FF FF FF FF 
1740   18F4 FF FF FF FF 
1740   18F8 FF FF FF FF 
1740   18FC FF FF FF FF 
1740   1900 FF FF FF FF 
1740   1904 FF FF FF FF 
1740   1908 FF FF FF FF 
1740   190C FF FF FF FF 
1740   1910 FF FF FF FF 
1740   1914 FF FF FF FF 
1740   1918 FF FF FF FF 
1740   191C FF FF FF FF 
1740   1920 FF FF FF FF 
1740   1924 FF FF FF FF 
1740   1928 FF FF FF FF 
1740   192C FF FF FF FF 
1740   1930 FF FF FF FF 
1740   1934 FF FF FF FF 
1740   1938 FF FF FF FF 
1740   193C FF FF FF FF 
1740   1940 FF FF FF FF 
1740   1944 FF FF FF FF 
1740   1948 FF FF FF FF 
1740   194C FF FF FF FF 
1740   1950 FF FF FF FF 
1740   1954 FF FF FF FF 
1740   1958 FF FF FF FF 
1740   195C FF FF FF FF 
1740   1960 FF FF FF FF 
1740   1964 FF FF FF FF 
1740   1968 FF FF FF FF 
1740   196C FF FF FF FF 
1740   1970 FF FF FF FF 
1740   1974 FF FF FF FF 
1740   1978 FF FF FF FF 
1740   197C FF FF FF FF 
1740   1980 FF FF FF FF 
1740   1984 FF FF FF FF 
1740   1988 FF FF FF FF 
1740   198C FF FF FF FF 
1740   1990 FF FF FF FF 
1740   1994 FF FF FF FF 
1740   1998 FF FF FF FF 
1740   199C FF FF FF FF 
1740   19A0 FF FF FF FF 
1740   19A4 FF FF FF FF 
1740   19A8 FF FF FF FF 
1740   19AC FF FF FF FF 
1740   19B0 FF FF FF FF 
1740   19B4 FF FF FF FF 
1740   19B8 FF FF FF FF 
1740   19BC FF FF FF FF 
1740   19C0 FF FF FF FF 
1740   19C4 FF FF FF FF 
1740   19C8 FF FF FF FF 
1740   19CC FF FF FF FF 
1740   19D0 FF FF FF FF 
1740   19D4 FF FF FF FF 
1740   19D8 FF FF FF FF 
1740   19DC FF FF FF FF 
1740   19E0 FF FF FF FF 
1740   19E4 FF FF FF FF 
1740   19E8 FF FF FF FF 
1740   19EC FF FF FF FF 
1740   19F0 FF FF FF FF 
1740   19F4 FF FF FF FF 
1740   19F8 FF FF FF FF 
1740   19FC FF FF FF FF 
1740   1A00 FF FF FF FF 
1740   1A04 FF FF FF FF 
1740   1A08 FF FF FF FF 
1740   1A0C FF FF FF FF 
1740   1A10 FF FF FF FF 
1740   1A14 FF FF FF FF 
1740   1A18 FF FF FF FF 
1740   1A1C FF FF FF FF 
1740   1A20 FF FF FF FF 
1740   1A24 FF FF FF FF 
1740   1A28 FF FF FF FF 
1740   1A2C FF FF FF FF 
1740   1A30 FF FF FF FF 
1740   1A34 FF FF FF FF 
1740   1A38 FF FF FF FF 
1740   1A3C FF FF FF FF 
1740   1A40 FF FF FF FF 
1740   1A44 FF FF FF FF 
1740   1A48 FF FF FF FF 
1740   1A4C FF FF FF FF 
1740   1A50 FF FF FF FF 
1740   1A54 FF FF FF FF 
1740   1A58 FF FF FF FF 
1740   1A5C FF FF FF FF 
1740   1A60 FF FF FF FF 
1740   1A64 FF FF FF FF 
1740   1A68 FF FF FF FF 
1740   1A6C FF FF FF FF 
1740   1A70 FF FF FF FF 
1740   1A74 FF FF FF FF 
1740   1A78 FF FF FF FF 
1740   1A7C FF FF FF FF 
1740   1A80 FF FF FF FF 
1740   1A84 FF FF FF FF 
1740   1A88 FF FF FF FF 
1740   1A8C FF FF FF FF 
1740   1A90 FF FF FF FF 
1740   1A94 FF FF FF FF 
1740   1A98 FF FF FF FF 
1740   1A9C FF FF FF FF 
1740   1AA0 FF FF FF FF 
1740   1AA4 FF FF FF FF 
1740   1AA8 FF FF FF FF 
1740   1AAC FF FF FF FF 
1740   1AB0 FF FF FF FF 
1740   1AB4 FF FF FF FF 
1740   1AB8 FF FF FF FF 
1740   1ABC FF FF FF FF 
1740   1AC0 FF FF FF FF 
1740   1AC4 FF FF FF FF 
1740   1AC8 FF FF FF FF 
1740   1ACC FF FF FF FF 
1740   1AD0 FF FF FF FF 
1740   1AD4 FF FF FF FF 
1740   1AD8 FF FF FF FF 
1740   1ADC FF FF FF FF 
1740   1AE0 FF FF FF FF 
1740   1AE4 FF FF FF FF 
1740   1AE8 FF FF FF FF 
1740   1AEC FF FF FF FF 
1740   1AF0 FF FF FF FF 
1740   1AF4 FF FF FF FF 
1740   1AF8 FF FF FF FF 
1740   1AFC FF FF FF FF 
1740   1B00 FF FF FF FF 
1740   1B04 FF FF FF FF 
1740   1B08 FF FF FF FF 
1740   1B0C FF FF FF FF 
1740   1B10 FF FF FF FF 
1740   1B14 FF FF FF FF 
1740   1B18 FF FF FF FF 
1740   1B1C FF FF FF FF 
1740   1B20 FF FF FF FF 
1740   1B24 FF FF FF FF 
1740   1B28 FF FF FF FF 
1740   1B2C FF FF FF FF 
1740   1B30 FF FF FF FF 
1740   1B34 FF FF FF FF 
1740   1B38 FF FF FF FF 
1740   1B3C FF FF FF FF 
1740   1B40 FF FF FF FF 
1740   1B44 FF FF FF FF 
1740   1B48 FF FF FF FF 
1740   1B4C FF FF FF FF 
1740   1B50 FF FF FF FF 
1740   1B54 FF FF FF FF 
1740   1B58 FF FF FF FF 
1740   1B5C FF FF FF FF 
1740   1B60 FF FF FF FF 
1740   1B64 FF FF FF FF 
1740   1B68 FF FF FF FF 
1740   1B6C FF FF FF FF 
1740   1B70 FF FF FF FF 
1740   1B74 FF FF FF FF 
1740   1B78 FF FF FF FF 
1740   1B7C FF FF FF FF 
1740   1B80 FF FF FF FF 
1740   1B84 FF FF FF FF 
1740   1B88 FF FF FF FF 
1740   1B8C FF FF FF FF 
1740   1B90 FF FF FF FF 
1740   1B94 FF FF FF FF 
1740   1B98 FF FF FF FF 
1740   1B9C FF FF FF FF 
1740   1BA0 FF FF FF FF 
1740   1BA4 FF FF FF FF 
1740   1BA8 FF FF FF FF 
1740   1BAC FF FF FF FF 
1740   1BB0 FF FF FF FF 
1740   1BB4 FF FF FF FF 
1740   1BB8 FF FF FF FF 
1740   1BBC FF FF FF FF 
1740   1BC0 FF FF FF FF 
1740   1BC4 FF FF FF FF 
1740   1BC8 FF FF FF FF 
1740   1BCC FF FF FF FF 
1740   1BD0 FF FF FF FF 
1740   1BD4 FF FF FF FF 
1740   1BD8 FF FF FF FF 
1740   1BDC FF FF FF FF 
1740   1BE0 FF FF FF FF 
1740   1BE4 FF FF FF FF 
1740   1BE8 FF FF FF FF 
1740   1BEC FF FF FF FF 
1740   1BF0 FF FF FF FF 
1740   1BF4 FF FF FF FF 
1740   1BF8 FF FF FF FF 
1740   1BFC FF FF FF FF 
1740   1C00 FF FF FF FF 
1740   1C04 FF FF FF FF 
1740   1C08 FF FF FF FF 
1740   1C0C FF FF FF FF 
1740   1C10 FF FF FF FF 
1740   1C14 FF FF FF FF 
1740   1C18 FF FF FF FF 
1740   1C1C FF FF FF FF 
1740   1C20 FF FF FF FF 
1740   1C24 FF FF FF FF 
1740   1C28 FF FF FF FF 
1740   1C2C FF FF FF FF 
1740   1C30 FF FF FF FF 
1740   1C34 FF FF FF FF 
1740   1C38 FF FF FF FF 
1740   1C3C FF FF FF FF 
1740   1C40 FF FF FF FF 
1740   1C44 FF FF FF FF 
1740   1C48 FF FF FF FF 
1740   1C4C FF FF FF FF 
1740   1C50 FF FF FF FF 
1740   1C54 FF FF FF FF 
1740   1C58 FF FF FF FF 
1740   1C5C FF FF FF FF 
1740   1C60 FF FF FF FF 
1740   1C64 FF FF FF FF 
1740   1C68 FF FF FF FF 
1740   1C6C FF FF FF FF 
1740   1C70 FF FF FF FF 
1740   1C74 FF FF FF FF 
1740   1C78 FF FF FF FF 
1740   1C7C FF FF FF FF 
1740   1C80 FF FF FF FF 
1740   1C84 FF FF FF FF 
1740   1C88 FF FF FF FF 
1740   1C8C FF FF FF FF 
1740   1C90 FF FF FF FF 
1740   1C94 FF FF FF FF 
1740   1C98 FF FF FF FF 
1740   1C9C FF FF FF FF 
1740   1CA0 FF FF FF FF 
1740   1CA4 FF FF FF FF 
1740   1CA8 FF FF FF FF 
1740   1CAC FF FF FF FF 
1740   1CB0 FF FF FF FF 
1740   1CB4 FF FF FF FF 
1740   1CB8 FF FF FF FF 
1740   1CBC FF FF FF FF 
1740   1CC0 FF FF FF FF 
1740   1CC4 FF FF FF FF 
1740   1CC8 FF FF FF FF 
1740   1CCC FF FF FF FF 
1740   1CD0 FF FF FF FF 
1740   1CD4 FF FF FF FF 
1740   1CD8 FF FF FF FF 
1740   1CDC FF FF FF FF 
1740   1CE0 FF FF FF FF 
1740   1CE4 FF FF FF FF 
1740   1CE8 FF FF FF FF 
1740   1CEC FF FF FF FF 
1740   1CF0 FF FF FF FF 
1740   1CF4 FF FF FF FF 
1740   1CF8 FF FF FF FF 
1740   1CFC FF FF FF FF 
1740   1D00 FF FF FF FF 
1740   1D04 FF FF FF FF 
1740   1D08 FF FF FF FF 
1740   1D0C FF FF FF FF 
1740   1D10 FF FF FF FF 
1740   1D14 FF FF FF FF 
1740   1D18 FF FF FF FF 
1740   1D1C FF FF FF FF 
1740   1D20 FF FF FF FF 
1740   1D24 FF FF FF FF 
1740   1D28 FF FF FF FF 
1740   1D2C FF FF FF FF 
1740   1D30 FF FF FF FF 
1740   1D34 FF FF FF FF 
1740   1D38 FF FF FF FF 
1740   1D3C FF FF FF FF 
1740   1D40 FF FF FF FF 
1740   1D44 FF FF FF FF 
1740   1D48 FF FF FF FF 
1740   1D4C FF FF FF FF 
1740   1D50 FF FF FF FF 
1740   1D54 FF FF FF FF 
1740   1D58 FF FF FF FF 
1740   1D5C FF FF FF FF 
1740   1D60 FF FF FF FF 
1740   1D64 FF FF FF FF 
1740   1D68 FF FF FF FF 
1740   1D6C FF FF FF FF 
1740   1D70 FF FF FF FF 
1740   1D74 FF FF FF FF 
1740   1D78 FF FF FF FF 
1740   1D7C FF FF FF FF 
1740   1D80 FF FF FF FF 
1740   1D84 FF FF FF FF 
1740   1D88 FF FF FF FF 
1740   1D8C FF FF FF FF 
1740   1D90 FF FF FF FF 
1740   1D94 FF FF FF FF 
1740   1D98 FF FF FF FF 
1740   1D9C FF FF FF FF 
1740   1DA0 FF FF FF FF 
1740   1DA4 FF FF FF FF 
1740   1DA8 FF FF FF FF 
1740   1DAC FF FF FF FF 
1740   1DB0 FF FF FF FF 
1740   1DB4 FF FF FF FF 
1740   1DB8 FF FF FF FF 
1740   1DBC FF FF FF FF 
1740   1DC0 FF FF FF FF 
1740   1DC4 FF FF FF FF 
1740   1DC8 FF FF FF FF 
1740   1DCC FF FF FF FF 
1740   1DD0 FF FF FF FF 
1740   1DD4 FF FF FF FF 
1740   1DD8 FF FF FF FF 
1740   1DDC FF FF FF FF 
1740   1DE0 FF FF FF FF 
1740   1DE4 FF FF FF FF 
1740   1DE8 FF FF FF FF 
1740   1DEC FF FF FF FF 
1740   1DF0 FF FF FF FF 
1740   1DF4 FF FF FF FF 
1740   1DF8 FF FF FF FF 
1740   1DFC FF FF FF FF 
1740   1E00 FF FF FF FF 
1740   1E04 FF FF FF FF 
1740   1E08 FF FF FF FF 
1740   1E0C FF FF FF FF 
1740   1E10 FF FF FF FF 
1740   1E14 FF FF FF FF 
1740   1E18 FF FF FF FF 
1740   1E1C FF FF FF FF 
1740   1E20 FF FF FF FF 
1740   1E24 FF FF FF FF 
1740   1E28 FF FF FF FF 
1740   1E2C FF FF FF FF 
1740   1E30 FF FF FF FF 
1740   1E34 FF FF FF FF 
1740   1E38 FF FF FF FF 
1740   1E3C FF FF FF FF 
1740   1E40 FF FF FF FF 
1740   1E44 FF FF FF FF 
1740   1E48 FF FF FF FF 
1740   1E4C FF FF FF FF 
1740   1E50 FF FF FF FF 
1740   1E54 FF FF FF FF 
1740   1E58 FF FF FF FF 
1740   1E5C FF FF FF FF 
1740   1E60 FF FF FF FF 
1740   1E64 FF FF FF FF 
1740   1E68 FF FF FF FF 
1740   1E6C FF FF FF FF 
1740   1E70 FF FF FF FF 
1740   1E74 FF FF FF FF 
1740   1E78 FF FF FF FF 
1740   1E7C FF FF FF FF 
1740   1E80 FF FF FF FF 
1740   1E84 FF FF FF FF 
1740   1E88 FF FF FF FF 
1740   1E8C FF FF FF FF 
1740   1E90 FF FF FF FF 
1740   1E94 FF FF FF FF 
1740   1E98 FF FF FF FF 
1740   1E9C FF FF FF FF 
1740   1EA0 FF FF FF FF 
1740   1EA4 FF FF FF FF 
1740   1EA8 FF FF FF FF 
1740   1EAC FF FF FF FF 
1740   1EB0 FF FF FF FF 
1740   1EB4 FF FF FF FF 
1740   1EB8 FF FF FF FF 
1740   1EBC FF FF FF FF 
1740   1EC0 FF FF FF FF 
1740   1EC4 FF FF FF FF 
1740   1EC8 FF FF FF FF 
1740   1ECC FF FF FF FF 
1740   1ED0 FF FF FF FF 
1740   1ED4 FF FF FF FF 
1740   1ED8 FF FF FF FF 
1740   1EDC FF FF FF FF 
1740   1EE0 FF FF FF FF 
1740   1EE4 FF FF FF FF 
1740   1EE8 FF FF FF FF 
1740   1EEC FF FF FF FF 
1740   1EF0 FF FF FF FF 
1740   1EF4 FF FF FF FF 
1740   1EF8 FF FF FF FF 
1740   1EFC FF FF FF FF 
1740   1F00 FF FF FF FF 
1740   1F04 FF FF FF FF 
1740   1F08 FF FF FF FF 
1740   1F0C FF FF FF FF 
1740   1F10 FF FF FF FF 
1740   1F14 FF FF FF FF 
1740   1F18 FF FF FF FF 
1740   1F1C FF FF FF FF 
1740   1F20 FF FF FF FF 
1740   1F24 FF FF FF FF 
1740   1F28 FF FF FF FF 
1740   1F2C FF FF FF FF 
1740   1F30 FF FF FF FF 
1740   1F34 FF FF FF FF 
1740   1F38 FF FF FF FF 
1740   1F3C FF FF FF FF 
1740   1F40 FF FF FF FF 
1740   1F44 FF FF FF FF 
1740   1F48 FF FF FF FF 
1740   1F4C FF FF FF FF 
1740   1F50 FF FF FF FF 
1740   1F54 FF FF FF FF 
1740   1F58 FF FF FF FF 
1740   1F5C FF FF FF FF 
1740   1F60 FF FF FF FF 
1740   1F64 FF FF FF FF 
1740   1F68 FF FF FF FF 
1740   1F6C FF FF FF FF 
1740   1F70 FF FF FF FF 
1740   1F74 FF FF FF FF 
1740   1F78 FF FF FF FF 
1740   1F7C FF FF FF FF 
1740   1F80 FF FF FF FF 
1740   1F84 FF FF FF FF 
1740   1F88 FF FF FF FF 
1740   1F8C FF FF FF FF 
1740   1F90 FF FF FF FF 
1740   1F94 FF FF FF FF 
1740   1F98 FF FF FF FF 
1740   1F9C FF FF FF FF 
1740   1FA0 FF FF FF FF 
1740   1FA4 FF FF FF FF 
1740   1FA8 FF FF FF FF 
1740   1FAC FF FF FF FF 
1740   1FB0 FF FF FF FF 
1740   1FB4 FF FF FF FF 
1740   1FB8 FF FF FF FF 
1740   1FBC FF FF FF FF 
1740   1FC0 FF FF FF FF 
1740   1FC4 FF FF FF FF 
1740   1FC8 FF FF FF FF 
1740   1FCC FF FF FF FF 
1740   1FD0 FF FF FF FF 
1740   1FD4 FF FF FF FF 
1740   1FD8 FF FF FF FF 
1740   1FDC FF FF FF FF 
1740   1FE0 FF FF FF FF 
1740   1FE4 FF FF FF FF 
1740   1FE8 FF FF FF FF 
1740   1FEC FF FF FF FF 
1740   1FF0 FF FF FF FF 
1740   1FF4 FF FF FF FF 
1740   1FF8 FF FF FF FF 
1740   1FFC FF FF FF FF 
1740   2000 FF FF FF FF 
1740   2004 FF FF FF FF 
1740   2008 FF FF FF FF 
1740   200C FF FF FF FF 
1740   2010 FF FF FF FF 
1740   2014 FF FF FF FF 
1740   2018 FF FF FF FF 
1740   201C FF FF FF FF 
1740   2020 FF FF FF FF 
1740   2024 FF FF FF FF 
1740   2028 FF FF FF FF 
1740   202C FF FF FF FF 
1740   2030 FF FF FF FF 
1740   2034 FF FF FF FF 
1740   2038 FF FF FF FF 
1740   203C FF FF FF FF 
1740   2040 FF FF FF FF 
1740   2044 FF FF FF FF 
1740   2048 FF FF FF FF 
1740   204C FF FF FF FF 
1740   2050 FF FF FF FF 
1740   2054 FF FF FF FF 
1740   2058 FF FF FF FF 
1740   205C FF FF FF FF 
1740   2060 FF FF FF FF 
1740   2064 FF FF FF FF 
1740   2068 FF FF FF FF 
1740   206C FF FF FF FF 
1740   2070 FF FF FF FF 
1740   2074 FF FF FF FF 
1740   2078 FF FF FF FF 
1740   207C FF FF FF FF 
1740   2080 FF FF FF FF 
1740   2084 FF FF FF FF 
1740   2088 FF FF FF FF 
1740   208C FF FF FF FF 
1740   2090 FF FF FF FF 
1740   2094 FF FF FF FF 
1740   2098 FF FF FF FF 
1740   209C FF FF FF FF 
1740   20A0 FF FF FF FF 
1740   20A4 FF FF FF FF 
1740   20A8 FF FF FF FF 
1740   20AC FF FF FF FF 
1740   20B0 FF FF FF FF 
1740   20B4 FF FF FF FF 
1740   20B8 FF FF FF FF 
1740   20BC FF FF FF FF 
1740   20C0 FF FF FF FF 
1740   20C4 FF FF FF FF 
1740   20C8 FF FF FF FF 
1740   20CC FF FF FF FF 
1740   20D0 FF FF FF FF 
1740   20D4 FF FF FF FF 
1740   20D8 FF FF FF FF 
1740   20DC FF FF FF FF 
1740   20E0 FF FF FF FF 
1740   20E4 FF FF FF FF 
1740   20E8 FF FF FF FF 
1740   20EC FF FF FF FF 
1740   20F0 FF FF FF FF 
1740   20F4 FF FF FF FF 
1740   20F8 FF FF FF FF 
1740   20FC FF FF FF FF 
1740   2100 FF FF FF FF 
1740   2104 FF FF FF FF 
1740   2108 FF FF FF FF 
1740   210C FF FF FF FF 
1740   2110 FF FF FF FF 
1740   2114 FF FF FF FF 
1740   2118 FF FF FF FF 
1740   211C FF FF FF FF 
1740   2120 FF FF FF FF 
1740   2124 FF FF FF FF 
1740   2128 FF FF FF FF 
1740   212C FF FF FF FF 
1740   2130 FF FF FF FF 
1740   2134 FF FF FF FF 
1740   2138 FF FF FF FF 
1740   213C FF FF FF FF 
1740   2140 FF FF FF FF 
1740   2144 FF FF FF FF 
1740   2148 FF FF FF FF 
1740   214C FF FF FF FF 
1740   2150 FF FF FF FF 
1740   2154 FF FF FF FF 
1740   2158 FF FF FF FF 
1740   215C FF FF FF FF 
1741   2160             
1742   2160             scrap_sector:
1743   2160 FF FF FF FF   .fill 512         ; scrap sector
1743   2164 FF FF FF FF 
1743   2168 FF FF FF FF 
1743   216C FF FF FF FF 
1743   2170 FF FF FF FF 
1743   2174 FF FF FF FF 
1743   2178 FF FF FF FF 
1743   217C FF FF FF FF 
1743   2180 FF FF FF FF 
1743   2184 FF FF FF FF 
1743   2188 FF FF FF FF 
1743   218C FF FF FF FF 
1743   2190 FF FF FF FF 
1743   2194 FF FF FF FF 
1743   2198 FF FF FF FF 
1743   219C FF FF FF FF 
1743   21A0 FF FF FF FF 
1743   21A4 FF FF FF FF 
1743   21A8 FF FF FF FF 
1743   21AC FF FF FF FF 
1743   21B0 FF FF FF FF 
1743   21B4 FF FF FF FF 
1743   21B8 FF FF FF FF 
1743   21BC FF FF FF FF 
1743   21C0 FF FF FF FF 
1743   21C4 FF FF FF FF 
1743   21C8 FF FF FF FF 
1743   21CC FF FF FF FF 
1743   21D0 FF FF FF FF 
1743   21D4 FF FF FF FF 
1743   21D8 FF FF FF FF 
1743   21DC FF FF FF FF 
1743   21E0 FF FF FF FF 
1743   21E4 FF FF FF FF 
1743   21E8 FF FF FF FF 
1743   21EC FF FF FF FF 
1743   21F0 FF FF FF FF 
1743   21F4 FF FF FF FF 
1743   21F8 FF FF FF FF 
1743   21FC FF FF FF FF 
1743   2200 FF FF FF FF 
1743   2204 FF FF FF FF 
1743   2208 FF FF FF FF 
1743   220C FF FF FF FF 
1743   2210 FF FF FF FF 
1743   2214 FF FF FF FF 
1743   2218 FF FF FF FF 
1743   221C FF FF FF FF 
1743   2220 FF FF FF FF 
1743   2224 FF FF FF FF 
1743   2228 FF FF FF FF 
1743   222C FF FF FF FF 
1743   2230 FF FF FF FF 
1743   2234 FF FF FF FF 
1743   2238 FF FF FF FF 
1743   223C FF FF FF FF 
1743   2240 FF FF FF FF 
1743   2244 FF FF FF FF 
1743   2248 FF FF FF FF 
1743   224C FF FF FF FF 
1743   2250 FF FF FF FF 
1743   2254 FF FF FF FF 
1743   2258 FF FF FF FF 
1743   225C FF FF FF FF 
1743   2260 FF FF FF FF 
1743   2264 FF FF FF FF 
1743   2268 FF FF FF FF 
1743   226C FF FF FF FF 
1743   2270 FF FF FF FF 
1743   2274 FF FF FF FF 
1743   2278 FF FF FF FF 
1743   227C FF FF FF FF 
1743   2280 FF FF FF FF 
1743   2284 FF FF FF FF 
1743   2288 FF FF FF FF 
1743   228C FF FF FF FF 
1743   2290 FF FF FF FF 
1743   2294 FF FF FF FF 
1743   2298 FF FF FF FF 
1743   229C FF FF FF FF 
1743   22A0 FF FF FF FF 
1743   22A4 FF FF FF FF 
1743   22A8 FF FF FF FF 
1743   22AC FF FF FF FF 
1743   22B0 FF FF FF FF 
1743   22B4 FF FF FF FF 
1743   22B8 FF FF FF FF 
1743   22BC FF FF FF FF 
1743   22C0 FF FF FF FF 
1743   22C4 FF FF FF FF 
1743   22C8 FF FF FF FF 
1743   22CC FF FF FF FF 
1743   22D0 FF FF FF FF 
1743   22D4 FF FF FF FF 
1743   22D8 FF FF FF FF 
1743   22DC FF FF FF FF 
1743   22E0 FF FF FF FF 
1743   22E4 FF FF FF FF 
1743   22E8 FF FF FF FF 
1743   22EC FF FF FF FF 
1743   22F0 FF FF FF FF 
1743   22F4 FF FF FF FF 
1743   22F8 FF FF FF FF 
1743   22FC FF FF FF FF 
1743   2300 FF FF FF FF 
1743   2304 FF FF FF FF 
1743   2308 FF FF FF FF 
1743   230C FF FF FF FF 
1743   2310 FF FF FF FF 
1743   2314 FF FF FF FF 
1743   2318 FF FF FF FF 
1743   231C FF FF FF FF 
1743   2320 FF FF FF FF 
1743   2324 FF FF FF FF 
1743   2328 FF FF FF FF 
1743   232C FF FF FF FF 
1743   2330 FF FF FF FF 
1743   2334 FF FF FF FF 
1743   2338 FF FF FF FF 
1743   233C FF FF FF FF 
1743   2340 FF FF FF FF 
1743   2344 FF FF FF FF 
1743   2348 FF FF FF FF 
1743   234C FF FF FF FF 
1743   2350 FF FF FF FF 
1743   2354 FF FF FF FF 
1743   2358 FF FF FF FF 
1743   235C FF FF FF FF 
1744   2360             transient_area:
1745   2360 00            .db 0             ; beginning of the transient memory area. used for disk reads and other purposes    
1746   2361             
1747   2361             .end
tasm: Number of errors = 0
